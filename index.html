<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Immigration SC - Trusted Visa & Study Abroad Consultants</title>
    <meta name="description" content="Global Immigration SC provides expert visa consultation, study abroad programs, and immigration services. Get assistance with student visas, work permits, and relocation.">
    <meta name="keywords" content="immigration consultants, study abroad, visa assistance, work permits, student visa, relocation services, travel consultation">
    <meta name="author" content="Global Immigration SC">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TJCKSJNLPT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TJCKSJNLPT');
    </script>
    <!-- End Google Analytics -->
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Additional performance optimizations -->
    <link rel="dns-prefetch" href="https://formspree.io">
    <link rel="dns-prefetch" href="https://firebasestorage.googleapis.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <style>
        /* Base Styles */
        :root {
            --primary-red: #E30613;
            --primary-white: #FFFFFF;
            --light-gray: #F5F5F5;
            --medium-gray: #777777;
            --dark-gray: #333333;
        }
        
        /* Custom Scrollbar Styles - Brand Themed */
        /* Always show vertical scrollbar */
        html {
            overflow-y: scroll;
        }

        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 12px; /* scrollbar width */
        }

        ::-webkit-scrollbar-track {
            background: var(--light-gray); /* Using your CSS variable */
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--primary-red); /* Using your brand red */
            border-radius: 10px; /* rounded edges */
            border: 2px solid var(--light-gray);
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #b30000; /* Darker red on hover */
        }

        /* Firefox support */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-red) var(--light-gray);
        }

        /* For specific application form areas */
        .application-portal,
        .contact-form,
        .modal-content,
        .auth-modal-content,
        .dashboard-content {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-red) var(--light-gray);
        }

        .application-portal::-webkit-scrollbar,
        .contact-form::-webkit-scrollbar,
        .modal-content::-webkit-scrollbar,
        .auth-modal-content::-webkit-scrollbar,
        .dashboard-content::-webkit-scrollbar {
            width: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            line-height: 1.6;
            color: var(--dark-gray);
            background-color: var(--primary-white);
            overflow-x: hidden;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        ul {
            list-style: none;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 28px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn-primary {
            background-color: var(--primary-red);
            color: var(--primary-white);
            border: 2px solid var(--primary-red);
        }
        
        .btn-primary:hover {
            background-color: transparent;
            color: var(--primary-red);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--primary-red);
            border: 2px solid var(--primary-red);
        }
        
        .btn-outline:hover {
            background-color: var(--primary-red);
            color: var(--primary-white);
        }
        
        .btn-small {
            padding: 10px 16px;
            font-size: 0.9rem;
        }
        
        .btn-live {
            background-color: #ff0000;
            color: white;
            border: none;
        }
        
        .btn-live:hover {
            background-color: #cc0000;
        }
        
        .section {
            padding: 80px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .section-title h2 {
            font-size: 2.5rem;
            color: var(--dark-gray);
            margin-bottom: 15px;
        }
        
        .section-title p {
            color: var(--medium-gray);
            max-width: 700px;
            margin: 0 auto;
        }
        
        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--primary-white);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-logo {
            max-width: 150px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .loading-logo img {
            max-width: 100%;
            height: auto;
            animation: rotateLogo 2s ease-in-out 2;
        }
        
        @keyframes rotateLogo {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.5rem;
            color: var(--primary-red);
            font-weight: 600;
        }
        
        /* Header Styles */
        header {
            background-color: var(--primary-white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }
        
        /* Updated logo styles */
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 50px;
            width: auto;
            object-fit: contain;
            transition: height 0.3s ease;
        }

        /* Larger logo on desktop */
        @media (min-width: 1200px) {
            .logo img {
                height: 60px;
            }
        }

        /* Better mobile logo sizing */
        @media (max-width: 768px) {
            .logo img {
                height: 45px;
                max-width: 180px;
            }
            
            /* Improve fallback styling */
            .image-fallback {
                padding: 10px;
            }
            
            .image-fallback i {
                font-size: 2.2rem;
            }
        }

        /* Very small devices */
        @media (max-width: 480px) {
            .logo img {
                height: 40px;
                max-width: 160px;
            }
            
            .header-container {
                padding: 8px 15px;
            }
        }
        
        .nav-menu {
            display: flex;
        }
        
        .nav-menu li {
            margin: 0 15px;
            position: relative;
        }
        
        .nav-menu li a {
            color: var(--dark-gray);
            font-weight: 500;
            transition: color 0.3s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        
        .nav-menu li a:hover {
            color: var(--primary-red);
        }
        
        .dropdown {
            position: relative;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: var(--primary-white);
            min-width: 250px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            z-index: 1;
            border-top: 3px solid var(--primary-red);
        }
        
        .dropdown-content a {
            color: var(--dark-gray);
            padding: 12px 16px;
            display: block;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        
        .dropdown-content a:hover {
            background-color: var(--light-gray);
            color: var(--primary-red);
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .mobile-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            min-height: 44px;
            min-width: 44px;
            align-items: center;
            justify-content: center;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1800&q=80');
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            align-items: center;
            color: var(--primary-white);
            text-align: center;
            margin-top: 70px;
            position: relative;
            overflow: hidden;
        }
        
        .plane-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
        }
        
        .plane {
            position: absolute;
            width: 120px;
            height: 60px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="%23E30613" d="M482.3 192c34.2 0 93.7 29 93.7 64c0 36-59.5 64-93.7 64H365.7L265.2 495.9c-5.7 10-16.3 16.1-27.8 16.1h-56.2c-10.6 0-18.3-10.2-15.4-20.4l49-171.6H112l-43.2 57.6c-3 4-7.8 6.4-12.8 6.4H14c-7.8 0-14-6.3-14-14c0-1.3 .2-2.6 .5-3.9L32 256 .5 145.9c-.4-1.3-.5-2.6-.5-3.9c0-7.8 6.3-14 14-14h42c5 0 9.8 2.4 12.8 6.4L112 192h102.9l-49-171.6C162.9 10.2 170.6 0 181.2 0h56.2c11.5 0 22.1 6.2 27.8 16.1L365.7 192h116.5z"/></svg>') no-repeat center/contain;
            animation: fly 25s linear infinite;
            opacity: 0.9;
        }
        
        @keyframes fly {
            0% {
                left: -10%;
                top: 30%;
                transform: rotate(5deg);
            }
            100% {
                left: 110%;
                top: 30%;
                transform: rotate(5deg);
            }
        }
        
        .plane:nth-child(2) {
            width: 90px;
            height: 45px;
            animation: fly2 30s linear infinite;
            animation-delay: 7s;
            top: 60%;
        }
        
        @keyframes fly2 {
            0% {
                left: -10%;
                top: 60%;
                transform: rotate(-3deg);
            }
            100% {
                left: 110%;
                top: 60%;
                transform: rotate(-3deg);
            }
        }
        
        .plane:nth-child(3) {
            width: 100px;
            height: 50px;
            animation: fly3 35s linear infinite;
            animation-delay: 15s;
            top: 45%;
        }
        
        @keyframes fly3 {
            0% {
                left: -10%;
                top: 45%;
                transform: rotate(2deg);
            }
            100% {
                left: 110%;
                top: 45%;
                transform: rotate(2deg);
            }
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 3;
        }
        
        .hero-content h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            line-height: 1.2;
            color: var(--primary-white);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--primary-white);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .hero-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        /* About Section */
        .about {
            background-color: var(--primary-white);
        }
        
        .about-content {
            display: flex;
            align-items: center;
            gap: 50px;
        }
        
        .about-text {
            flex: 1;
        }
        
        .about-text h2 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: var(--dark-gray);
        }
        
        .about-text p {
            margin-bottom: 15px;
            color: var(--medium-gray);
        }
        
        .about-image {
            flex: 1;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: var(--light-gray);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .about-image img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }
        
        /* Services Section */
        .services {
            background-color: var(--light-gray);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .service-card {
            background-color: var(--primary-white);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .service-icon {
            font-size: 2.5rem;
            color: var(--primary-red);
            margin-bottom: 20px;
        }
        
        .service-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }
        
        .service-card p {
            color: var(--medium-gray);
            margin-bottom: 20px;
            flex-grow: 1;
        }
        
        /* Destinations Section */
        .destinations {
            background-color: var(--primary-white);
        }
        
        .flags-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
        }
        
        .country-flag {
            text-align: center;
            width: 100px;
        }
        
        .flag-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
        }
        
        .country-name {
            font-weight: 500;
            color: var(--dark-gray);
        }
        
        /* Process Section */
        .process {
            background-color: var(--light-gray);
        }
        
        .process-steps {
            display: flex;
            justify-content: space-between;
            gap: 30px;
            margin-top: 50px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            padding: 30px;
            background-color: var(--primary-white);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .step-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            line-height: 50px;
            background-color: var(--primary-red);
            color: var(--primary-white);
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .step h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }
        
        .step p {
            color: var(--medium-gray);
        }
        
        /* Testimonials Section */
        .testimonials {
            background-color: var(--primary-white);
        }
        
        .testimonials-container {
            display: flex;
            gap: 30px;
            margin-top: 50px;
            flex-wrap: wrap;
        }
        
        .testimonial {
            flex: 1;
            min-width: 300px;
            background-color: var(--light-gray);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
            color: var(--dark-gray);
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
        }
        
        .author-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 15px;
            background-color: var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .author-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .author-details h4 {
            color: var(--dark-gray);
            margin-bottom: 5px;
        }
        
        .author-details p {
            color: var(--medium-gray);
            font-size: 0.9rem;
        }
        
        /* Stats Section */
.stats {
    background: linear-gradient(135deg, var(--primary-red) 0%, #b30000 100%);
    color: white;
    text-align: center;
    padding: 60px 0;
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 30px;
    text-align: center;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.stat-number {
    font-size: 3rem;
    font-weight: bold;
    margin-bottom: 10px;
    display: block;
    color: white !important; /* Keep white for main stats section */
}

.stat-label {
    font-size: 1.2rem;
    opacity: 0.9;
    color: white !important;
}

/* OVERRIDE for Admin Dashboard stats - make text dark */
.admin-dashboard .stat-number,
.admin-dashboard .stat-label {
    color: var(--dark-gray) !important;
}

.admin-dashboard .stats-container {
    color: var(--dark-gray);
}

/* Mobile responsiveness for stats - FIXED */
@media (max-width: 992px) {
    .stats-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 30px;
    }
}

@media (max-width: 480px) {
    .stats-container {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .stat-number {
        font-size: 2.5rem;
    }
    
    .stat-label {
        font-size: 1rem;
    }
}


        
        /* Founder Section */
        .founder {
            background-color: var(--primary-white);
        }
        
        .founder-container {
            display: flex;
            align-items: center;
            gap: 50px;
        }
        
        .founder-image {
            flex: 1;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: var(--light-gray);
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .founder-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .founder-content {
            flex: 1;
        }
        
        .founder-content h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }
        
        .founder-content h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary-red);
        }
        
        .founder-content p {
            margin-bottom: 15px;
            color: var(--medium-gray);
            font-style: italic;
        }
        
        .founder-signature {
            margin-top: 25px;
            font-weight: 600;
            color: var(--dark-gray);
            font-style: normal;
        }
        
        /* Team Section */
        .team {
            background-color: var(--light-gray);
            padding: 80px 0;
        }
        
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .team-member {
            background-color: var(--primary-white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .team-member:hover {
            transform: translateY(-5px);
        }
        
        .team-image {
            height: 250px;
            overflow: hidden;
            background-color: var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .team-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .team-details {
            padding: 20px;
        }
        
        .team-name {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: var(--dark-gray);
        }
        
        .team-position {
            color: var(--primary-red);
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .team-description {
            color: var(--medium-gray);
            font-size: 0.9rem;
        }
        
        /* Contact Section */
        .contact {
            background-color: var(--light-gray);
        }
        
        .contact-container {
            display: flex;
            gap: 50px;
        }
        
        .contact-info {
            flex: 1;
        }
        
        .contact-info h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--dark-gray);
        }
        
        .contact-details {
            margin-bottom: 30px;
        }
        
        .contact-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .contact-icon {
            color: var(--primary-red);
            font-size: 1.2rem;
            margin-right: 15px;
            margin-top: 3px;
        }
        
        .contact-text {
            color: var(--medium-gray);
        }
        
        .office-hours {
            margin-top: 30px;
        }
        
        .office-hours h4 {
            margin-bottom: 15px;
            color: var(--dark-gray);
        }
        
        .hours-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .hours-table tr {
            border-bottom: 1px solid #eee;
        }
        
        .hours-table td {
            padding: 8px 0;
        }
        
        .hours-table td:last-child {
            text-align: right;
        }
        
        .contact-form {
            flex: 1;
            background-color: var(--primary-white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary-red);
            outline: none;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-error {
            color: var(--primary-red);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        .form-success {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }
        
        /* Live Session Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--primary-white);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--medium-gray);
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .live-session-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .session-option {
            padding: 15px;
            border: 2px solid var(--primary-red);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .session-option:hover {
            background-color: var(--primary-red);
            color: var(--primary-white);
        }
        
        /* Footer */
        footer {
            background-color: var(--primary-red);
            color: var(--primary-white);
            padding: 60px 0 30px;
        }
        
        .footer-container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-col {
            flex: 1;
            min-width: 200px;
        }
        
        .footer-col h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
            color: white;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 2px;
            background-color: var(--primary-white);
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            transition: color 0.3s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        
        .footer-links a:hover {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .social-links {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .social-links a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .qr-code {
            max-width: 150px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background-color: white;
            padding: 10px;
        }
        
        .qr-code img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer-tagline {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        /* WhatsApp Float */
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: #25D366;
            color: var(--primary-white);
            border-radius: 50%;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            transition: all 0.3s ease;
        }
        
        .whatsapp-float:hover {
            transform: scale(1.1);
            background-color: #128C7E;
        }
        
        /* Blog Preview Section */
        .blog-preview {
            background-color: var(--primary-white);
            padding: 80px 0;
        }
        
        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .blog-card {
            background-color: var(--light-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .blog-card:hover {
            transform: translateY(-5px);
        }
        
        .blog-image {
            height: 200px;
            overflow: hidden;
            background-color: var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .blog-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .blog-card:hover .blog-image img {
            transform: scale(1.05);
        }
        
        .blog-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 220px;
        }
        
        .blog-date {
            font-size: 0.9rem;
            color: var(--medium-gray);
            margin-bottom: 10px;
        }
        
        .blog-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--dark-gray);
        }
        
        .blog-excerpt {
            color: var(--medium-gray);
            margin-bottom: 15px;
            flex-grow: 1;
        }
        
        /* Facebook Feed Styles */
        .facebook-feed {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .fb-post {
            background-color: var(--light-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .fb-post:hover {
            transform: translateY(-5px);
        }
        
        .fb-image {
            height: 200px;
            overflow: hidden;
            background-color: var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .fb-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .fb-post:hover .fb-image img {
            transform: scale(1.05);
        }
        
        .fb-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 220px;
        }
        
        .fb-date {
            font-size: 0.9rem;
            color: var(--medium-gray);
            margin-bottom: 10px;
        }
        
        .fb-message {
            color: var(--medium-gray);
            margin-bottom: 15px;
            flex-grow: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }
        
        /* Newsletter Section */
        .newsletter {
            background-color: #f8f9fa;
            padding: 60px 0;
            text-align: center;
            display: block;
        }
        
        .newsletter-content {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .newsletter-form {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        
        .newsletter-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        /* Application Portal Styles */
        .application-portal {
            background-color: var(--light-gray);
            padding: 80px 0;
        }
        
        .portal-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .portal-option {
            background-color: var(--primary-white);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 300px;
        }
        
        .portal-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .portal-icon {
            font-size: 3rem;
            color: var(--primary-red);
            margin-bottom: 20px;
        }
        
        .portal-option h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark-gray);
        }
        
        .portal-option p {
            color: var(--medium-gray);
            margin-bottom: 25px;
        }
        
        /* Authentication Modal Styles */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .auth-modal-content {
            background-color: var(--primary-white);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .auth-tab.active {
            border-bottom: 3px solid var(--primary-red);
            color: var(--primary-red);
            font-weight: 600;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .password-strength {
            margin-top: 5px;
            height: 5px;
            background-color: #eee;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .password-strength-text {
            font-size: 0.8rem;
            margin-top: 5px;
            color: var(--medium-gray);
        }
        
        .password-strength.weak .password-strength-bar {
            background-color: #ff4d4d;
            width: 33%;
        }
        
        .password-strength.medium .password-strength-bar {
            background-color: #ffa500;
            width: 66%;
        }
        
        .password-strength.strong .password-strength-bar {
            background-color: #4CAF50;
            width: 100%;
        }
        
        /* Dashboard Styles */
        .dashboard {
            background-color: var(--light-gray);
            min-height: 100vh;
            padding-top: 100px;
        }
        
        .dashboard-header {
            background-color: var(--primary-white);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .dashboard-container {
            display: flex;
            gap: 30px;
        }
        
        .dashboard-sidebar {
            width: 250px;
            background-color: var(--primary-white);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 20px;
        }
        
        .dashboard-content {
            flex: 1;
            background-color: var(--primary-white);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 10px;
        }
        
        .sidebar-menu a {
            display: block;
            padding: 12px 15px;
            border-radius: 4px;
            transition: all 0.3s ease;
            color: var(--dark-gray);
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--light-gray);
            color: var(--primary-red);
        }
        
        .dashboard-section {
            display: none;
        }
        
        .dashboard-section.active {
            display: block;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-red);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .progress-step {
            text-align: center;
            flex: 1;
            position: relative;
        }
        
        .progress-step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #eee;
            z-index: 1;
        }
        
        .step-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            z-index: 2;
        }
        
        .step-indicator.active {
            background-color: var(--primary-red);
            color: white;
        }
        
        .step-indicator.completed {
            background-color: #4CAF50;
            color: white;
        }
        
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .document-card {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .document-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .payment-table th, .payment-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .payment-table th {
            background-color: var(--light-gray);
            font-weight: 600;
        }
        
        .payment-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .profile-form {
            max-width: 600px;
        }
        
        /* Add these new styles for enhanced functionality */
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: var(--primary-red);
            background-color: #f9f9f9;
        }
        
        .upload-area.dragover {
            border-color: var(--primary-red);
            background-color: #fff0f0;
        }
        
        .upload-progress {
            width: 100%;
            height: 8px;
            background-color: #f0f0f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .upload-progress-bar {
            height: 100%;
            background-color: var(--primary-red);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .admin-dashboard {
            background-color: #f8f9fa;
            min-height: 100vh;
            padding-top: 80px;
        }
        
        .admin-header {
            background-color: var(--primary-white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .applicant-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .applicant-card:hover {
            transform: translateY(-2px);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-new { background: #e3f2fd; color: #1976d2; }
        .status-review { background: #fff3e0; color: #f57c00; }
        .status-approved { background: #e8f5e8; color: #2e7d32; }
        .status-rejected { background: #ffebee; color: #c62828; }
        
        .document-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .document-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .document-actions {
            display: flex;
            gap: 10px;
        }
        
        .file-preview {
            max-width: 200px;
            max-height: 150px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        /* Responsive Styles */
        @media (max-width: 992px) {
            .about-content,
            .contact-container,
            .founder-container {
                flex-direction: column;
            }
            
            .process-steps {
                flex-direction: column;
                gap: 20px;
            }
            
            .hero-content h1 {
                font-size: 2.5rem;
            }
            
            .founder-image {
                order: -1;
            }
            
            .stats-container {
                flex-direction: column;
                gap: 40px;
            }
            
            .team-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .blog-grid,
            .facebook-feed {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .dashboard-container {
                flex-direction: column;
            }
            
            .dashboard-sidebar {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .mobile-toggle {
                display: flex;
            }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 80%;
                height: calc(100vh - 70px);
                background-color: var(--primary-white);
                flex-direction: column;
                padding: 40px 20px;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
                transition: left 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
                z-index: 1000;
                overflow-y: auto;
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-menu li {
                margin: 15px 0;
                width: 100%;
            }
            
            .nav-menu li a {
                display: block;
                padding: 10px 0;
                border-bottom: 1px solid #eee;
            }
            
            .dropdown-content {
                position: static;
                box-shadow: none;
                margin-left: 20px;
                margin-top: 10px;
                display: none;
                width: 100%;
            }
            
            .dropdown.active .dropdown-content {
                display: block;
            }
            
            .dropdown > a::after {
                content: ' ▼';
                font-size: 0.8em;
                float: right;
                margin-left: 5px;
            }
            
            /* Hero section adjustments for mobile */
            .hero {
                height: 80vh;
                min-height: 500px;
            }
            
            .hero-content h1 {
                font-size: 2rem;
                line-height: 1.3;
            }
            
            .hero-content p {
                font-size: 1rem;
                margin-bottom: 25px;
            }
            
            .hero-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .hero-buttons .btn {
                width: 100%;
                text-align: center;
            }
            
            .section {
                padding: 60px 0;
            }
            
            .section-title h2 {
                font-size: 2rem;
            }
            
            .blog-grid,
            .facebook-feed {
                grid-template-columns: 1fr;
            }
            
            .newsletter-form {
                flex-direction: column;
            }
            
            .newsletter-input {
                min-width: 100%;
            }
            
            .testimonials-container {
                flex-direction: column;
            }
            
            .team-grid {
                grid-template-columns: 1fr;
            }
            
            .portal-options {
                flex-direction: column;
                align-items: center;
            }
            
            .portal-option {
                width: 100%;
                max-width: 300px;
            }
            
            /* Fix for the live session button on mobile */
            .nav-menu li:last-child a {
                background-color: var(--primary-red);
                color: white;
                text-align: center;
                padding: 12px;
                border-radius: 4px;
                margin-top: 20px;
                border: none;
            }
            
            /* Improve dropdown handling on mobile */
            .dropdown-content {
                margin-left: 0;
                margin-top: 10px;
                padding-left: 15px;
            }
            
            .dropdown-content a {
                padding: 10px 15px;
                font-size: 0.95rem;
            }
        }
        
        /* Additional mobile fixes for very small screens */
@media (max-width: 480px) {
    .hero-content h1 {
        font-size: 1.8rem;
    }
    
    .mobile-toggle {
        font-size: 1.2rem;
    }
    
    .services-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .service-card {
        padding: 20px;
    }
    
    .form-control, .newsletter-input {
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .contact-form {
        padding: 20px;
    }
    
    .footer-container {
        flex-direction: column;
        gap: 30px;
    }
    
    .footer-col {
        min-width: 100%;
    }
    
    .social-links {
        justify-content: center;
    }
    
    /* === ADD THESE NEW LINES STARTING HERE === */
    /* ADD THESE LINES FOR BETTER MOBILE FORMS */
    input, select, textarea {
        font-size: 16px !important; /* Prevents iOS zoom */
    }
    
    /* Improve touch targets for mobile */
    .btn, .nav-menu li a, .mobile-toggle {
        min-height: 44px;
        min-width: 44px;
    }
    
    /* Better dropdown touch targets */
    .dropdown-content a {
        min-height: 44px;
        padding: 12px 16px;
    }
    /* === END OF NEW LINES === */
}
        
        /* Accessibility Improvements */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary-red);
            color: white;
            padding: 8px;
            z-index: 100;
            transition: top 0.3s;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Focus styles for accessibility */
        a:focus, button:focus, input:focus, textarea:focus, select:focus {
            outline: 2px solid var(--primary-red);
            outline-offset: 2px;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .plane {
                display: none;
            }
            
            .loading-logo img {
                animation: none;
            }
        }
        
        /* Image fallback styles */
        .image-fallback {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px;
            color: #666;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        .image-fallback i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-red);
        }
        
        .image-fallback p {
            font-size: 0.9rem;
        }
        
        /* Lazy loading for images */
        img {
            max-width: 100%;
            height: auto;
        }
        /* ==================== ENHANCED STYLES ==================== */

/* Enhanced Document Card Styles */
.document-header {
    text-align: center;
    margin-bottom: 15px;
}

.document-actions {
    display: flex;
    gap: 5px;
    margin-top: 10px;
    justify-content: center;
}

/* Status Badges */
.status-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
}

.status-approved { background: #e8f5e8; color: #2e7d32; }
.status-pending { background: #fff3e0; color: #f57c00; }
.status-rejected { background: #ffebee; color: #c62828; }
.status-missing { background: #f5f5f5; color: #666; }
.status-completed { background: #e8f5e8; color: #2e7d32; }
.status-in-progress { background: #e3f2fd; color: #1565c0; }

/* Enhanced Progress Bars */
.progress-bar {
    height: 10px;
    background-color: #eee;
    border-radius: 5px;
    margin: 10px 0;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background-color: var(--primary-red);
    border-radius: 5px;
    transition: width 0.5s ease;
}

/* Document List Styles */
.document-list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 10px;
}

.document-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    border-bottom: 1px solid #eee;
    transition: background-color 0.3s ease;
}

.document-item:hover {
    background-color: #f9f9f9;
}

.document-item:last-child {
    border-bottom: none;
}

/* Upload History Styles */
#uploadHistory {
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 10px;
    background: #fafafa;
}

/* Payment Status Styles */
.payment-status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-completed { background: #e8f5e8; color: #2e7d32; }
.status-pending { background: #fff3cd; color: #856404; }
.status-failed { background: #f8d7da; color: #721c24; }

/* Admin Styles */
.admin-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-label {
    color: #666;
    font-size: 0.9rem;
}

/* Responsive Improvements */
@media (max-width: 768px) {
    .documents-grid {
        grid-template-columns: 1fr;
    }
    
    .document-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .document-actions {
        width: 100%;
        justify-content: flex-start;
    }
    
    .admin-stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* Report Fraud Section */
.report-fraud {
    background-color: var(--primary-white);
}

.fraud-report-form {
    max-width: 800px;
    margin: 0 auto;
    background: var(--light-gray);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

/* Form Progress */
.form-progress {
    margin-bottom: 40px;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
}

.progress-step {
    text-align: center;
    flex: 1;
    position: relative;
}

.progress-step .step-indicator {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.progress-step.active .step-indicator {
    background: var(--primary-red);
    color: white;
}

.progress-step span {
    font-size: 0.9rem;
    color: var(--medium-gray);
}

.progress-step.active span {
    color: var(--dark-gray);
    font-weight: 600;
}

/* Form Steps */
.form-step {
    display: none;
}

.form-step.active {
    display: block;
}

.form-step h3 {
    margin-bottom: 25px;
    color: var(--dark-gray);
    border-bottom: 2px solid var(--primary-red);
    padding-bottom: 10px;
}

/* Form Layout */
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* Radio and Checkbox Styles */
.radio-group, .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.radio-option, .checkbox-option {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.radio-option:hover, .checkbox-option:hover {
    border-color: var(--primary-red);
    background: #fff0f0;
}

.radio-option input, .checkbox-option input {
    margin: 0;
}

.radio-checkmark, .checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid #ddd;
    border-radius: 50%;
    display: inline-block;
    position: relative;
}

.checkmark {
    border-radius: 4px;
}

.radio-option input:checked + .radio-checkmark::after {
    content: '';
    width: 10px;
    height: 10px;
    background: var(--primary-red);
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.checkbox-option input:checked + .checkmark {
    background: var(--primary-red);
    border-color: var(--primary-red);
}

.checkbox-option input:checked + .checkmark::after {
    content: '✓';
    color: white;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    font-weight: bold;
}

/* Amount Input */
.amount-input {
    display: flex;
    gap: 10px;
}

.currency-select {
    min-width: 100px;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 12px;
}

/* Character Counter */
.char-counter {
    text-align: right;
    font-size: 0.8rem;
    color: var(--medium-gray);
    margin-top: 5px;
}

/* Upload Section */
.upload-section {
    margin-bottom: 30px;
}

.upload-area {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #fafafa;
}

.upload-area:hover {
    border-color: var(--primary-red);
    background: #fff0f0;
}

.upload-area.dragover {
    border-color: var(--primary-red);
    background: #ffe6e6;
}

.upload-area i {
    font-size: 3rem;
    color: var(--primary-red);
    margin-bottom: 15px;
}

.upload-info {
    font-size: 0.9rem;
    color: var(--medium-gray);
    margin: 10px 0;
}

.file-previews {
    margin-top: 20px;
}

.file-preview {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    margin-bottom: 10px;
    background: white;
}

.file-preview-info {
    flex: 1;
}

.file-preview-name {
    font-weight: 500;
    margin-bottom: 5px;
}

.file-preview-size {
    font-size: 0.8rem;
    color: var(--medium-gray);
}

.file-preview-remove {
    background: var(--primary-red);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 0.8rem;
}

/* Review Summary */
.review-summary {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid var(--primary-red);
}

.review-item {
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.review-label {
    font-weight: 600;
    color: var(--dark-gray);
    margin-bottom: 5px;
}

.review-value {
    color: var(--medium-gray);
}

/* Legal Disclaimer */
.legal-disclaimer {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.disclaimer-warning {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    color: #856404;
}

.disclaimer-warning i {
    color: #ffc107;
}

.legal-consent {
    margin-top: 15px;
    padding: 15px;
    background: white;
    border-radius: 6px;
}

/* CAPTCHA Section */
.captcha-section {
    margin-bottom: 20px;
}

/* Form Navigation */
.form-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

/* Success Message */
.form-success {
    text-align: center;
    padding: 40px;
}

.form-success i {
    font-size: 4rem;
    color: #4CAF50;
    margin-bottom: 20px;
}

.form-success h3 {
    color: #4CAF50;
    margin-bottom: 20px;
}

.form-success ul {
    text-align: left;
    max-width: 400px;
    margin: 20px auto;
}

/* Responsive Design */
@media (max-width: 768px) {
    .fraud-report-form {
        padding: 20px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .progress-steps {
        flex-direction: column;
        gap: 15px;
    }
    
    .progress-step {
        text-align: left;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .amount-input {
        flex-direction: column;
    }
    
    .form-navigation {
        flex-direction: column;
        gap: 10px;
    }
    
    .form-navigation button {
        width: 100%;
    }
}
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-logo">
            <picture>
    <source srcset="GISC-LOGO.webp" type="image/webp">
    <source srcset="GISC-LOGO.png" type="image/png"> 
    <img src="GISC-LOGO.png" alt="Global Immigration SC Logo" onerror="this.onerror=null; this.style.display='none'; document.getElementById('logo-fallback').style.display='flex';">
</picture>
            <div id="logo-fallback" class="image-fallback" style="display: none;">
                <i class="fas fa-globe-americas"></i>
                <p>Global Immigration SC Logo</p>
            </div>
        </div>
        <div class="loading-text">Direction to Your Destination</div>
    </div>

    <!-- Live Session Modal -->
    <div id="liveSessionModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Join Our Live Session</h2>
            <div class="live-session-options">
                <div class="session-option" id="joinLive">
                    <h3>Join Our Live Stream</h3>
                    <p>Watch our current live session on YouTube</p>
                </div>
                <div class="session-option" id="registerSession">
                    <h3>Register for Upcoming Session</h3>
                    <p>Get notified about our next live session</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Session Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Register for Upcoming Session</h2>
            <form id="sessionForm" action="https://formspree.io/f/mrbaejkr" method="POST">
                <div class="form-group">
                    <label for="sessionName">Full Name *</label>
                    <input type="text" id="sessionName" name="name" class="form-control" required>
                    <div class="form-error" id="sessionNameError">Please enter your full name</div>
                </div>
                
                <div class="form-group">
                    <label for="sessionEmail">Email Address *</label>
                    <input type="email" id="sessionEmail" name="email" class="form-control" required>
                    <div class="form-error" id="sessionEmailError">Please enter a valid email address</div>
                </div>
                
                <div class="form-group">
                    <label for="notifyMe" style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="notifyMe" name="notify" value="yes" checked>
                        Notify me when the session starts
                    </label>
                </div>
                
                <input type="hidden" name="form_type" value="session_registration">
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span class="btn-text">Send Registration</span>
                    <span class="loading-spinner" style="display: none;"></span>
                </button>
                
                <div id="sessionSuccess" class="form-success">
                    Thank you for registering! We will notify you when our next session starts.
                </div>
            </form>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="close-modal">&times;</span>
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="register">Register</div>
            </div>
            
            <form id="loginForm" class="auth-form active" action="https://formspree.io/f/mrbaejkr" method="POST">
                <div class="form-group">
                    <label for="loginEmail">Email Address *</label>
                    <input type="email" id="loginEmail" name="email" class="form-control" required>
                    <div class="form-error" id="loginEmailError">Please enter a valid email address</div>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password *</label>
                    <input type="password" id="loginPassword" name="password" class="form-control" required>
                    <div class="form-error" id="loginPasswordError">Please enter your password</div>
                </div>
                
                <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                    <label for="rememberMe" style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="rememberMe" name="remember" value="yes">
                        Remember me
                    </label>
                    <a href="#" id="forgotPassword" style="color: var(--primary-red);">Forgot Password?</a>
                </div>
                
                <input type="hidden" name="form_type" value="login">
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span class="btn-text">Login</span>
                    <span class="loading-spinner" style="display: none;"></span>
                </button>
            </form>
            
            <form id="registerForm" class="auth-form" action="https://formspree.io/f/mrbaejkr" method="POST">
                <div class="form-group">
                    <label for="registerName">Full Name *</label>
                    <input type="text" id="registerName" name="name" class="form-control" required>
                    <div class="form-error" id="registerNameError">Please enter your full name</div>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">Email Address *</label>
                    <input type="email" id="registerEmail" name="email" class="form-control" required>
                    <div class="form-error" id="registerEmailError">Please enter a valid email address</div>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Password *</label>
                    <input type="password" id="registerPassword" name="password" class="form-control" required>
                    <div class="password-strength">
                        <div class="password-strength-bar"></div>
                    </div>
                    <div class="password-strength-text"></div>
                    <div class="form-error" id="registerPasswordError">Please enter a strong password</div>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password *</label>
                    <input type="password" id="confirmPassword" name="confirm_password" class="form-control" required>
                    <div class="form-error" id="confirmPasswordError">Passwords do not match</div>
                </div>
                
                <div class="form-group">
                    <label for="agreeTerms" style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="agreeTerms" name="agree_terms" value="yes" required>
                        I agree to the <a href="#" style="color: var(--primary-red);">Terms of Service</a> and <a href="#" style="color: var(--primary-red);">Privacy Policy</a>
                    </label>
                    <div class="form-error" id="agreeTermsError">You must agree to the terms and conditions</div>
                </div>
                
                <input type="hidden" name="form_type" value="registration">
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span class="btn-text">Create Account</span>
                    <span class="loading-spinner" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header>
        <div class="header-container container">
            <div class="logo">
                <picture>
    <source srcset="GISC-LOGO.webp" type="image/webp">
    <source srcset="GISC-LOGO.png" type="image/png"> 
    <img src="GISC-LOGO.png" alt="Global Immigration SC Logo" onerror="this.onerror=null; this.style.display='none'; document.getElementById('header-logo-fallback').style.display='flex';">
</picture>
                <div id="header-logo-fallback" class="image-fallback" style="display: none;">
                    <i class="fas fa-globe-americas"></i>
                    <p>Global Immigration SC</p>
                </div>
            </div>
            
            <div class="mobile-toggle" aria-label="Toggle navigation menu">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </div>
            
            <nav aria-label="Main navigation">
                <ul class="nav-menu">
                    <li><a href="#home">Home</a></li>
                    <li><a href="#about">About Us</a></li>
                    <li class="dropdown">
                        <a href="#services">Services <i class="fas fa-chevron-down" aria-hidden="true"></i></a>
                        <div class="dropdown-content">
                            <a href="#">Business Trip Visa Application & Planning</a>
                            <a href="#">Study Abroad Admissions & Scholarship Support</a>
                            <a href="#">Visa Application & Embassy Interview Coaching</a>
                            <a href="#">Work & Immigration Assistance</a>
                            <a href="#">Student Loan & Sponsorship</a>
                            <a href="#">Flight, Hotel & Accommodation Booking</a>
                            <a href="#">Relocation Support & Document Translation</a>
                            <a href="#">Travel Insurance & Medical Clearance</a>
                            <a href="#">Educational & Cultural Exchange Programs</a>
                            <a href="#">Pre-Departure Orientation & Airport Pickup</a>
                        </div>
                    </li>
                    <li><a href="#destinations">Destinations</a></li>
                    <li><a href="#blog">Blog</a></li>
                    <li><a href="#application-portal">Application Portal</a></li>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#" class="btn btn-live" id="liveSessionBtn"><i class="fas fa-video" aria-hidden="true"></i> Watch Our Live Session</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="plane-container" aria-hidden="true">
            <div class="plane"></div>
            <div class="plane"></div>
            <div class="plane"></div>
        </div>
        
        <div class="hero-content">
            <h1>Global Immigration SC – Your Trusted Travel & Study Partner</h1>
            <p>We help students, professionals, and travelers achieve their global dreams with end-to-end immigration and study abroad solutions.</p>
            <div class="hero-buttons">
                <a href="https://docs.google.com/forms/d/1HUsRbKHsZlZKL7T2DgT7crgAhkAnuslmWjopUD2Cutg/edit" class="btn btn-primary">Book Appointment</a>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-outline">Start Application</a>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main id="main-content">
        <!-- About Section -->
        <section id="about" class="section about">
            <div class="container">
                <div class="about-content">
                    <div class="about-text">
                        <h2>About Global Immigration SC</h2>
                        <p>At Global Immigration SC, we guide you step by step – from admission and visa applications to travel, relocation and settlement.</p>
                        <p>With years of expertise in immigration consulting, we've helped hundreds of clients achieve their dreams of studying, working, and traveling abroad. Our team of experienced consultants provides personalized support throughout your journey.</p>
                        <p>We pride ourselves on our transparent processes, ethical practices, and commitment to your success. Your global journey is our priority.</p>
                    </div>
                    <div class="about-image">
                        <picture>
    <source srcset="IMAGES.webp" type="image/webp">
    <source srcset="IMAGES.jpg" type="image/jpeg"> 
    <img src="IMAGES.jpg" alt="Diverse group of immigrants and professionals working together at a table" onerror="this.onerror=null; this.style.display='none'; document.getElementById('about-fallback').style.display='flex';">
</picture>
                        <div id="about-fallback" class="image-fallback" style="display: none;">
                            <i class="fas fa-users"></i>
                            <p>Our diverse team of professionals</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="stats">
            <div class="container">
                <div class="stats-container">
                    <div class="stat-item">
                        <div class="stat-number" id="clients">500+</div>
                        <div class="stat-label">Happy Clients</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="success">98%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="countries">80+</div>
                        <div class="stat-label">Countries</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="experience">10+</div>
                        <div class="stat-label">Years Experience</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="section services">
            <div class="container">
                <div class="section-title">
                    <h2>Our Full-Service Offers</h2>
                    <p>Comprehensive immigration and study abroad services to meet all your needs</p>
                </div>
                
                <div class="services-grid">
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-briefcase" aria-hidden="true"></i>
                        </div>
                        <h3>Business Trip Visa Application & Planning</h3>
                        <p>Professional visa services for business travelers and corporate clients with expedited processing options.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-graduation-cap" aria-hidden="true"></i>
                        </div>
                        <h3>Study Abroad Admissions & Scholarship Support</h3>
                        <p>Guidance through university applications and scholarship opportunities with 95% acceptance rate.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-passport" aria-hidden="true"></i>
                        </div>
                        <h3>Visa Application & Embassy Interview Coaching</h3>
                        <p>Complete visa processing and interview preparation services with mock interview sessions.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-building" aria-hidden="true"></i>
                        </div>
                        <h3>Work & Immigration Assistance</h3>
                        <p>Support with work permits and permanent residency applications for skilled professionals.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-hand-holding-usd" aria-hidden="true"></i>
                        </div>
                        <h3>Student Loan & Sponsorship</h3>
                        <p>Assistance with MPOWER, SOFI, and other financing options with high approval rates.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-hotel" aria-hidden="true"></i>
                        </div>
                        <h3>Flight, Hotel & Accommodation Booking</h3>
                        <p>Travel and accommodation arrangements for your relocation with exclusive partner discounts.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-people-carry" aria-hidden="true"></i>
                        </div>
                        <h3>Relocation Support & Document Translation</h3>
                        <p>Comprehensive relocation services and certified document translation in 24+ languages.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-heartbeat" aria-hidden="true"></i>
                        </div>
                        <h3>Travel Insurance & Medical Clearance</h3>
                        <p>Health insurance and medical examination coordination with recognized healthcare providers.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                        </div>
                        <h3>Educational & Cultural Exchange Programs</h3>
                        <p>Opportunities for cultural exchange and international education with 50+ partner institutions.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                    
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-plane-departure" aria-hidden="true"></i>
                        </div>
                        <h3>Pre-Departure Orientation & Airport Pickup</h3>
                        <p>Preparation sessions and arrival assistance at your destination with local support teams.</p>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeWRMWtwbyzkyOp0D5LNrRdef4v4pvIX0Ki0JS62bE0u1tqSA/viewform?pli=1" class="btn btn-primary btn-small">Apply Now</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Application Portal Section -->
        <section id="application-portal" class="section application-portal">
            <div class="container">
                <div class="section-title">
                    <h2>Application Portal</h2>
                    <p>Access your application dashboard to track progress, upload documents, and manage your immigration journey</p>
                </div>
                
                <div class="portal-options">
                    <div class="portal-option">
                        <div class="portal-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3>New Applicants</h3>
                        <p>Create a new account to start your application process</p>
                        <a href="#" class="btn btn-primary" id="registerBtn">Register</a>
                    </div>
                    
                    <div class="portal-option">
                        <div class="portal-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <h3>Returning Applicants</h3>
                        <p>Login to your existing account to continue your application</p>
                        <a href="#" class="btn btn-outline" id="loginBtn">Login</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Destinations Section -->
        <section id="destinations" class="section destinations">
            <div class="container">
                <div class="section-title">
                    <h2>Destinations We Serve</h2>
                    <p>We provide immigration and study services for these popular destinations</p>
                </div>
                
                <div class="flags-container">
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="United States flag">🇺🇸</div>
                        <div class="country-name">USA</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Canada flag">🇨🇦</div>
                        <div class="country-name">Canada</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Switzerland flag">🇨🇭</div>
                        <div class="country-name">Switzerland</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Sweden flag">🇸🇪</div>
                        <div class="country-name">Sweden</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Australia flag">🇦🇺</div>
                        <div class="country-name">Australia</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Ireland flag">🇮🇪</div>
                        <div class="country-name">Ireland</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Austria flag">🇦🇹</div>
                        <div class="country-name">Austria</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Finland flag">🇫🇮</div>
                        <div class="country-name">Finland</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="Germany flag">🇩🇪</div>
                        <div class="country-name">Germany</div>
                    </div>
                    
                    <div class="country-flag">
                        <div class="flag-icon" aria-label="United Arab Emirates flag">🇦🇪</div>
                        <div class="country-name">UAE</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Process Section -->
        <section class="section process">
            <div class="container">
                <div class="section-title">
                    <h2>How It Works</h2>
                    <p>Our simple 3-step process to make your global dreams a reality</p>
                </div>
                
                <div class="process-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>Consultation & Application</h3>
                        <p>We begin with a detailed consultation to understand your goals, then guide you through the application process.</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Document Preparation & Embassy Coaching</h3>
                        <p>We help prepare all necessary documents and provide coaching for embassy interviews.</p>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3>Visa Approval & Relocation Support</h3>
                        <p>After visa approval, we assist with travel arrangements, accommodation, and settling into your new country.</p>
                    </div>
                </div>
            </div>
        </section>

         <!-- Testimonials Section -->
<section class="section testimonials">
    <div class="container">
        <div class="section-title">
            <h2>Success Stories</h2>
            <p>Hear from our satisfied clients who have achieved their global dreams</p>
        </div>
        
        <div class="testimonials-container">
            <div class="testimonial">
                <p class="testimonial-text">"Global Immigration SC made my study abroad dream come true. Their guidance through the university application and visa process was invaluable. I'm now studying at the University of Toronto with a 100% scholarship thanks to their expertise!"</p>
                <div class="testimonial-author">
                    <div class="author-image">
                        <img src="https://i.ibb.co/SXXJzhnT/Gemini-Generated-Image-l3odzyl3odzyl3od-1.png" alt="Fatima Adebayo - Student at University of Toronto" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='FA';">
                    </div>
                    <div class="author-details">
                        <h4>Fatima Adebayo</h4>
                        <p>Student at University of Toronto, Canada</p>
                    </div>
                </div>
            </div>
            
            <div class="testimonial">
                <p class="testimonial-text">"The team at Global Immigration SC provided exceptional support with my work visa application. Their attention to detail and knowledge of the process made everything smooth and stress-free. I received my Australian work visa in just 6 weeks!"</p>
                <div class="testimonial-author">
                    <div class="author-image">
                        <img src="https://i.ibb.co/GvkTSGNw/Gemini-Generated-Image-3zry3q3zry3q3zry.png" alt="Kwame Osei - Software Engineer in Australia" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='KO';">
                    </div>
                    <div class="author-details">
                        <h4>Sarah Okoro</h4>
                        <p>Software Engineer in Sydney, Australia</p>
                    </div>
                </div>
            </div>

            <div class="testimonial">
                <p class="testimonial-text">"As a Liberian student, I was worried about the visa process. Global Immigration SC guided me through every step and helped me secure my UK student visa on the first attempt. I'm now pursuing my Master's at London School of Economics!"</p>
                <div class="testimonial-author">
                    <div class="author-image">
                        <img src="https://i.ibb.co/WWLWR3HC/Gemini-Generated-Image-usumlgusumlgusum.png" alt="Sarah Okoro - Graduate Student at LSE" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='SO';">
                    </div>
                    <div class="author-details">
                        <h4>Richard Kollie</h4>
                        <p>Graduate Student at LSE, UK</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

        <!-- Blog Preview Section -->
        <section id="blog" class="section blog-preview">
            <div class="container">
                <div class="section-title">
                    <h2>Latest From Our Blog</h2>
                    <p>Helpful resources and updates on immigration policies and study abroad opportunities</p>
                </div>
                
                <div class="blog-grid" id="dynamic-blog-container">
                    <!-- Blog posts will be dynamically loaded here from localStorage -->
                </div>
                
                <div style="text-align: center; margin-top: 40px;">
                    <a href="https://www.facebook.com/share/16ZuMVLV3g/?mibextid=wwXIfr" class="btn btn-primary" target="_blank" rel="noopener noreferrer">View All Posts on Facebook</a>
                </div>
            </div>
        </section>

        <!-- Founder Section -->
<section class="section founder">
    <div class="container">
        <div class="founder-container">
            <div class="founder-image">
                <img src="https://i.ibb.co/4RHYCswn/Founder.jpg" alt="Darlington F Tamba - Founder of Global Immigration SC">
            </div>
            <div class="founder-content">
                <h2>Message From Our Founder</h2>
                <h3>Darlington F Tamba</h3>
                <p>"At Global Immigration SC, we believe that everyone deserves the opportunity to pursue their dreams on a global stage. Our mission is to break down barriers and make international education and immigration accessible to all."</p>
                <p>"Having navigated the complex immigration process myself, I understand the challenges our clients face. That's why we've built a team of dedicated professionals who are committed to providing personalized guidance and support every step of the way."</p>
                <p>"Your success is our success. When you achieve your dreams of studying or working abroad, we celebrate with you. We're not just an immigration service – we're your partners in building a brighter future."</p>
                <div class="founder-signature">- Darlington F Tamba, Founder & CEO</div>
            </div>
        </div>
    </div>
</section>

       <!-- Team Section -->
<section class="section team">
    <div class="container">
        <div class="section-title">
            <h2>Meet Our Team</h2>
            <p>Our dedicated professionals are committed to your success</p>
        </div>
        
        <div class="team-grid">
            <!-- Stephen V. Shilue -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-user-tie"></i>
                        <p>Stephen V. Shilue</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">Stephen V. Shilue</h3>
                    <p class="team-position">Co-founder and Chief Operating Officer</p>
                    <p class="team-description">Experienced operations leader with expertise in international education and immigration processes.</p>
                </div>
            </div>
            
            <!-- Cyrus J. Harmon -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-user-graduate"></i>
                        <p>Cyrus J. Harmon</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">Cyrus J. Harmon</h3>
                    <p class="team-position">India International Applicants Counselor</p>
                    <p class="team-description">Specializes in reviewing applications and ensuring compliance with international standards for India Travel process.</p>
                </div>
            </div>
            
            <!-- Amos Momo Ngumbu Jr. -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-passport"></i>
                        <p>Amos Momo Ngumbu Jr</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">Amos Momo Ngumbu Jr.</h3>
                    <p class="team-position">USA Representative Application Review Consultant</p>
                    <p class="team-description">Expert in visa documentation and interview preparation with a 98% success rate.</p>
                </div>
            </div>
            
            <!-- H. Evans Dorbor Jr. -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-globe-americas"></i>
                        <p>H. Evans Dorbor Jr</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">H. Evans Dorbor Jr.</h3>
                    <p class="team-position">Hungary Representative & International Consultant</p>
                    <p class="team-description">Provides Filing & guidance on Hungary study abroad programs and cultural adaptation for international students.</p>
                </div>
            </div>
            
            <!-- Michael Ojo -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-plane"></i>
                        <p>Michael Ojo</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">Michael Ojo</h3>
                    <p class="team-position">International Agent</p>
                    <p class="team-description">Specializes in African markets with extensive knowledge of visa processes for African students.</p>
                </div>
            </div>
            
            <!-- David Chukwu -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-hands-helping"></i>
                        <p>David Chuckwu</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">David Chukwu</h3>
                    <p class="team-position">International Agent</p>
                    <p class="team-description">Focuses on student recruitment and scholarship opportunities for African applicants.</p>
                </div>
            </div>
            
            <!-- Robert Smith -->
            <div class="team-member">
                <div class="team-image">
                    <div class="image-fallback">
                        <i class="fas fa-briefcase"></i>
                        <p>Robert Smith</p>
                    </div>
                </div>
                <div class="team-details">
                    <h3 class="team-name">Robert Smith</h3>
                    <p class="team-position">International Agent</p>
                    <p class="team-description">Expert in work visas and immigration processes for professionals seeking opportunities abroad.</p>
                </div>
            </div>
        </div>
    </div>
</section>

        <!-- Newsletter Section -->
        <section class="section newsletter">
            <div class="container">
                <div class="section-title">
                    <h2>Stay Informed With Our Updates</h2>
                    <p>Subscribe to our newsletter for the latest immigration news, visa updates, and exclusive tips</p>
                </div>
                
                <div class="newsletter-content">
                    <form id="newsletterForm" class="newsletter-form" action="https://formspree.io/f/mrbaejkr" method="POST">
                        <input type="email" name="email" class="newsletter-input" placeholder="Enter your email address" required>
                        <input type="hidden" name="form_type" value="newsletter_subscription">
                        <button type="submit" class="btn btn-primary">Subscribe Now</button>
                    </form>
                    <p style="margin-top: 15px; color: var(--medium-gray); font-size: 0.9rem; text-align: center;">
                        We respect your privacy. You can unsubscribe at any time.
                    </p>
                </div>
                
                <div id="newsletterSuccess" class="form-success" style="display: none; margin-top: 20px;">
                    Thank you for subscribing! Please check your email to confirm your subscription.
                </div>
            </div>
        </section>

        <!-- Report Fraud Section -->
<section id="report-fraud" class="section report-fraud">
    <div class="container">
        <div class="section-title">
            <h2>REPORT IT — Report Travel/Immigration Fraud</h2>
            <p>If you suspect a travel or visa scam, report it here with your evidence. All reports are reviewed confidentially. <strong>False accusations are illegal and may result in legal action.</strong></p>
            <p style="font-size: 0.9rem; margin-top: 10px;">
                <a href="#privacy-policy" style="color: var(--primary-red);">Privacy Policy & Legal Terms</a>
            </p>
        </div>

        <!-- Multi-step Form -->
        <div class="fraud-report-form">
            <!-- Progress Steps -->
            <div class="form-progress">
                <div class="progress-steps">
                    <div class="progress-step active" data-step="1">
                        <div class="step-indicator">1</div>
                        <span>Basic Info</span>
                    </div>
                    <div class="progress-step" data-step="2">
                        <div class="step-indicator">2</div>
                        <span>Incident Details</span>
                    </div>
                    <div class="progress-step" data-step="3">
                        <div class="step-indicator">3</div>
                        <span>Evidence</span>
                    </div>
                    <div class="progress-step" data-step="4">
                        <div class="step-indicator">4</div>
                        <span>Review & Submit</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 25%;"></div>
                </div>
            </div>

            <!-- Step 1: Basic Information -->
            <div class="form-step active" id="step-1">
                <h3>Your Information</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="reporterName">Full Name *</label>
                        <input type="text" id="reporterName" name="reporterName" class="form-control" required>
                        <div class="form-error" id="reporterNameError">Please enter your full name</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reporterEmail">Email Address *</label>
                        <input type="email" id="reporterEmail" name="reporterEmail" class="form-control" required>
                        <div class="form-error" id="reporterEmailError">Please enter a valid email address</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reporterPhone">Phone / WhatsApp</label>
                        <input type="tel" id="reporterPhone" name="reporterPhone" class="form-control">
                        <div class="form-error" id="reporterPhoneError">Please enter a valid phone number</div>
                    </div>
                    
                    <div class="form-group">
                        <label>Preferred Contact Method *</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="contactMethod" value="email" required>
                                <span class="radio-checkmark"></span>
                                Email
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="contactMethod" value="whatsapp">
                                <span class="radio-checkmark"></span>
                                WhatsApp
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="contactMethod" value="phone">
                                <span class="radio-checkmark"></span>
                                Phone Call
                            </label>
                        </div>
                        <div class="form-error" id="contactMethodError">Please select preferred contact method</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-option">
                        <input type="checkbox" id="anonymousReport">
                        <span class="checkbox-checkmark"></span>
                        I wish to remain anonymous (your name will be hidden from public outputs)
                    </label>
                </div>
                
                <div class="form-navigation">
                    <button type="button" class="btn btn-primary next-step" data-next="2">Next: Incident Details</button>
                </div>
            </div>

            <!-- Step 2: Incident Details -->
            <div class="form-step" id="step-2">
                <h3>Incident Details</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="incidentCountry">Country of Incident *</label>
                        <select id="incidentCountry" name="incidentCountry" class="form-control" required>
                            <option value="">Select Country</option>
                            <option value="usa">United States</option>
                            <option value="canada">Canada</option>
                            <option value="uk">United Kingdom</option>
                            <option value="australia">Australia</option>
                            <option value="germany">Germany</option>
                            <option value="liberia">Liberia</option>
                            <option value="ghana">Ghana</option>
                            <option value="nigeria">Nigeria</option>
                            <option value="other">Other</option>
                        </select>
                        <div class="form-error" id="incidentCountryError">Please select country</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="incidentCity">City / Location</label>
                        <input type="text" id="incidentCity" name="incidentCity" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="suspectName">Suspected Agency/Person Name *</label>
                    <input type="text" id="suspectName" name="suspectName" class="form-control" required>
                    <div class="form-error" id="suspectNameError">Please enter the name of suspected agency/person</div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="suspectWebsite">Suspected Agency Website/Social Links</label>
                        <input type="url" id="suspectWebsite" name="suspectWebsite" class="form-control" placeholder="https://">
                    </div>
                    
                    <div class="form-group">
                        <label for="suspectContact">Suspect Contact Info (phone/email)</label>
                        <input type="text" id="suspectContact" name="suspectContact" class="form-control">
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="incidentDateFrom">Incident Start Date *</label>
                        <input type="date" id="incidentDateFrom" name="incidentDateFrom" class="form-control" required>
                        <div class="form-error" id="incidentDateFromError">Please select start date</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="incidentDateTo">Incident End Date (if ongoing, leave blank)</label>
                        <input type="date" id="incidentDateTo" name="incidentDateTo" class="form-control">
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="amountPaid">Amount Paid (if any)</label>
                        <div class="amount-input">
                            <select id="currency" name="currency" class="currency-select">
                                <option value="USD">USD</option>
                                <option value="LRD">LRD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                            </select>
                            <input type="number" id="amountPaid" name="amountPaid" class="form-control" min="0" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Payment Method(s)</label>
                        <div class="checkbox-group">
                            <label class="checkbox-option">
                                <input type="checkbox" name="paymentMethod" value="bank_transfer">
                                <span class="checkbox-checkmark"></span>
                                Bank Transfer
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" name="paymentMethod" value="mobile_money">
                                <span class="checkbox-checkmark"></span>
                                Mobile Money
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" name="paymentMethod" value="cash">
                                <span class="checkbox-checkmark"></span>
                                Cash
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" name="paymentMethod" value="card">
                                <span class="checkbox-checkmark"></span>
                                Card
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" name="paymentMethod" value="other">
                                <span class="checkbox-checkmark"></span>
                                Other
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-navigation">
                    <button type="button" class="btn btn-outline prev-step" data-prev="1">Previous</button>
                    <button type="button" class="btn btn-primary next-step" data-next="3">Next: Evidence</button>
                </div>
            </div>

            <!-- Step 3: Evidence Upload -->
            <div class="form-step" id="step-3">
                <h3>Evidence & Details</h3>
                
                <div class="form-group">
                    <label for="complaintSummary">Short Summary of Complaint *</label>
                    <textarea id="complaintSummary" name="complaintSummary" class="form-control" maxlength="1000" required placeholder="Brief summary of what happened (max 1000 characters)"></textarea>
                    <div class="char-counter"><span id="summaryChars">0</span>/1000 characters</div>
                    <div class="form-error" id="complaintSummaryError">Please provide a summary</div>
                </div>
                
                <div class="form-group">
                    <label for="detailedDescription">Detailed Description & Timeline *</label>
                    <textarea id="detailedDescription" name="detailedDescription" class="form-control" maxlength="3000" required placeholder="Detailed timeline and description of events (max 3000 characters)"></textarea>
                    <div class="char-counter"><span id="descriptionChars">0</span>/3000 characters</div>
                    <div class="form-error" id="detailedDescriptionError">Please provide detailed description</div>
                </div>
                
                <div class="form-group">
                    <label for="witnesses">Witnesses (names & contacts)</label>
                    <textarea id="witnesses" name="witnesses" class="form-control" placeholder="List any witnesses with their contact information"></textarea>
                </div>
                
                <!-- File Upload Area -->
                <div class="form-group">
                    <label>Upload Evidence * <small>(Required - screenshots, receipts, contracts, etc.)</small></label>
                    <div class="upload-area evidence-upload" id="evidenceUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>Drop files here or click to upload</h4>
                        <p>Supported formats: JPG, PNG, PDF, DOC, DOCX, XLSX, MP4 (max 20MB per file, 100MB total)</p>
                        <p><small>Videos must be under 60 seconds. All files are virus-scanned.</small></p>
                        <input type="file" id="evidenceFiles" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.xlsx,.mp4" style="display: none;">
                        <div class="upload-progress">
                            <div class="upload-progress-bar" id="evidenceProgress"></div>
                        </div>
                    </div>
                    <div class="file-previews" id="filePreviews"></div>
                    <div class="form-error" id="evidenceError">Please upload at least one evidence file</div>
                </div>
                
                <div class="form-navigation">
                    <button type="button" class="btn btn-outline prev-step" data-prev="2">Previous</button>
                    <button type="button" class="btn btn-primary next-step" data-next="4">Next: Review & Submit</button>
                </div>
            </div>

            <!-- Step 4: Review & Submit -->
            <div class="form-step" id="step-4">
                <h3>Review & Submit</h3>
                
                <div class="review-section">
                    <h4>Please review your report</h4>
                    <div id="reviewContent"></div>
                </div>
                
                <!-- Legal Disclaimer -->
                <div class="legal-disclaimer">
                    <div class="disclaimer-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>LEGAL DISCLAIMER</strong>
                    </div>
                    <p>Only genuine cases of fraudulent acts should be reported. Filing false reports or falsely accusing others is a criminal offense and may result in legal action against the reporter. By submitting this form you confirm the accuracy of your report and consent to GISC storing and processing this information for investigation and legal referral purposes.</p>
                </div>
                
                <!-- Consent Checkbox -->
                <div class="form-group">
                    <label class="checkbox-option required">
                        <input type="checkbox" id="legalConsent" name="legalConsent" required>
                        <span class="checkbox-checkmark"></span>
                        I confirm the information I submit is true to the best of my knowledge. I understand false reporting may lead to legal action. *
                    </label>
                    <div class="form-error" id="legalConsentError">You must agree to continue</div>
                </div>

<!-- SIMPLE CAPTCHA ALTERNATIVE -->
<div class="form-group">
    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
        <p><strong>Security Check</strong></p>
        <p>To prove you're human, please type "I AM HUMAN" in the box below:</p>
        <input type="text" id="humanVerification" class="form-control" placeholder="Type: I AM HUMAN" style="text-align: center; max-width: 200px; margin: 0 auto;">
        <div class="form-error" id="captchaError" style="display: none;">Please type "I AM HUMAN" exactly as shown</div>
    </div>
</div>

<!-- === ADD THE MISSING SUBMIT BUTTON HERE === -->
<div class="form-navigation">
    <button type="button" class="btn btn-outline prev-step" data-prev="3">Previous</button>
    <button type="button" class="btn btn-primary" id="submitReport">
        <span class="btn-text">Submit Report</span>
        <span class="loading-spinner" style="display: none;"></span>
    </button>
</div>
        <!-- Success Message (Hidden by default) -->
<div id="reportSuccess" class="form-success" style="display: none;">
    <div class="success-content">
        <i class="fas fa-check-circle"></i>
        <h3>Report Submitted Successfully!</h3>
        <p>Your report <strong id="successReportId">[Report ID]</strong> has been received.</p>
        <p>We are reviewing your submission and will keep you updated. If legal action is needed, we will contact you for next steps.</p>
        <div class="success-details">
            <p><strong>What to expect:</strong></p>
            <ul>
                <li>Acknowledgement within 48 hours</li>
                <li>Initial review within 5-14 business days</li>
                <li>Updates via your preferred contact method</li>
            </ul>
        </div>
        <div class="contact-info">
            <p><strong>For urgent matters:</strong></p>
            <p>WhatsApp: +231 770562292 | Email: infoglobalimmigrationsc@gmail.com</p>
        </div>
        <button class="btn btn-outline" onclick="resetReportForm()">Submit Another Report</button>
    </div>
</div>
</section>

        <!-- Contact Section -->
        <section id="contact" class="section contact">
            <div class="container">
                <div class="section-title">
                    <h2>Contact Us</h2>
                    <p>Get in touch with our team for personalized immigration consultation</p>
                </div>
                
                <div class="contact-container">
                    <div class="contact-info">
                        <h3>Our Head Office</h3>
                        
                        <div class="contact-details">
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="contact-text">
                                    Monrovia Liberia. P.O.BOX 1000 
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-phone-alt"></i>
                                </div>
                                <div class="contact-text">
                                    +231886590302<br>
                                    +231770562292<br>
                                    +231772876644
                                </div>
                            </div>
                            
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="contact-text">
                                    ceo@globalimmigrationsclr.com<br>
                                    infoglobalimmigrationsc@gmail.com
                                </div>
                            </div>
                        </div>
                        
                        <div class="office-hours">
                            <h4>Office Hours</h4>
                            <table class="hours-table">
                                <tr>
                                    <td>Monday</td>
                                    <td>9:00 AM - 5:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Tuesday</td>
                                    <td>9:00 AM - 5:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Wednesday</td>
                                    <td>9:00 AM - 3:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Thursday</td>
                                    <td>9:00 AM - 5:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Friday</td>
                                    <td>9:00 AM - 5:00 PM</td>
                                </tr>
                                <tr>
                                    <td>Saturday</td>
                                    <td>Emergency Only</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="hero-buttons" style="justify-content: flex-start; margin-top: 30px;">
                            <a href="https://www.google.com/maps/place/Monrovia,+Liberia" class="btn btn-primary" style="margin-right: 15px;">Visit Our Office</a>
                            <a href="https://wa.me/231886590302" class="btn btn-outline">Chat on WhatsApp</a>
                        </div>
                    </div>
                    
                    <div class="contact-form">
                        <h3>Send us a Message</h3>
                        <form id="inquiryForm" action="https://formspree.io/f/mrbaejkr" method="POST">
                            <div class="form-group">
                                <label for="name">Full Name *</label>
                                <input type="text" id="name" name="name" class="form-control" required>
                                <div class="form-error" id="nameError">Please enter your full name</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" class="form-control" required>
                                <div class="form-error" id="emailError">Please enter a valid email address</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" class="form-control" required>
                                <div class="form-error" id="phoneError">Please enter a valid phone number</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="country">Country of Interest *</label>
                                <select id="country" name="country" class="form-control" required>
                                    <option value="">Select a country</option>
                                    <option value="usa">United States</option>
                                    <option value="canada">Canada</option>
                                    <option value="australia">Australia</option>
                                    <option value="germany">Germany</option>
                                    <option value="sweden">Sweden</option>
                                    <option value="switzerland">Switzerland</option>
                                    <option value="uae">UAE</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="form-error" id="countryError">Please select a country</div>
                            </div>
                            
                            <div class="form-group">
                                <label>I'm interested in: *</label>
                                <div style="display: flex; gap: 15px; margin-top: 8px;">
                                    <div style="display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" id="study" name="interest" value="study" required>
                                        <label for="study" style="display: inline;">Study</label>
                                    </div>
                                    
                                    <div style="display: flex; align-items: center; gap: 5px;">
                                        <input type="radio" id="work" name="interest" value="work">
                                        <label for="work" style="display: inline;">Work</label>
                                    </div>
                                    
                                    <div style="display: flex; align-items; center; gap: 5px;">
                                        <input type="radio" id="travel" name="interest" value="travel">
                                        <label for="travel" style="display: inline;">Travel</label>
                                    </div>
                                </div>
                                <div class="form-error" id="interestError">Please select an option</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="message">Message *</label>
                                <textarea id="message" name="message" class="form-control" required></textarea>
                                <div class="form-error" id="messageError">Please enter your message</div>
                            </div>
                            
                            <input type="hidden" name="form_type" value="contact_form">
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <span class="btn-text">Submit Inquiry</span>
                                <span class="loading-spinner" style="display: none;"></span>
                            </button>
                            
                            <div id="formSuccess" class="form-success">
                                Thank you for your inquiry! We will contact you shortly.
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-container">
                <div class="footer-col">
                    <h3>Global Immigration SC</h3>
                    <p>Your trusted partner for immigration and study abroad solutions. We're committed to making your global dreams a reality.</p>
                    <p>Sponsored by <strong>Motiva Corporation Group of Companies</strong></p>
                </div>
                
                <div class="footer-col">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#home">Home</a></li>
                        <li><a href="#about">About Us</a></li>
                        <li><a href="#services">Services</a></li>
                        <li><a href="#destinations">Destinations</a></li>
                        <li><a href="#blog">Blog</a></li>
                        <li><a href="#application-portal">Application Portal</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h3>Services</h3>
                    <ul class="footer-links">
                        <li><a href="#">Study Abroad</a></li>
                        <li><a href="#">Visa Application</a></li>
                        <li><a href="#">Work Immigration</a></li>
                        <li><a href="#">Travel Arrangements</a></li>
                        <li><a href="#">Relocation Support</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h3>Connect With Us</h3>
                    <div class="social-links">
                        <a href="https://www.facebook.com/share/1CT6ZQ1p5S/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://www.instagram.com/globalimmigrationsc/" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://wa.me/231886590302" target="_blank" rel="noopener noreferrer" aria-label="Chat with us on WhatsApp"><i class="fab fa-whatsapp"></i></a>
                        <a href="https://www.linkedin.com/company/global-immigration-sc" target="_blank" rel="noopener noreferrer" aria-label="Follow us on LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <div class="qr-code">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://www.facebook.com/share/16ZuMVLV3g/?mibextid=wwXIfr" alt="QR Code for Global Immigration SC Facebook Page">
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-tagline">
                    <p>Your Global Journey Starts Here 🌍✈️</p>
                </div>
                <p>&copy; 2023 Global Immigration SC. All rights reserved. Sponsored by Motiva Corporation Group of Companies.</p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float -->
    <a href="https://wa.me/231886590302" class="whatsapp-float" target="_blank" rel="noopener noreferrer" aria-label="Chat with us on WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Dashboard (hidden by default) -->
    <div id="dashboard" class="dashboard" style="display: none;">
        <div class="dashboard-header">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Applicant Dashboard</h2>
                    <div>
                        <span id="userName" style="margin-right: 15px;">Welcome, User</span>
                        <button id="logoutBtn" class="btn btn-outline">Logout</button>
                        <button id="adminAccessBtn" class="btn btn-primary" style="margin-left: 10px; display: none;">Admin Access</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container dashboard-container">
            <div class="dashboard-sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#overview" class="sidebar-link active" data-section="overview">Application Overview</a></li>
                    <li><a href="#documents" class="sidebar-link" data-section="documents">Document Upload</a></li>
                    <li><a href="#payments" class="sidebar-link" data-section="payments">Payment Status</a></li>
                    <li><a href="#profile" class="sidebar-link" data-section="profile">Profile Management</a></li>
                    <li><a href="#status" class="sidebar-link" data-section="status">Application Status</a></li>
                </ul>
            </div>
            
            <div class="dashboard-content">
                <div id="overview" class="dashboard-section active">
                    <h3>Application Overview</h3>
                    <p>Track your application progress and see what's next in your immigration journey.</p>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="mainProgressBar" style="width: 0%;"></div>
                    </div>
                    <p style="text-align: center; font-weight: 600;" id="progressPercentage">0% Complete</p>
                    
                    <div class="progress-steps">
                        <div class="progress-step">
                            <div class="step-indicator" id="step1">1</div>
                            <p>Initial Application</p>
                        </div>
                        <div class="progress-step">
                            <div class="step-indicator" id="step2">2</div>
                            <p>Document Submission</p>
                        </div>
                        <div class="progress-step">
                            <div class="step-indicator" id="step3">3</div>
                            <p>Payment Processing</p>
                        </div>
                        <div class="progress-step">
                            <div class="step-indicator" id="step4">4</div>
                            <p>Review & Approval</p>
                        </div>
                        <div class="progress-step">
                            <div class="step-indicator" id="step5">5</div>
                            <p>Visa Issued</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4>Next Steps</h4>
                        <ul style="list-style-type: disc; margin-left: 20px;" id="nextStepsList">
                            <li>Complete your profile information</li>
                            <li>Upload required documents</li>
                            <li>Complete payment for application processing</li>
                        </ul>
                    </div>
                </div>
                
                <!-- ENHANCED DOCUMENTS SECTION -->
<div id="documents" class="dashboard-section">
    <h3>Document Upload & Management</h3>
    <p>Upload and manage all required documents for your application. All documents are securely stored and encrypted.</p>
    
    <!-- Document Requirements Overview -->
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h4>📋 Required Documents Checklist</h4>
        <div id="documentChecklist">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span>Required Documents: <span id="completedDocs">0</span>/<span id="totalDocs">6</span> completed</span>
                <span id="completionStatus" style="font-weight: bold; color: #ff9800">📝 In Progress</span>
            </div>
            <div class="progress-bar" style="height: 8px; margin-bottom: 15px;">
                <div class="progress-fill" id="docsProgressBar" style="width: 0%"></div>
            </div>
        </div>
    </div>
    
    <!-- Bulk Upload Area -->
    <div class="upload-area" id="bulkUploadArea" style="margin-bottom: 30px;">
        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
        <h4>Quick Upload Multiple Files</h4>
        <p>Drag and drop multiple files here or click to browse</p>
        <input type="file" id="bulkFileUpload" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display: none;">
        <div class="upload-progress">
            <div class="upload-progress-bar" id="bulkUploadProgress"></div>
        </div>
        <p style="font-size: 0.8em; color: #666; margin-top: 10px;">
            Supported formats: PDF, JPG, PNG, DOC, DOCX (Max 10MB per file)
        </p>
    </div>
    
    <!-- Documents Grid -->
    <div class="documents-grid" id="dynamicDocumentsGrid">
        <!-- Documents will be loaded dynamically -->
    </div>
    
    <!-- Upload History -->
    <div style="margin-top: 30px;">
        <h4>Upload History</h4>
        <div id="uploadHistory" style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px; background: #fafafa;">
            <!-- Upload history will be populated here -->
        </div>
    </div>
</div>

<!-- REAL ADMIN DOCUMENT CONTROLS -->
<div id="adminDocumentControls" style="display: none; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
    <h4>📋 Admin Document Management</h4>
    
    <!-- Document Quick Actions -->
    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <h5 style="margin-bottom: 10px;">Quick Document Status Updates</h5>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; margin-top: 10px;">
            <button onclick="adminUpdateDocumentStatus('passport', 'file_received')" class="btn btn-small btn-outline">
                ✅ Passport Received
            </button>
            <button onclick="adminUpdateDocumentStatus('academic_transcripts', 'file_received')" class="btn btn-small btn-outline">
                ✅ Transcripts Received
            </button>
            <button onclick="adminUpdateDocumentStatus('passport', 'under_review')" class="btn btn-small btn-outline">
                🔍 Under Review
            </button>
            <button onclick="adminUpdateDocumentStatus('passport', 'approved')" class="btn btn-small btn-outline">
                ✅ Passport Approved
            </button>
            <button onclick="adminUpdateDocumentStatus('academic_transcripts', 'approved')" class="btn btn-small btn-outline">
                ✅ Transcripts Approved
            </button>
            <button onclick="adminUpdateDocumentStatus('proof_of_funds', 'needs_correction')" class="btn btn-small btn-outline">
                ⚠️ Needs Correction
            </button>
        </div>
    </div>

    <!-- Manual Document Status Update -->
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <h5 style="margin-bottom: 10px;">📝 Manual Status Update</h5>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: end;">
            <div>
                <label style="display: block; font-size: 0.9em; margin-bottom: 5px;">Document Type</label>
                <select id="adminDocType" class="form-control" style="min-width: 180px;">
                    <option value="passport">Passport</option>
                    <option value="academic_transcripts">Academic Transcripts</option>
                    <option value="proof_of_funds">Proof of Funds</option>
                    <option value="cv_resume">CV/Resume</option>
                    <option value="recommendation_letter">Recommendation Letter</option>
                    <option value="passport_photos">Passport Photos</option>
                </select>
            </div>
            <div>
                <label style="display: block; font-size: 0.9em; margin-bottom: 5px;">Status</label>
                <select id="adminDocStatus" class="form-control" style="min-width: 180px;">
                    <option value="file_received">✅ File Received</option>
                    <option value="under_review">🔍 Under Review</option>
                    <option value="approved">✅ Approved</option>
                    <option value="needs_correction">⚠️ Needs Correction</option>
                    <option value="rejected">❌ Rejected</option>
                </select>
            </div>
            <div>
                <label style="display: block; font-size: 0.9em; margin-bottom: 5px;">Notes (Optional)</label>
                <input type="text" id="adminDocNotes" class="form-control" placeholder="Add comments..." style="min-width: 200px;">
            </div>
            <button onclick="adminManualStatusUpdate()" class="btn btn-primary btn-small">
                Update Status
            </button>
        </div>
    </div>

    <!-- Application Progress Controls -->
    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
        <h5 style="margin-bottom: 10px;">🚀 Application Progress</h5>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
            <button onclick="adminUpdateApplicationStage('document_upload', true)" class="btn btn-small btn-outline">
                ✅ Complete Document Stage
            </button>
            <button onclick="adminUpdateApplicationStage('payment', true)" class="btn btn-small btn-outline">
                ✅ Complete Payment Stage
            </button>
            <button onclick="adminUpdateApplicationStage('review', true)" class="btn btn-small btn-outline">
                ✅ Complete Review Stage
            </button>
            <button onclick="adminSendStatusNotification()" class="btn btn-small btn-outline">
                📧 Send Status Update
            </button>
        </div>
    </div>
</div>
                
                <!-- ENHANCED PAYMENTS SECTION -->
<div id="payments" class="dashboard-section">
    <h3>Payment Management</h3>
    <p>Manage your application fees and track payment status.</p>
    
    <!-- Payment Overview -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
        <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; text-align: center;">
            <h4 style="color: #4CAF50; margin: 0 0 10px 0;">Paid</h4>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">$<span id="paidAmount">0.00</span></p>
        </div>
        <div style="background: #fff3cd; padding: 20px; border-radius: 8px; text-align: center;">
            <h4 style="color: #ff9800; margin: 0 0 10px 0;">Pending</h4>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">$<span id="pendingAmount">0.00</span></p>
        </div>
        <div style="background: #f8d7da; padding: 20px; border-radius: 8px; text-align: center;">
            <h4 style="color: #dc3545; margin: 0 0 10px 0;">Due</h4>
            <p style="font-size: 1.5rem; font-weight: bold; margin: 0;">$<span id="dueAmount">0.00</span></p>
        </div>
    </div>

    <!-- Payment Instructions -->
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h4>💳 Payment Methods</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
            <div style="border: 2px solid #e9ecef; padding: 15px; border-radius: 8px; text-align: center;">
                <i class="fas fa-mobile-alt" style="font-size: 2rem; color: #ff6b00; margin-bottom: 10px;"></i>
                <h5>Mobile Money</h5>
                <p style="font-size: 0.9em; margin: 5px 0;">Orange Money: +231 770562292</p>
                <p style="font-size: 0.9em; margin: 5px 0;">Lonestar Money: +231 886590302</p>
            </div>
            <div style="border: 2px solid #e9ecef; padding: 15px; border-radius: 8px; text-align: center;">
                <i class="fas fa-university" style="font-size: 2rem; color: #007bff; margin-bottom: 10px;"></i>
                <h5>Bank Transfer</h5>
                <p style="font-size: 0.9em; margin: 5px 0;">UBA Liberia</p>
                <p style="font-size: 0.9em; margin: 5px 0;">A/C: 53080500327155</p>
            </div>
        </div>
    </div>

    <!-- Payment Table -->
    <table class="payment-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Status</th>
                <th>Receipt</th>
            </tr>
        </thead>
        <tbody id="paymentTableBody">
            <!-- Payments will be loaded dynamically -->
        </tbody>
    </table>

    <!-- Payment Confirmation Upload -->
    <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
        <h4>Payment Confirmation</h4>
        <p>Upload screenshot or proof of payment for verification</p>
        
        <div class="upload-area" id="paymentConfirmationUpload" style="margin: 15px 0;">
            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Click or drag payment confirmation screenshot</p>
            <input type="file" id="paymentUploadInput" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
            <div class="upload-progress">
                <div class="upload-progress-bar" id="paymentProgress"></div>
            </div>
        </div>
        
        <div id="paymentConfirmationStatus" style="margin-top: 10px;"></div>
    </div>
</div>
                
                <div id="profile" class="dashboard-section">
    <h3>Profile Management</h3>
    <p>Update your personal details and account information.</p>
    
    <form class="profile-form">
        <div class="form-group">
            <label for="dashboardName">Full Name</label>
            <input type="text" id="dashboardName" class="form-control" value="John Doe">
        </div>
        
        <div class="form-group">
            <label for="dashboardEmail">Email Address</label>
            <input type="email" id="dashboardEmail" class="form-control" value="john.doe@example.com">
        </div>
        
        <div class="form-group">
            <label for="dashboardPhone">Phone Number</label>
            <input type="tel" id="dashboardPhone" class="form-control" value="+1234567890">
        </div>
        
        <div class="form-group">
            <label for="dashboardAddress">Address</label>
            <textarea id="dashboardAddress" class="form-control">123 Main Street, Monrovia, Liberia</textarea>
        </div>
        
        <div class="form-group">
            <label for="dashboardCountry">Country of Interest</label>
            <select id="dashboardCountry" class="form-control">
                <option value="">Select your desired country</option>
                <option value="usa">United States</option>
                <option value="canada" selected>Canada</option>
                <option value="australia">Australia</option>
                <option value="uk">United Kingdom</option>
                <option value="germany">Germany</option>
                <option value="france">France</option>
                <option value="netherlands">Netherlands</option>
                <option value="sweden">Sweden</option>
                <option value="norway">Norway</option>
                <option value="denmark">Denmark</option>
                <option value="switzerland">Switzerland</option>
                <option value="austria">Austria</option>
                <option value="ireland">Ireland</option>
                <option value="newzealand">New Zealand</option>
                <option value="singapore">Singapore</option>
                <option value="japan">Japan</option>
                <option value="southkorea">South Korea</option>
                <option value="uae">United Arab Emirates</option>
                <option value="qatar">Qatar</option>
                <option value="saudiarabia">Saudi Arabia</option>
                <option value="other">Other Country</option>
            </select>
        </div>
        
        <button type="button" class="btn btn-primary" onclick="handleProfileUpdate(event)">Update Profile</button>
    </form>
    
    <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
        <h4>Change Password</h4>
        <form class="password-form">
            <div class="form-group">
                <label for="currentPassword">Current Password</label>
                <input type="password" id="currentPassword" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" class="form-control">
            </div>
            
            <div class="form-group">
                <label for="confirmNewPassword">Confirm New Password</label>
                <input type="password" id="confirmNewPassword" class="form-control">
            </div>
            
            <button type="button" class="btn btn-outline" onclick="handlePasswordChange(event)">Change Password</button>
        </form>
    </div>
</div>
                
                <div id="status" class="dashboard-section">
                    <h3>Application Status Tracking</h3>
                    <p>Track the current status of your application with our visual timeline.</p>
                    
                    <div style="margin: 30px 0;">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 40%;"></div>
                        </div>
                        <p style="text-align: center; font-weight: 600; margin-top: 10px;">Application Status: Document Submission Phase</p>
                    </div>
                    
                    <div style="position: relative; margin: 40px 0;">
                        <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background-color: var(--primary-red);"></div>
                        
                        <div style="position: relative; padding-left: 30px; margin-bottom: 30px;">
                            <div style="position: absolute; left: 0; top: 0; width: 20px; height: 20px; border-radius: 50%; background-color: var(--primary-red);"></div>
                            <h4 style="margin-bottom: 5px;">Application Submitted</h4>
                            <p style="color: var(--medium-gray);">October 15, 2023</p>
                            <p>Your initial application has been received and is under review.</p>
                        </div>
                        
                        <div style="position: relative; padding-left: 30px; margin-bottom: 30px;">
                            <div style="position: absolute; left: 0; top: 0; width: 20px; height: 20px; border-radius: 50%; background-color: var(--primary-red);"></div>
                            <h4 style="margin-bottom: 5px;">Document Review</h4>
                            <p style="color: var(--medium-gray);">Current Step</p>
                            <p>We are currently reviewing your submitted documents. Please ensure all required documents are uploaded.</p>
                        </div>
                        
                        <div style="position: relative; padding-left: 30px; margin-bottom: 30px;">
                            <div style="position: absolute; left: 0; top: 0; width: 20px; height: 20px; border-radius: 50%; background-color: #eee;"></div>
                            <h4 style="margin-bottom: 5px;">Payment Processing</h4>
                            <p style="color: var(--medium-gray);">Upcoming</p>
                            <p>Once documents are approved, you'll need to complete payment for processing fees.</p>
                        </div>
                        
                        <div style="position: relative; padding-left: 30px; margin-bottom: 30px;">
                            <div style="position: absolute; left: 0; top: 0; width: 20px; height: 20px; border-radius: 50%; background-color: #eee;"></div>
                            <h4 style="margin-bottom: 5px;">Embassy Submission</h4>
                            <p style="color: var(--medium-gray);">Upcoming</p>
                            <p>Your application will be submitted to the appropriate embassy for final review.</p>
                        </div>
                        
                        <div style="position: relative; padding-left: 30px;">
                            <div style="position: absolute; left: 0; top: 0; width: 20px; height: 20px; border-radius: 50%; background-color: #eee;"></div>
                            <h4 style="margin-bottom: 5px;">Visa Issuance</h4>
                            <p style="color: var(--medium-gray);">Final Step</p>
                            <p>Upon approval, your visa will be issued and prepared for collection.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard (hidden by default) -->
    <div id="adminDashboard" class="admin-dashboard" style="display: none;">
        <div class="admin-header">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>Admin Dashboard - Applicant Management</h2>
                    <div>
                        <span id="adminUser" style="margin-right: 15px;"></span>
                        <button id="adminLogout" class="btn btn-outline">Logout</button>
                        <button id="backToUser" class="btn btn-primary" style="margin-left: 10px;">User View</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container" style="padding-top: 20px;">
            <div class="dashboard-container">
                <div class="dashboard-sidebar">
                    <ul class="sidebar-menu">
                        <li><a href="#adminOverview" class="sidebar-link active" data-section="adminOverview">Overview</a></li>
                        <li><a href="#applicantManagement" class="sidebar-link" data-section="applicantManagement">Applicants</a></li>
                        <li><a href="#documentReview" class="sidebar-link" data-section="documentReview">Document Review</a></li>
                        <li><a href="#paymentManagement" class="sidebar-link" data-section="paymentManagement">Payments</a></li>
                    </ul>
                </div>
                
                <div class="dashboard-content">
                    <div id="adminOverview" class="dashboard-section active">
                        <h3>System Overview</h3>
                        <div class="stats-container" style="margin-top: 20px;">
                            <div class="stat-item">
                                <div class="stat-number" id="totalApplicants">0</div>
                                <div class="stat-label">Total Applicants</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="pendingReview">0</div>
                                <div class="stat-label">Pending Review</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="approvedApps">0</div>
                                <div class="stat-label">Approved</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="rejectedApps">0</div>
                                <div class="stat-label">Rejected</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="applicantManagement" class="dashboard-section">
                        <h3>Applicant Management</h3>
                        <div class="form-group">
                            <input type="text" id="searchApplicants" class="form-control" placeholder="Search applicants...">
                        </div>
                        <div id="applicantsList">
                            <!-- Applicants will be loaded here dynamically -->
                        </div>
                    </div>
                    
                    <div id="applicantDetail" class="dashboard-section">
                        <h3>Applicant Details</h3>
                        <div id="applicantDetailContent">
                            <!-- Applicant details will be loaded here -->
                        </div>
                    </div>
                    
                    <div id="documentReview" class="dashboard-section">
    <h3>Document Review</h3>
    <div id="documentReviewList">
        <!-- Documents for review will be loaded here -->
    </div>
    
    <!-- ADD THIS SECTION - Admin Document Controls for Admin Dashboard -->
    <div id="adminDocumentControls" style="display: block; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
        <h4>📋 Admin Document Management</h4>
        
        <!-- Document Quick Actions -->
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <h5 style="margin-bottom: 10px;">Quick Document Status Updates</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; margin-top: 10px;">
                <button onclick="adminUpdateDocumentStatus('passport', 'file_received')" class="btn btn-small btn-outline">
                    ✅ Passport Received
                </button>
                <button onclick="adminUpdateDocumentStatus('academic_transcripts', 'file_received')" class="btn btn-small btn-outline">
                    ✅ Transcripts Received
                </button>
                <button onclick="adminUpdateDocumentStatus('passport', 'under_review')" class="btn btn-small btn-outline">
                    🔍 Under Review
                </button>
                <button onclick="adminUpdateDocumentStatus('passport', 'approved')" class="btn btn-small btn-outline">
                    ✅ Passport Approved
                </button>
                <button onclick="adminUpdateDocumentStatus('academic_transcripts', 'approved')" class="btn btn-small btn-outline">
                    ✅ Transcripts Approved
                </button>
                <button onclick="adminUpdateDocumentStatus('proof_of_funds', 'needs_correction')" class="btn btn-small btn-outline">
                    ⚠️ Needs Correction
                </button>
            </div>
        </div>

        <!-- Manual Document Status Update -->
        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <h5 style="margin-bottom: 10px;">📝 Manual Status Update</h5>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: end;">
                <div>
                    <label style="display: block; font-size: 0.9em; margin-bottom: 5px;">Document Type</label>
                    <select id="adminDocType" class="form-control" style="min-width: 180px;">
                        <option value="passport">Passport</option>
                        <option value="academic_transcripts">Academic Transcripts</option>
                        <option value="proof_of_funds">Proof of Funds</option>
                        <option value="cv_resume">CV/Resume</option>
                        <option value="recommendation_letter">Recommendation Letter</option>
                        <option value="passport_photos">Passport Photos</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 0.9em; margin-bottom: 5px;">Status</label>
                    <select id="adminDocStatus" class="form-control" style="min-width: 180px;">
                        <option value="file_received">✅ File Received</option>
                        <option value="under_review">🔍 Under Review</option>
                        <option value="approved">✅ Approved</option>
                        <option value="needs_correction">⚠️ Needs Correction</option>
                        <option value="rejected">❌ Rejected</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 0.9em; margin-bottom: 5px;">Notes (Optional)</label>
                    <input type="text" id="adminDocNotes" class="form-control" placeholder="Add comments..." style="min-width: 200px;">
                </div>
                <button onclick="adminManualStatusUpdate()" class="btn btn-primary btn-small">
                    Update Status
                </button>
            </div>
        </div>

        <!-- Application Progress Controls -->
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
            <h5 style="margin-bottom: 10px;">🚀 Application Progress</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                <button onclick="adminUpdateApplicationStage('document_upload', true)" class="btn btn-small btn-outline">
                    ✅ Complete Document Stage
                </button>
                <button onclick="adminUpdateApplicationStage('payment', true)" class="btn btn-small btn-outline">
                    ✅ Complete Payment Stage
                </button>
                <button onclick="adminUpdateApplicationStage('review', true)" class="btn btn-small btn-outline">
                    ✅ Complete Review Stage
                </button>
                <button onclick="adminSendStatusNotification()" class="btn btn-small btn-outline">
                    📧 Send Status Update
                </button>
            </div>
        </div>
    </div>
</div>

    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAJ3p91t83EQeQ6XopPfvisc1fIdsWIMm8",
            authDomain: "global-immigration-sc.firebaseapp.com",
            projectId: "global-immigration-sc",
            storageBucket: "global-immigration-sc.firebasestorage.app",
            messagingSenderId: "791181145117",
            appId: "1:791181145117:web:527b7df63c9a32adf9c2f4",
            measurementId: "G-1FJHEV0NLW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ==================== ENHANCED DOCUMENT MANAGEMENT SYSTEM ====================
class DocumentManager {
    constructor() {
        this.supportedTypes = ['pdf', 'jpg', 'jpeg', 'png', 'doc', 'docx'];
        this.maxFileSize = 10 * 1024 * 1024; // 10MB
        this.requiredDocuments = ['passport', 'academic_transcripts', 'proof_of_funds', 'cv_resume', 'passport_photos', 'recommendation_letter'];
        this.formspreeEndpoint = 'https://formspree.io/f/mrbaejkr';
    }

    // Initialize document system
    initialize() {
        this.setupBulkUpload();
        this.loadDocumentTemplates();
        this.setupDocumentListeners();
        this.loadUserDocuments();
    }

    // Setup bulk upload functionality
    setupBulkUpload() {
        const bulkUploadArea = document.getElementById('bulkUploadArea');
        const bulkFileInput = document.getElementById('bulkFileUpload');

        if (!bulkUploadArea || !bulkFileInput) return;

        // Click to upload
        bulkUploadArea.addEventListener('click', () => bulkFileInput.click());

        // Drag and drop
        bulkUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            bulkUploadArea.classList.add('dragover');
        });

        bulkUploadArea.addEventListener('dragleave', () => {
            bulkUploadArea.classList.remove('dragover');
        });

        bulkUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            bulkUploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                this.handleBulkUpload(Array.from(e.dataTransfer.files));
            }
        });

        // File input change
        bulkFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                this.handleBulkUpload(Array.from(e.target.files));
            }
        });
    }

    // Handle bulk file upload
async handleBulkUpload(files) {
    if (!currentUser) {
        alert('Please log in to upload documents.');
        return;
    }

    console.log('Bulk upload started with files:', files);

    const validFiles = files.filter(file => {
        const isValid = this.validateFile(file);
        const fileExtension = file.name.split('.').pop().toLowerCase();
        const isSupported = this.supportedTypes.includes(fileExtension);
        
        console.log('File validation:', file.name, {
            isValid: isValid,
            isSupported: isSupported,
            extension: fileExtension
        });
        
        return isValid && isSupported;
    });

    if (validFiles.length === 0) {
        alert('No valid files found. Please check file types and sizes.');
        return;
    }

    console.log('Valid files for upload:', validFiles);

        // Show upload progress
        const uploadArea = document.getElementById('bulkUploadArea');
        
        uploadArea.innerHTML = `
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Uploading ${validFiles.length} files to Formspree...</p>
            <div class="upload-progress">
                <div class="upload-progress-bar" style="width: 0%"></div>
            </div>
        `;

        let progressBar = uploadArea.querySelector('.upload-progress-bar');

        try {
            for (let i = 0; i < validFiles.length; i++) {
                const file = validFiles[i];
                const progress = ((i + 1) / validFiles.length) * 100;
                progressBar.style.width = progress + '%';
                
                await this.uploadSingleFile(file);
            }

            // Show success
            uploadArea.innerHTML = `
                <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; color: #4CAF50;"></i>
                <p>All files submitted successfully!</p>
                <p style="font-size: 0.9em; color: #666;">Documents sent to Formspree for processing</p>
                <div class="upload-progress">
                    <div class="upload-progress-bar" style="width: 100%; background: #4CAF50;"></div>
                </div>
            `;

            // Refresh documents grid
            this.loadUserDocuments();

            setTimeout(() => {
                this.resetBulkUploadArea();
            }, 3000);

        } catch (error) {
            console.error('Bulk upload failed:', error);
            uploadArea.innerHTML = `
                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; color: #f44336;"></i>
                <p>Upload failed. Please try again.</p>
                <button onclick="documentManager.resetBulkUploadArea()" class="btn btn-primary">Retry</button>
            `;
        }
    }

    // Upload single file to Formspree (EMAIL-ONLY VERSION)
async uploadSingleFile(file, docType = null) {
    if (!currentUser) {
        throw new Error('Please log in to upload documents.');
    }

    // Auto-detect document type if not provided
    if (!docType) {
        docType = this.autoDetectDocumentType(file.name);
        console.log('Auto-detected document type:', docType, 'for file:', file.name);
    }

    // Validate docType
    if (!docType || docType === 'undefined') {
        console.error('Invalid document type detected, using fallback');
        docType = 'other_documents';
    }

    // Show progress for this specific document
    this.showIndividualProgress(docType, 50);

    try {
        console.log('Preparing document metadata for Formspree notification');

        // Store document metadata in Firestore FIRST
        const documentData = {
            fileName: file.name,
            uploadedAt: new Date(),
            status: 'pending_review',
            fileSize: file.size,
            fileType: file.type,
            submittedVia: 'formspree_notification',
            docType: docType,
            lastUpdated: new Date(),
            formspreeSubmitted: false,
            needsManualUpload: true
        };

        await db.collection('applications').doc(currentUser.uid).update({
            [`documents.${docType}`]: documentData,
            updatedAt: new Date()
        });

        console.log('Document metadata stored in Firestore');

        // Send notification to Formspree (without file attachment)
        const formData = new FormData();
        formData.append('document_name', file.name);
        formData.append('document_type', docType);
        formData.append('file_size', this.formatFileSize(file.size));
        formData.append('user_id', currentUser.uid);
        formData.append('user_email', currentUser.email);
        formData.append('user_name', currentUser.displayName || 'Unknown User');
        formData.append('upload_time', new Date().toISOString());
        formData.append('form_type', 'document_upload_notification');
        formData.append('subject', `Document Upload Notification: ${docType} - ${file.name}`);
        formData.append('_subject', `Global Immigration SC - Document Upload Notification: ${docType}`);
        formData.append('message', `
            USER UPLOADED A DOCUMENT BUT FILE ATTACHMENT IS NOT AVAILABLE DUE TO PLAN LIMITATIONS.
            
            Document Details:
            - File Name: ${file.name}
            - Document Type: ${docType}
            - File Size: ${this.formatFileSize(file.size)}
            - User: ${currentUser.displayName || 'Unknown'} (${currentUser.email})
            - User ID: ${currentUser.uid}
            - Upload Time: ${new Date().toISOString()}
            
            ACTION REQUIRED:
            Please contact the user to get the actual file via email or other means.
            
            The document metadata has been stored in Firebase Firestore for tracking.
        `);

        console.log('Sending notification to Formspree (without file)');

        const response = await fetch(this.formspreeEndpoint, {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json'
            }
        });

        if (response.ok) {
            console.log('Formspree notification sent successfully');
            
            // Update document status
            await db.collection('applications').doc(currentUser.uid).update({
                [`documents.${docType}.formspreeNotificationSent`]: true,
                [`documents.${docType}.notificationSentAt`]: new Date(),
                updatedAt: new Date()
            });

            // Add to upload history
            await this.addToUploadHistory(file.name, docType, true);
            
            this.showIndividualProgress(docType, 100);
            
            /// Show success message to user
            this.showSuccessMessage(`"${file.name}" submitted successfully! Our team has been notified. Please check your email (${currentUser.email}) for further instructions on sending the actual document file. You may also be contacted via WhatsApp.`);
            
            return true;

            // Add to upload history
await this.addToUploadHistory(file.name, docType, true);

this.showIndividualProgress(docType, 100);

// Show success message to user
this.showSuccessMessage(`"${file.name}" submitted successfully! Our team has been notified. Please check your email (${currentUser.email}) for further instructions on sending the actual document file. You may also be contacted via WhatsApp.`);

// AUTO-SEND USER NOTIFICATION
await this.sendUserNotification(
    `Your document "${file.name}" has been received and is pending review. Please check your email for instructions on sending the actual file.`,
    'document_received'
);

return true;
        } else {
            const errorText = await response.text();
            console.error('Formspree notification failed:', response.status, errorText);


            
            // Still mark as successful since metadata is stored
            await this.addToUploadHistory(file.name, docType, true, 'Metadata stored but notification failed');
            this.showIndividualProgress(docType, 100);
            
            this.showSuccessMessage(`"${file.name}" metadata stored! Document is queued for review.`);
            return true;
        }
    } catch (error) {
        console.error('Upload process error:', error);
        await this.addToUploadHistory(file.name, docType, false, error.message);
        throw error;
    }
}

// Manual status update for admins
async updateDocumentStatusManually(docType, status, adminNotes = '') {
    if (!currentUser) return;
    
    try {
        await db.collection('applications').doc(currentUser.uid).update({
            [`documents.${docType}.adminStatus`]: status,
            [`documents.${docType}.adminNotes`]: adminNotes,
            [`documents.${docType}.statusUpdatedAt`]: new Date(),
            [`documents.${docType}.status`]: status, // Also update main status
            updatedAt: new Date()
        });
        
        console.log(`Document ${docType} status updated to: ${status}`);
        
        // Show success message to user
        this.showSuccessMessage(`Document status updated to: ${status.replace('_', ' ').toUpperCase()}`);
        
    } catch (error) {
        console.error('Error updating document status:', error);
        alert('Error updating document status: ' + error.message);
    }
}

// Send user notification
async sendUserNotification(message, notificationType = 'info') {
    if (!currentUser) return;
    
    try {
        // Store notification in user's record
        await db.collection('applications').doc(currentUser.uid).update({
            userNotifications: firebase.firestore.FieldValue.arrayUnion({
                message: message,
                type: notificationType,
                timestamp: new Date(),
                read: false
            }),
            updatedAt: new Date()
        });
        
        // Also send to Formspree for email notification
        const formData = new FormData();
        formData.append('user_email', currentUser.email);
        formData.append('user_name', currentUser.displayName || 'Unknown User');
        formData.append('notification_message', message);
        formData.append('notification_type', notificationType);
        formData.append('form_type', 'user_notification');
        formData.append('subject', `User Notification: ${currentUser.email}`);
        
        await fetch(this.formspreeEndpoint, {
            method: 'POST',
            body: formData
        });
        
        console.log('User notification sent:', message);
        
    } catch (error) {
        console.error('Error sending user notification:', error);
    }
}

    // Show progress for individual document uploads
    showIndividualProgress(docType, progress) {
        const progressBar = document.getElementById(`progress_${docType}`);
        if (progressBar) {
            progressBar.style.width = progress + '%';
            if (progress === 100) {
                progressBar.style.background = '#4CAF50';
            } else if (progress === 50) {
                progressBar.style.background = 'var(--primary-red)';
            }
        }
    }

    // Format file size for display
    formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

// Auto-detect document type based on filename
autoDetectDocumentType(filename) {
    if (!filename || typeof filename !== 'string') {
        console.error('Invalid filename provided:', filename);
        return 'other_documents'; // Default fallback
    }
    
    const lowerFilename = filename.toLowerCase();
    
    if (lowerFilename.includes('passport') || lowerFilename.includes('id')) 
        return 'passport';
    if (lowerFilename.includes('transcript') || lowerFilename.includes('academic') || lowerFilename.includes('diploma') || lowerFilename.includes('certificate'))
        return 'academic_transcripts';
    if (lowerFilename.includes('bank') || lowerFilename.includes('financial') || lowerFilename.includes('statement') || lowerFilename.includes('fund'))
        return 'proof_of_funds';
    if (lowerFilename.includes('recommendation') || lowerFilename.includes('reference') || lowerFilename.includes('letter'))
        return 'recommendation_letter';
    if (lowerFilename.includes('cv') || lowerFilename.includes('resume') || lowerFilename.includes('curriculum'))
        return 'cv_resume';
    if (lowerFilename.includes('photo') || lowerFilename.includes('picture') || lowerFilename.includes('image'))
        return 'passport_photos';
    if (lowerFilename.includes('application') || lowerFilename.includes('form'))
        return 'application_form';
    
    console.log('Could not auto-detect document type for:', filename, '- using other_documents');
    return 'other_documents';
}

    // Validate file
    validateFile(file) {
        if (file.size > this.maxFileSize) {
            alert(`File ${file.name} is too large. Maximum size is 10MB.`);
            return false;
        }
        
        const fileExtension = file.name.split('.').pop().toLowerCase();
        if (!this.supportedTypes.includes(fileExtension)) {
            alert(`File type .${fileExtension} is not supported. Please use PDF, JPG, PNG, DOC, or DOCX.`);
            return false;
        }
        
        return true;
    }

    // Load user documents
async loadUserDocuments() {
    if (!currentUser) {
        console.log('No current user - cannot load documents');
        return;
    }

    try {
        console.log('Loading documents for user:', currentUser.uid);
        
        const appDoc = await db.collection('applications').doc(currentUser.uid).get();
        
        if (!appDoc.exists) {
            console.log('No application document found - creating initial structure');
            // Create initial application structure
            await this.createInitialApplication();
            this.renderDocumentsGrid({});
            this.updateDocumentChecklist({});
            return;
        }
        
        const appData = appDoc.data();
        const documents = appData?.documents || {};
        
        console.log('Loaded documents:', documents);

        this.renderDocumentsGrid(documents);
        this.updateDocumentChecklist(documents);
        this.loadUploadHistory();
    } catch (error) {
        console.error('Error loading documents:', error);
        // Show fallback UI even if there's an error
        this.renderDocumentsGrid({});
        this.updateDocumentChecklist({});
    }
}

// Add this new method to create initial application structure
async createInitialApplication() {
    if (!currentUser) return;
    
    try {
        await db.collection('applications').doc(currentUser.uid).set({
            userId: currentUser.uid,
            status: 'draft',
            progress: 0,
            currentStep: 'personal_info',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            documents: {},
            payments: [],
            personalInfo: {},
            applicationStages: {
                personal_info: { status: 'pending', completed: false },
                document_upload: { status: 'pending', completed: false },
                payment: { status: 'pending', completed: false },
                review: { status: 'pending', completed: false },
                approval: { status: 'pending', completed: false }
            }
        });
        console.log('Initial application structure created');
    } catch (error) {
        console.error('Error creating initial application:', error);
    }
}
    // Render documents grid
    renderDocumentsGrid(documents) {
        const grid = document.getElementById('dynamicDocumentsGrid');
        if (!grid) return;

        const documentTemplates = {
            passport: {
                title: 'Passport Copy',
                description: 'Clear copy of your passport information page',
                icon: 'fas fa-passport',
                required: true
            },
            academic_transcripts: {
                title: 'Academic Transcripts',
                description: 'Your academic records and certificates',
                icon: 'fas fa-graduation-cap',
                required: true
            },
            proof_of_funds: {
                title: 'Proof of Funds',
                description: 'Bank statements or sponsorship letters',
                icon: 'fas fa-money-bill-wave',
                required: true
            },
            recommendation_letter: {
                title: 'Letter of Recommendation',
                description: 'Professional or academic recommendation letters',
                icon: 'fas fa-envelope-open-text',
                required: false
            },
            cv_resume: {
                title: 'CV/Resume',
                description: 'Your updated curriculum vitae',
                icon: 'fas fa-file-alt',
                required: true
            },
            passport_photos: {
                title: 'Passport Photos',
                description: 'Recent passport-sized photographs',
                icon: 'fas fa-camera',
                required: true
            },
            application_form: {
                title: 'Application Form',
                description: 'Completed application forms',
                icon: 'fas fa-file-contract',
                required: true
            },
            other_documents: {
                title: 'Other Documents',
                description: 'Additional supporting documents',
                icon: 'fas fa-file-upload',
                required: false
            }
        };

        grid.innerHTML = Object.keys(documentTemplates).map(docType => {
            const template = documentTemplates[docType];
            const document = documents[docType];
            const status = document?.status || 'missing';
            const uploadDate = document?.uploadedAt ? 
                new Date(document.uploadedAt.seconds * 1000).toLocaleDateString() : 'Not uploaded';

            return `
                <div class="document-card" data-doc-type="${docType}">
                    <div class="document-header">
                        <i class="${template.icon}" style="font-size: 2rem; color: var(--primary-red); margin-bottom: 10px;"></i>
                        <h4>${template.title} ${template.required ? '<span style="color: red;">*</span>' : ''}</h4>
                    </div>
                    <p>${template.description}</p>
                    
                    <div class="status-badge status-${status}" id="${docType}Status">
                        ${status.replace('_', ' ').toUpperCase()}
                    </div>
                    
                    <div class="upload-area" data-doc-type="${docType}" id="uploadArea_${docType}" style="min-height: 120px;">
                        ${document ? `
                            <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; color: #4CAF50;"></i>
                            <p style="font-weight: bold; margin-bottom: 5px;">${document.fileName}</p>
                            <p style="font-size: 0.8em; color: #666; margin-bottom: 5px;">
                                📅 Uploaded: ${uploadDate}
                            </p>
                            <p style="font-size: 0.8em; color: #666; margin-bottom: 10px;">
                                📊 Size: ${this.formatFileSize(document.fileSize)}
                            </p>
                            <div class="document-actions">
                                <button onclick="documentManager.downloadInstructions('${docType}')" class="btn btn-small btn-primary">
                                    <i class="fas fa-download"></i> Get File
                                </button>
                                <button onclick="documentManager.replaceDocument('${docType}')" class="btn btn-small btn-outline">
                                    <i class="fas fa-sync"></i> Replace
                                </button>
                            </div>
                            ${status === 'rejected' && document.comments ? `
                                <div style="margin-top: 10px; padding: 8px; background: #ffebee; border-radius: 4px;">
                                    <small><strong>Admin Feedback:</strong> ${document.comments}</small>
                                </div>
                            ` : ''}
                            ${document.formspreeSubmitted ? `
                                <div style="margin-top: 8px; padding: 5px; background: #e8f5e8; border-radius: 4px;">
                                    <small>✅ Submitted via Formspree</small>
                                </div>
                            ` : ''}
                        ` : `
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Click or drag file to upload</p>
                            <p style="font-size: 0.8em; color: #666; margin-bottom: 10px;">
                                File will be sent to our team via Formspree
                            </p>
                            <input type="file" id="fileInput_${docType}" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display: none;">
                            <div class="upload-progress">
                                <div class="upload-progress-bar" id="progress_${docType}"></div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }).join('');

        // Re-attach event listeners
        this.setupIndividualUploads();
    }

    // Download instructions for admins
    downloadInstructions(docType) {
        alert(`📋 To access this file:\n\n1. Check your Formspree email account\n2. Look for emails with subject "Document Upload: ${docType}"\n3. Download the attached file from the email\n\nFor immediate assistance, contact: infoglobalimmigrationsc@gmail.com`);
    }

    // Setup individual document uploads
    setupIndividualUploads() {
        document.querySelectorAll('.upload-area').forEach(area => {
            const docType = area.dataset.docType;
            const fileInput = document.getElementById(`fileInput_${docType}`);
            
            if (!fileInput) return;

            area.addEventListener('click', (e) => {
                if (!e.target.closest('.document-actions')) {
                    fileInput.click();
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files[0]) {
                    this.uploadSingleFile(e.target.files[0], docType)
                        .then(() => {
                            this.loadUserDocuments();
                            this.showSuccessMessage(`"${e.target.files[0].name}" submitted successfully! Our team will review it shortly.`);
                        })
                        .catch(error => {
                            alert('Upload failed: ' + error.message);
                        });
                }
            });
        });
    }

    // Show success message
    showSuccessMessage(message) {
        const successDiv = document.createElement('div');
        successDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 400px;
        `;
        successDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(successDiv);
        
        setTimeout(() => {
            successDiv.remove();
        }, 5000);
    }

    // Replace existing document
    async replaceDocument(docType) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.pdf,.jpg,.jpeg,.png,.doc,.docx';
        
        input.onchange = async (e) => {
            if (e.target.files[0]) {
                try {
                    await this.uploadSingleFile(e.target.files[0], docType);
                    this.loadUserDocuments();
                    this.showSuccessMessage('Document replaced successfully! New version submitted for review.');
                } catch (error) {
                    alert('Failed to replace document: ' + error.message);
                }
            }
        };
        
        input.click();
    }

    // Update document checklist
    updateDocumentChecklist(documents) {
        const completed = this.requiredDocuments.filter(doc => 
            documents[doc] && documents[doc].status === 'approved'
        ).length;
        const total = this.requiredDocuments.length;

        document.getElementById('completedDocs').textContent = completed;
        document.getElementById('totalDocs').textContent = total;
        document.getElementById('docsProgressBar').style.width = `${(completed / total) * 100}%`;
        
        const statusElement = document.getElementById('completionStatus');
        if (completed === total) {
            statusElement.textContent = '✅ Complete';
            statusElement.style.color = '#4CAF50';
        } else if (completed > 0) {
            statusElement.textContent = '📝 In Progress';
            statusElement.style.color = '#ff9800';
        } else {
            statusElement.textContent = '❌ Not Started';
            statusElement.style.color = '#f44336';
        }
    }

    // Add to upload history
async addToUploadHistory(filename, docType, success = true, errorMessage = '') {
    if (!currentUser) return;

    try {
        // Validate inputs
        if (!filename || !docType) {
            console.error('Invalid parameters for upload history:', { filename, docType });
            return;
        }

        // Ensure docType is valid
        if (docType === 'undefined' || !docType) {
            docType = 'other_documents';
        }

        const historyItem = {
            filename: filename,
            docType: docType,
            timestamp: new Date(),
            status: success ? 'submitted' : 'failed',
            errorMessage: errorMessage || '',
            submittedVia: 'formspree_notification'
        };

        console.log('Adding to upload history:', historyItem);

        await db.collection('applications').doc(currentUser.uid).update({
            uploadHistory: firebase.firestore.FieldValue.arrayUnion(historyItem)
        });
        
        console.log('Upload history updated successfully');
    } catch (error) {
        console.error('Error adding to upload history:', error);
    }
}

    // Load upload history
    async loadUploadHistory() {
        if (!currentUser) return;

        try {
            const appDoc = await db.collection('applications').doc(currentUser.uid).get();
            const appData = appDoc.data();
            const history = appData?.uploadHistory || [];

            const historyElement = document.getElementById('uploadHistory');
            if (!historyElement) return;

            historyElement.innerHTML = history.slice(-10).reverse().map(item => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #eee;">
                    <div>
                        <div style="font-weight: 500;">${item.filename}</div>
                        <div style="font-size: 0.8em; color: #666;">
                            ${item.docType} • 
                            <span style="color: ${item.status === 'submitted' ? '#4CAF50' : item.status === 'failed' ? '#f44336' : '#666'}">
                                ${item.status}
                            </span>
                        </div>
                    </div>
                    <span style="color: #666; font-size: 0.8em;">
                        ${new Date(item.timestamp.seconds * 1000).toLocaleDateString()}
                    </span>
                </div>
            `).join('') || '<p style="text-align: center; color: #666;">No upload history yet.</p>';
        } catch (error) {
            console.error('Error loading upload history:', error);
        }
    }

    // Reset bulk upload area
    resetBulkUploadArea() {
        const uploadArea = document.getElementById('bulkUploadArea');
        if (!uploadArea) return;

        uploadArea.innerHTML = `
            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <h4>Quick Upload Multiple Files</h4>
            <p>Drag and drop multiple files here or click to browse</p>
            <p style="font-size: 0.9em; color: #666; margin: 5px 0;">
                Files will be sent to our team via Formspree
            </p>
            <input type="file" id="bulkFileUpload" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display: none;">
            <div class="upload-progress">
                <div class="upload-progress-bar" id="bulkUploadProgress"></div>
            </div>
            <p style="font-size: 0.8em; color: #666; margin-top: 10px;">
                Supported formats: PDF, JPG, PNG, DOC, DOCX (Max 10MB per file)
            </p>
        `;

        this.setupBulkUpload();
    }

    // Load document templates
    loadDocumentTemplates() {
        console.log('Document templates loaded for Formspree integration');
    }

    // Setup document listeners
    setupDocumentListeners() {
        // Additional event listeners can be added here
    }
}

// Initialize document manager
const documentManager = new DocumentManager();

// Emergency fix for document loading
function emergencyDocumentLoad() {
    console.log('Emergency document load triggered');
    
    // Force render empty documents grid
    const grid = document.getElementById('dynamicDocumentsGrid');
    if (grid && grid.innerHTML === '') {
        console.log('Rendering emergency document grid');
        documentManager.renderDocumentsGrid({});
        documentManager.updateDocumentChecklist({});
    }
}

// Call this when dashboard loads
setTimeout(emergencyDocumentLoad, 1000);

// ==================== ENHANCED ADMIN MANAGER CLASS ====================
class AdminManager {
    constructor() {
        this.applicants = [];
    }

    // Initialize admin panel
    async initialize() {
        await this.loadAllApplicants();
        this.setupAdminSearch();
        this.setupBulkActions();
    }

    // Load all applicants
    async loadAllApplicants() {
        try {
            const snapshot = await db.collection('applications').get();
            this.applicants = [];
            
            for (const doc of snapshot.docs) {
                const appData = doc.data();
                const userDoc = await db.collection('users').doc(appData.userId).get();
                const userData = userDoc.data();
                
                this.applicants.push({
                    id: doc.id,
                    userId: appData.userId,
                    ...appData,
                    userInfo: userData
                });
            }
            
            this.renderApplicantsList(this.applicants);
            this.updateAdminStats();
        } catch (error) {
            console.error('Error loading applicants:', error);
        }
    }

    // Setup admin search
    setupAdminSearch() {
        const searchInput = document.getElementById('searchApplicants');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = this.applicants.filter(applicant => 
                    applicant.userInfo?.name?.toLowerCase().includes(searchTerm) ||
                    applicant.userInfo?.email?.toLowerCase().includes(searchTerm) ||
                    applicant.status?.toLowerCase().includes(searchTerm)
                );
                this.renderApplicantsList(filtered);
            });
        }
    }

    // Render applicants list
    renderApplicantsList(applicants) {
        const container = document.getElementById('applicantsList');
        if (!container) return;

        container.innerHTML = applicants.map(applicant => {
            const progress = this.calculateOverallProgress(applicant);
            const documentsCount = Object.keys(applicant.documents || {}).length;
            const lastActivity = applicant.updatedAt?.toDate?.().toLocaleDateString() || 'Unknown';

            return `
                <div class="applicant-card" onclick="adminManager.showApplicantDetail('${applicant.userId}')">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 2;">
                            <h4 style="margin: 0 0 5px 0;">${applicant.userInfo?.name || 'Unknown User'}</h4>
                            <p style="margin: 0 0 3px 0; color: #666;">${applicant.userInfo?.email || 'No email'}</p>
                            <p style="margin: 0 0 3px 0; font-size: 0.9em;">
                                📁 Documents: ${documentsCount} | 
                                📅 Last Activity: ${lastActivity}
                            </p>
                        </div>
                        <div style="text-align: right;">
                            <span class="status-badge status-${applicant.status}" style="display: inline-block; margin-bottom: 5px;">
                                ${applicant.status.toUpperCase()}
                            </span>
                            <div style="font-size: 0.9em;">Progress: ${progress}%</div>
                        </div>
                    </div>
                    <div class="progress-bar" style="height: 6px; margin-top: 10px;">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
            `;
        }).join('') || '<p>No applicants found.</p>';
    }

    // Show applicant detail
    async showApplicantDetail(userId) {
        const applicant = this.applicants.find(app => app.userId === userId);
        if (!applicant) return;

        const container = document.getElementById('applicantDetailContent');
        if (!container) return;

        const documentsHTML = this.renderAdminDocuments(applicant.documents || {});
        
        container.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                <div>
                    <h3>${applicant.userInfo?.name || 'Unknown User'}</h3>
                    <p><strong>Email:</strong> ${applicant.userInfo?.email || 'No email'}</p>
                    <p><strong>Phone:</strong> ${applicant.personalInfo?.phone || 'Not provided'}</p>
                    <p><strong>Country Interest:</strong> ${applicant.personalInfo?.country || 'Not specified'}</p>
                    <p><strong>Applied:</strong> ${applicant.createdAt?.toDate?.().toLocaleDateString() || 'Unknown date'}</p>
                </div>
                <div>
                    <select id="applicationStatus" class="form-control">
                        <option value="draft" ${applicant.status === 'draft' ? 'selected' : ''}>Draft</option>
                        <option value="submitted" ${applicant.status === 'submitted' ? 'selected' : ''}>Submitted</option>
                        <option value="under_review" ${applicant.status === 'under_review' ? 'selected' : ''}>Under Review</option>
                        <option value="approved" ${applicant.status === 'approved' ? 'selected' : ''}>Approved</option>
                        <option value="rejected" ${applicant.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                    </select>
                    <button onclick="adminManager.updateApplicationStatus('${applicant.userId}')" 
                            class="btn btn-primary" style="margin-top: 10px; width: 100%;">
                        Update Status
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4>Application Progress</h4>
                <div class="progress-bar" style="height: 10px; margin: 10px 0;">
                    <div class="progress-fill" style="width: ${this.calculateOverallProgress(applicant)}%"></div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    ${this.renderProgressStages(applicant.applicationStages || {})}
                </div>
            </div>
            
            <div>
                <h4>Documents</h4>
                <div class="document-list">
                    ${documentsHTML}
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button onclick="adminManager.sendNotification('${applicant.userId}')" class="btn btn-outline">
                    Send Notification
                </button>
                <button onclick="adminManager.addInternalNote('${applicant.userId}')" class="btn btn-outline" style="margin-left: 10px;">
                    Add Internal Note
                </button>
            </div>
        `;

        // Show detail view
        document.querySelectorAll('.dashboard-section').forEach(section => {
            section.classList.remove('active');
        });
        document.getElementById('applicantDetail').classList.add('active');
    }

    // Render progress stages
    renderProgressStages(stages) {
        return Object.entries(stages).map(([stage, data]) => `
            <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <div style="font-weight: bold; margin-bottom: 5px;">
                    ${stage.replace('_', ' ').toUpperCase()}
                </div>
                <span class="status-badge status-${data.status}" style="font-size: 0.8em;">
                    ${data.completed ? 'COMPLETED' : data.status.toUpperCase()}
                </span>
            </div>
        `).join('');
    }

    // Update application status
    async updateApplicationStatus(userId) {
        const status = document.getElementById('applicationStatus').value;
        
        try {
            await db.collection('applications').doc(userId).update({
                status: status,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            alert('Application status updated successfully!');
            this.loadAllApplicants(); // Refresh the list
        } catch (error) {
            alert('Error updating status: ' + error.message);
        }
    }

    // Calculate overall progress
    calculateOverallProgress(applicant) {
        if (!applicant.applicationStages) return 0;
        
        const stages = Object.values(applicant.applicationStages);
        const completed = stages.filter(stage => stage.completed).length;
        return Math.round((completed / stages.length) * 100);
    }

    // Update admin stats
    updateAdminStats() {
        const total = this.applicants.length;
        const pending = this.applicants.filter(app => 
            app.status === 'submitted' || app.status === 'draft' || app.status === 'under_review'
        ).length;
        const approved = this.applicants.filter(app => app.status === 'approved').length;
        const rejected = this.applicants.filter(app => app.status === 'rejected').length;

        document.getElementById('totalApplicants').textContent = total;
        document.getElementById('pendingReview').textContent = pending;
        document.getElementById('approvedApps').textContent = approved;
        document.getElementById('rejectedApps').textContent = rejected;
    }

    // Setup bulk actions
    setupBulkActions() {
        // Add bulk action buttons to the admin overview
        const overviewSection = document.getElementById('adminOverview');
        if (overviewSection) {
            const bulkSection = document.createElement('div');
            bulkSection.style.marginTop = '30px';
            bulkSection.innerHTML = `
                <h4>Bulk Actions</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="adminManager.exportApplicantsData()" class="btn btn-outline">
                        Export to Excel
                    </button>
                    <button onclick="adminManager.sendBulkNotification()" class="btn btn-outline">
                        Send Bulk Notification
                    </button>
                </div>
            `;
            overviewSection.appendChild(bulkSection);
        }
    }

    // Export applicants data
    async exportApplicantsData() {
        // This would typically generate and download an Excel file
        alert('Export functionality would be implemented here');
    }

    // Send bulk notification
    async sendBulkNotification() {
        const message = prompt('Enter notification message for all applicants:');
        if (message) {
            alert(`Bulk notification would be sent: "${message}"`);
            // Implement actual notification logic here
        }
    }

    // Send notification to specific applicant
    async sendNotification(userId) {
        const message = prompt('Enter notification message:');
        if (message) {
            alert(`Notification sent to applicant: "${message}"`);
            // Implement actual notification logic here
        }
    }

    // Add internal note
    async addInternalNote(userId) {
        const note = prompt('Add internal note:');
        if (note) {
            try {
                await db.collection('applications').doc(userId).update({
                    internalNotes: firebase.firestore.FieldValue.arrayUnion({
                        note: note,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        admin: currentUser.uid
                    })
                });
                alert('Internal note added successfully!');
            } catch (error) {
                alert('Error adding note: ' + error.message);
            }
        }
    }

    // Render admin documents
    renderAdminDocuments(documents) {
        if (Object.keys(documents).length === 0) {
            return '<p>No documents uploaded yet.</p>';
        }

        return Object.entries(documents).map(([docType, doc]) => `
            <div class="document-item">
                <div style="flex: 1;">
                    <strong>${docType.replace('_', ' ').toUpperCase()}</strong>
                    <div>File: ${doc.fileName}</div>
                    <div>Uploaded: ${doc.uploadedAt?.toDate?.().toLocaleDateString() || 'Unknown date'}</div>
                    <div>Status: ${doc.status}</div>
                    ${doc.comments ? `<div>Comments: ${doc.comments}</div>` : ''}
                </div>
                <div class="document-actions">
                    <a href="${doc.url}" target="_blank" class="btn btn-small btn-primary">View</a>
                    <select onchange="adminManager.updateDocumentStatus('${docType}', this.value, '${applicant.userId}')" 
                            class="form-control" style="margin-left: 5px;">
                        <option value="pending_review" ${doc.status === 'pending_review' ? 'selected' : ''}>Pending</option>
                        <option value="approved" ${doc.status === 'approved' ? 'selected' : ''}>Approved</option>
                        <option value="rejected" ${doc.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                    </select>
                </div>
            </div>
        `).join('');
    }

    // Update document status
    async updateDocumentStatus(docType, status, userId) {
        try {
            await db.collection('applications').doc(userId).update({
                [`documents.${docType}.status`]: status,
                [`documents.${docType}.reviewedBy`]: currentUser.uid,
                [`documents.${docType}.reviewDate`]: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // Show comments input if rejected
            if (status === 'rejected') {
                const comments = prompt('Please provide comments for rejection:');
                if (comments) {
                    await db.collection('applications').doc(userId).update({
                        [`documents.${docType}.comments`]: comments
                    });
                }
            }
            
            alert('Document status updated successfully!');
        } catch (error) {
            alert('Error updating document status: ' + error.message);
        }
    }
}

// Initialize admin manager
const adminManager = new AdminManager();

// ==================== REAL ADMIN FUNCTIONS ====================

// Show/hide admin controls based on user role - FIXED VERSION
function toggleAdminControls() {
    const adminControls = document.getElementById('adminDocumentControls');
    
    // Only show admin controls if we're in the ADMIN dashboard
    const isInAdminDashboard = document.getElementById('adminDashboard').style.display === 'block';
    
    if (adminControls && currentUser && isAdmin && isInAdminDashboard) {
        adminControls.style.display = 'block';
    } else if (adminControls) {
        adminControls.style.display = 'none';
    }
}

// Real document status update function
async function adminUpdateDocumentStatus(docType, status) {
    if (!currentUser || !isAdmin) {
        alert('Admin access required');
        return;
    }

    const statusMessages = {
        'file_received': 'Document received and queued for review',
        'under_review': 'Document is currently under review', 
        'approved': 'Document has been approved',
        'needs_correction': 'Document needs corrections',
        'rejected': 'Document was rejected'
    };

    try {
        // Update in Firestore
        await db.collection('applications').doc(currentUser.uid).update({
            [`documents.${docType}.status`]: status,
            [`documents.${docType}.adminStatus`]: status,
            [`documents.${docType}.reviewedBy`]: currentUser.uid,
            [`documents.${docType}.reviewDate`]: firebase.firestore.FieldValue.serverTimestamp(),
            [`documents.${docType}.lastUpdated`]: new Date(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Send notification to user
        await adminSendDocumentNotification(docType, status, statusMessages[status]);
        
        // Show success
        alert(`✅ ${docType.replace('_', ' ').toUpperCase()} status updated to: ${status.replace('_', ' ').toUpperCase()}`);
        
        // Refresh the UI
        documentManager.loadUserDocuments();
        
    } catch (error) {
        console.error('Admin document update error:', error);
        alert('Error updating document: ' + error.message);
    }
}

// Manual status update with custom notes
async function adminManualStatusUpdate() {
    if (!currentUser || !isAdmin) {
        alert('Admin access required');
        return;
    }

    const docType = document.getElementById('adminDocType').value;
    const status = document.getElementById('adminDocStatus').value;
    const notes = document.getElementById('adminDocNotes').value;

    if (!docType || !status) {
        alert('Please select document type and status');
        return;
    }

    try {
        const updateData = {
            [`documents.${docType}.status`]: status,
            [`documents.${docType}.adminStatus`]: status,
            [`documents.${docType}.reviewedBy`]: currentUser.uid,
            [`documents.${docType}.reviewDate`]: firebase.firestore.FieldValue.serverTimestamp(),
            [`documents.${docType}.lastUpdated`]: new Date(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Add notes if provided
        if (notes.trim()) {
            updateData[`documents.${docType}.adminNotes`] = notes.trim();
        }

        await db.collection('applications').doc(currentUser.uid).update(updateData);

        // Send notification
        await adminSendDocumentNotification(docType, status, notes.trim() || `Status updated to: ${status.replace('_', ' ')}`);

        alert(`✅ Document status updated successfully!`);
        
        // Clear form
        document.getElementById('adminDocNotes').value = '';
        
        // Refresh UI
        documentManager.loadUserDocuments();

    } catch (error) {
        console.error('Manual status update error:', error);
        alert('Error updating status: ' + error.message);
    }
}

// Update application stage
async function adminUpdateApplicationStage(stage, completed) {
    if (!currentUser || !isAdmin) {
        alert('Admin access required');
        return;
    }

    try {
        await db.collection('applications').doc(currentUser.uid).update({
            [`applicationStages.${stage}`]: {
                completed: completed,
                status: completed ? 'completed' : 'in_progress',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedBy: currentUser.uid
            },
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert(`✅ Application stage "${stage}" updated to ${completed ? 'completed' : 'in progress'}`);
        
        // Refresh dashboard
        updateDashboardUI();

    } catch (error) {
        console.error('Stage update error:', error);
        alert('Error updating stage: ' + error.message);
    }
}

// Send document status notification to user
async function adminSendDocumentNotification(docType, status, message) {
    if (!currentUser) return;

    const statusEmoji = {
        'file_received': '✅',
        'under_review': '🔍', 
        'approved': '🎉',
        'needs_correction': '⚠️',
        'rejected': '❌'
    };

    const notificationMessage = `
${statusEmoji[status] || '📄'} DOCUMENT UPDATE

Your ${docType.replace('_', ' ').toUpperCase()} has been updated.

Status: ${status.replace('_', ' ').toUpperCase()}
${message ? `Notes: ${message}` : ''}

Thank you for using Global Immigration SC!
    `.trim();

    try {
        // Store in user notifications
        await db.collection('applications').doc(currentUser.uid).update({
            userNotifications: firebase.firestore.FieldValue.arrayUnion({
                message: notificationMessage,
                type: 'document_update',
                timestamp: new Date(),
                read: false,
                docType: docType,
                status: status
            }),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        console.log('Document notification sent to user');

    } catch (error) {
        console.error('Error sending notification:', error);
    }
}

// Send general status notification
async function adminSendStatusNotification() {
    const message = prompt('Enter status update message for the applicant:');
    if (message) {
        await adminSendDocumentNotification('general', 'info', message);
        alert('✅ Status notification sent to applicant!');
    }
}
        
// Enhanced admin dashboard with delete functionality
function enhanceAdminDashboard() {
    console.log('🚀 Enhancing admin dashboard with delete functionality...');
    
    // Add delete functionality to applicants list
    addDeleteFunctionality();
    
    // Add bulk delete options
    addBulkDeleteOptions();
    
    // Setup real-time updates that include delete buttons
    setupAdminRealTimeWithDelete();
}

// Delete applicant function
async function deleteApplicant(userId, userName) {
    // Enhanced confirmation with type-to-confirm
    const confirmationMessage = `🚨 FINAL CONFIRMATION REQUIRED\n\nYou are about to PERMANENTLY DELETE:\nApplicant: ${userName}\nUser ID: ${userId}\n\n⚠️  This will remove:\n• User account\n• Application data\n• Uploaded documents\n• Payment records\n\n📛 THIS ACTION CANNOT BE UNDONE!\n\nType "DELETE" to confirm:`;
    
    const userInput = prompt(confirmationMessage);
    if (userInput !== 'DELETE') {
        alert('Deletion cancelled. Applicant data preserved.');
        return;
    }
    
    try {
        console.log(`🗑️ Deleting applicant: ${userName} (${userId})`);
        
        // 1. Delete application data
        await firebase.firestore().collection('applications').doc(userId).delete();
        console.log('✅ Application data deleted');
        
        // 2. Delete user profile
        await firebase.firestore().collection('users').doc(userId).delete();
        console.log('✅ User profile deleted');
        
        // 3. Delete uploaded documents from storage
        try {
            const storageRef = firebase.storage().ref();
            const userFilesRef = storageRef.child(userId);
            const files = await userFilesRef.listAll();
            
            const deletePromises = files.items.map(fileRef => fileRef.delete());
            await Promise.all(deletePromises);
            console.log(`✅ Deleted ${files.items.length} uploaded files`);
        } catch (storageError) {
            console.log('⚠️ Could not delete storage files:', storageError.message);
        }
        
        alert(`✅ Successfully deleted applicant: ${userName}`);
        console.log(`🎉 Applicant ${userName} completely removed from system`);
        
        // Refresh the applicants list
        addDeleteFunctionality();
        
    } catch (error) {
        console.log('❌ Error deleting applicant:', error);
        alert('Error deleting applicant: ' + error.message);
    }
}

// View applicant details
async function viewApplicantDetails(userId) {
    const appDoc = await firebase.firestore().collection('applications').doc(userId).get();
    const userDoc = await firebase.firestore().collection('users').doc(userId).get();
    
    const appData = appDoc.data();
    const userData = userDoc.data();
    
    const detailHTML = `
        <h3>Applicant Details</h3>
        <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
            <p><strong>Name:</strong> ${userData?.name || 'Unknown'}</p>
            <p><strong>Email:</strong> ${userData?.email || 'No email'}</p>
            <p><strong>User ID:</strong> ${userId}</p>
            <p><strong>Status:</strong> ${appData?.status || 'unknown'}</p>
            <p><strong>Progress:</strong> ${appData?.progress || 0}%</p>
            <p><strong>Country:</strong> ${appData?.personalInfo?.country || 'Not specified'}</p>
            <p><strong>Documents Uploaded:</strong> ${Object.keys(appData?.documents || {}).length}</p>
            <p><strong>Application Date:</strong> ${appData?.createdAt?.toDate?.().toLocaleDateString() || 'Unknown'}</p>
        </div>
        <button onclick="deleteApplicant('${userId}', '${userData?.name || 'Unknown'}')" class="btn" style="background: #e74c3c; color: white; width: 100%;">Delete This Applicant</button>
    `;
    
    // Create a modal to show details
    const modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    modal.style.zIndex = '10000';
    
    modal.innerHTML = `
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">Applicant Details</h3>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            ${detailHTML}
        </div>
    `;
    
    document.body.appendChild(modal);
}

// Add delete functionality to admin dashboard
function addDeleteFunctionality() {
    console.log('🛠️ Adding delete functionality to admin dashboard...');
    
    const setupEnhancedApplicantsList = async () => {
        const applicationsSnapshot = await firebase.firestore().collection('applications').get();
        const container = document.getElementById('applicantsList');
        
        if (!container) {
            console.log('❌ Could not find applicants list container');
            return;
        }
        
        container.innerHTML = '';
        
        for (const doc of applicationsSnapshot.docs) {
            const appData = doc.data();
            const userDoc = await firebase.firestore().collection('users').doc(appData.userId).get();
            const userData = userDoc.data();
            
            const card = document.createElement('div');
            card.className = 'applicant-card';
            card.style.position = 'relative';
            
            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 2;">
                        <h4 style="margin: 0 0 5px 0;">${userData?.name || 'Unknown User'}</h4>
                        <p style="margin: 0 0 3px 0; color: #666;">${userData?.email || 'No email'}</p>
                        <p style="margin: 0 0 3px 0; font-size: 0.9em;">User ID: ${appData.userId.substring(0, 8)}...</p>
                    </div>
                    <div style="text-align: right;">
                        <span class="status-badge status-${appData.status}" style="display: inline-block; margin-bottom: 5px;">
                            ${appData.status.toUpperCase()}
                        </span>
                        <div style="font-size: 0.9em;">${appData.createdAt?.toDate?.().toLocaleDateString() || 'Unknown date'}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="viewApplicantDetails('${appData.userId}')" class="btn btn-primary btn-small">View</button>
                    <button onclick="deleteApplicant('${appData.userId}', '${userData?.name || 'Unknown'}')" class="btn btn-outline btn-small" style="background: #e74c3c; color: white; border-color: #e74c3c;">Delete</button>
                </div>
            `;
            
            container.appendChild(card);
        }
        
        console.log('✅ Delete buttons added to all applicants');
    };
    
    setupEnhancedApplicantsList();
}

// Bulk delete options
function addBulkDeleteOptions() {
    console.log('🛠️ Adding bulk delete options...');
    
    const overviewSection = document.getElementById('adminOverview');
    if (overviewSection) {
        const bulkSection = document.createElement('div');
        bulkSection.style.marginTop = '30px';
        bulkSection.style.padding = '20px';
        bulkSection.style.background = '#fff3f3';
        bulkSection.style.borderRadius = '8px';
        bulkSection.style.border = '2px solid #e74c3c';
        
        bulkSection.innerHTML = `
            <h4 style="color: #e74c3c; margin-top: 0;">🚨 Bulk Delete Operations</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="deleteRejectedApplicants()" class="btn" style="background: #e74c3c; color: white;">
                    🗑️ Delete All Rejected
                </button>
                <button onclick="deleteByStatus('draft')" class="btn" style="background: #f39c12; color: white;">
                    🗑️ Delete Drafts
                </button>
            </div>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                ⚠️ These actions are permanent and cannot be undone!
            </p>
        `;
        
        overviewSection.appendChild(bulkSection);
    }
}

// Bulk delete functions
async function deleteRejectedApplicants() {
    if (!confirm('🚨 DELETE ALL REJECTED APPLICANTS?\n\nThis will permanently remove ALL applicants with REJECTED status.\n\nThis action cannot be undone!')) {
        return;
    }
    
    try {
        const rejectedSnapshot = await firebase.firestore().collection('applications')
            .where('status', '==', 'rejected')
            .get();
        
        if (rejectedSnapshot.empty) {
            alert('No rejected applicants found!');
            return;
        }
        
        let deletedCount = 0;
        
        for (const doc of rejectedSnapshot.docs) {
            const appData = doc.data();
            const userDoc = await firebase.firestore().collection('users').doc(appData.userId).get();
            const userData = userDoc.data();
            
            await firebase.firestore().collection('applications').doc(appData.userId).delete();
            await firebase.firestore().collection('users').doc(appData.userId).delete();
            
            deletedCount++;
            console.log(`✅ Deleted rejected applicant: ${userData?.name}`);
        }
        
        alert(`✅ Successfully deleted ${deletedCount} rejected applicants`);
        addDeleteFunctionality();
        
    } catch (error) {
        console.log('Error:', error);
        alert('Error deleting rejected applicants: ' + error.message);
    }
}

async function deleteByStatus(status) {
    if (!confirm(`🚨 DELETE ALL APPLICANTS WITH STATUS: ${status.toUpperCase()}?\n\nThis action cannot be undone!`)) {
        return;
    }
    
    try {
        const snapshot = await firebase.firestore().collection('applications')
            .where('status', '==', status)
            .get();
        
        if (snapshot.empty) {
            alert(`No applicants found with status: ${status}`);
            return;
        }
        
        let deletedCount = 0;
        
        for (const doc of snapshot.docs) {
            const appData = doc.data();
            await firebase.firestore().collection('applications').doc(appData.userId).delete();
            await firebase.firestore().collection('users').doc(appData.userId).delete();
            deletedCount++;
        }
        
        alert(`✅ Successfully deleted ${deletedCount} applicants with status: ${status}`);
        addDeleteFunctionality();
        
    } catch (error) {
        console.log('Error:', error);
        alert('Error deleting applicants: ' + error.message);
    }
}

// Real-time updates with delete functionality
function setupAdminRealTimeWithDelete() {
    console.log('🔄 Setting up real-time admin updates with delete...');
    
    firebase.firestore().collection('applications')
        .onSnapshot((snapshot) => {
            console.log('📈 Application data changed, refreshing with delete buttons...');
            addDeleteFunctionality(); // This will refresh the list with delete buttons
        });
}

// === ADD THIS FUNCTION - COLLECTS ALL FORM DATA ===
function collectFormData(reportId) {
    const formData = {
        reportId: reportId,
        timestamp: new Date().toISOString(),
        reporterName: document.getElementById('reporterName').value,
        reporterEmail: document.getElementById('reporterEmail').value,
        reporterPhone: document.getElementById('reporterPhone').value,
        contactMethod: document.querySelector('input[name="contactMethod"]:checked')?.value,
        anonymousReport: document.getElementById('anonymousReport').checked,
        incidentCountry: document.getElementById('incidentCountry').value,
        incidentCity: document.getElementById('incidentCity').value,
        suspectName: document.getElementById('suspectName').value,
        suspectWebsite: document.getElementById('suspectWebsite').value,
        suspectContact: document.getElementById('suspectContact').value,
        incidentDateFrom: document.getElementById('incidentDateFrom').value,
        incidentDateTo: document.getElementById('incidentDateTo').value,
        currency: document.getElementById('currency').value,
        amountPaid: document.getElementById('amountPaid').value || '0',
        paymentMethods: Array.from(document.querySelectorAll('input[name="paymentMethod"]:checked')).map(cb => cb.value).join(', '),
        complaintSummary: document.getElementById('complaintSummary').value,
        detailedDescription: document.getElementById('detailedDescription').value,
        witnesses: document.getElementById('witnesses').value,
        fileCount: uploadedFiles.length,
        fileNames: uploadedFiles.map(file => file.name).join(', '),
        status: 'New Report',
        submissionDate: new Date().toLocaleDateString()
    };
    
    console.log('Form data collected:', formData);
    return formData;
}

// === REPLACE YOUR submitToGoogleSheets FUNCTION ===
async function submitToGoogleSheets(formData) {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwo7OkMyoZuizM8dQJFcczdygmZOBtz1LMn91yuKFvmSV0JOgYZAkjceJp81Ky3ZZI/exec';
    
    try {
        console.log('Starting form submission to Google Sheets...', formData);
        
        // Convert to URL-encoded form data
        const formDataToSend = new URLSearchParams();
        Object.keys(formData).forEach(key => {
            if (formData[key] !== null && formData[key] !== undefined) {
                formDataToSend.append(key, formData[key].toString());
            }
        });
        
        console.log('Sending data to:', scriptURL);
        
        const response = await fetch(scriptURL, {
            method: 'POST',
            body: formDataToSend
            // Don't set Content-Type header - let browser set it for FormData
        });
        
        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers);
        
        const result = await response.json();
        console.log('Response received:', result);
        
        if (result.status === 'success') {
            console.log('Form submitted successfully!');
            return { 
                status: 'success', 
                message: 'Report submitted successfully',
                reportId: result.reportId,
                sheetRow: result.sheetRow
            };
        } else {
            throw new Error(result.message || 'Submission failed');
        }
        
    } catch (error) {
        console.error('Submission error:', error);
        throw new Error('Failed to submit report: ' + error.message);
    }
}

// === ADD THIS FUNCTION TO RESET THE FORM ===
function resetReportForm() {
    document.querySelector('.fraud-report-form').style.display = 'block';
    document.getElementById('reportSuccess').style.display = 'none';
    
    // Clear all form fields
    document.getElementById('reporterName').value = '';
    document.getElementById('reporterEmail').value = '';
    document.getElementById('reporterPhone').value = '';
    document.getElementById('incidentCountry').value = '';
    document.getElementById('incidentCity').value = '';
    document.getElementById('suspectName').value = '';
    document.getElementById('suspectWebsite').value = '';
    document.getElementById('suspectContact').value = '';
    document.getElementById('incidentDateFrom').value = '';
    document.getElementById('incidentDateTo').value = '';
    document.getElementById('amountPaid').value = '';
    document.getElementById('complaintSummary').value = '';
    document.getElementById('detailedDescription').value = '';
    document.getElementById('witnesses').value = '';
    document.getElementById('legalConsent').checked = false;
    document.getElementById('humanVerification').value = '';
    
    // Clear file uploads
    const filePreviews = document.getElementById('filePreviews');
    if (filePreviews) filePreviews.innerHTML = '';
    uploadedFiles = [];
    
    // Reset to first step
    navigateToStep('1');
    updateProgressBar();
    
    console.log('Form reset successfully');
}

// === UPDATE YOUR SUBMIT REPORT FUNCTION ===
async function submitReportForm() {
    const submitBtn = document.getElementById('submitReport');
    const btnText = submitBtn.querySelector('.btn-text');
    const spinner = submitBtn.querySelector('.loading-spinner');
    
    try {
        // Validate final step
        if (!validateStep('step-4')) {
            alert('Please complete all required fields before submitting.');
            return;
        }
        
        // Validate CAPTCHA
        const humanInput = document.getElementById('humanVerification');
        if (!humanInput || humanInput.value.trim().toUpperCase() !== 'I AM HUMAN') {
            alert('Please complete the security check by typing "I AM HUMAN" exactly as shown.');
            return;
        }
        
        // Show loading state
        btnText.textContent = 'Submitting...';
        spinner.style.display = 'inline-block';
        submitBtn.disabled = true;
        
        // Generate unique report ID
        const reportId = 'FR-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        
        // Collect form data
        const formData = collectFormData(reportId);
        
        // Submit to Google Sheets
        const result = await submitToGoogleSheets(formData);
        
        if (result.status === 'success') {
            // Show success message
            document.querySelector('.fraud-report-form').style.display = 'none';
            document.getElementById('reportSuccess').style.display = 'block';
            document.getElementById('successReportId').textContent = reportId;
            
            console.log('Report submitted successfully with ID:', reportId);
        } else {
            throw new Error(result.message);
        }
        
    } catch (error) {
        console.error('Form submission error:', error);
        alert('Error submitting report: ' + error.message);
        
        // Reset button state
        btnText.textContent = 'Submit Report';
        spinner.style.display = 'none';
        submitBtn.disabled = false;
    }
}

// Application State Management
        let currentUser = null;
        let userApplication = null;
        let realTimeListener = null;
        let isAdmin = false;

                // Collect all form data for submission - ADD THIS FUNCTION
        function collectFormData(reportId) {
            const formData = {
                reportId: reportId,
                timestamp: new Date().toISOString(),
                reporterName: document.getElementById('reporterName').value,
                reporterEmail: document.getElementById('reporterEmail').value,
                reporterPhone: document.getElementById('reporterPhone').value,
                contactMethod: document.querySelector('input[name="contactMethod"]:checked')?.value,
                anonymousReport: document.getElementById('anonymousReport').checked,
                incidentCountry: document.getElementById('incidentCountry').value,
                incidentCity: document.getElementById('incidentCity').value,
                suspectName: document.getElementById('suspectName').value,
                suspectWebsite: document.getElementById('suspectWebsite').value,
                suspectContact: document.getElementById('suspectContact').value,
                incidentDateFrom: document.getElementById('incidentDateFrom').value,
                incidentDateTo: document.getElementById('incidentDateTo').value,
                currency: document.getElementById('currency').value,
                amountPaid: document.getElementById('amountPaid').value || '0',
                paymentMethods: Array.from(document.querySelectorAll('input[name="paymentMethod"]:checked')).map(cb => cb.value).join(', '),
                complaintSummary: document.getElementById('complaintSummary').value,
                detailedDescription: document.getElementById('detailedDescription').value,
                witnesses: document.getElementById('witnesses').value,
                fileCount: uploadedFiles.length,
                fileNames: uploadedFiles.map(file => file.name).join(', '),
                status: 'New Report',
                submissionDate: new Date().toLocaleDateString()
            };
            
            console.log('Form data collected:', formData);
            return formData;
        }

                // Reset the report form to initial state - ADD THIS FUNCTION
        function resetReportForm() {
            document.querySelector('.fraud-report-form').style.display = 'block';
            document.getElementById('reportSuccess').style.display = 'none';
            
            document.getElementById('reporterName').value = '';
            document.getElementById('reporterEmail').value = '';
            document.getElementById('reporterPhone').value = '';
            document.getElementById('incidentCountry').value = '';
            document.getElementById('incidentCity').value = '';
            document.getElementById('suspectName').value = '';
            document.getElementById('suspectWebsite').value = '';
            document.getElementById('suspectContact').value = '';
            document.getElementById('incidentDateFrom').value = '';
            document.getElementById('incidentDateTo').value = '';
            document.getElementById('amountPaid').value = '';
            document.getElementById('complaintSummary').value = '';
            document.getElementById('detailedDescription').value = '';
            document.getElementById('witnesses').value = '';
            document.getElementById('legalConsent').checked = false;
            document.getElementById('humanVerification').value = '';
            
            const filePreviews = document.getElementById('filePreviews');
            if (filePreviews) filePreviews.innerHTML = '';
            uploadedFiles = [];
            
            navigateToStep('1');
            updateProgressBar();
            initializeFileUpload();
            
            console.log('Form reset successfully');
        }

        // Profile Management Functions
function handleProfileUpdate(event) {
    event.preventDefault();
    
    const name = document.getElementById('dashboardName').value;
    const email = document.getElementById('dashboardEmail').value;
    const phone = document.getElementById('dashboardPhone').value;
    const address = document.getElementById('dashboardAddress').value;
    const country = document.getElementById('dashboardCountry').value;
    
    if (!currentUser) {
        alert('Please log in to update your profile.');
        return;
    }
    
    // Show loading state
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'Updating...';
    button.disabled = true;
    
    // First, check if user document exists
    const userRef = db.collection('users').doc(currentUser.uid);
    
    userRef.get().then((doc) => {
        if (doc.exists) {
            // Document exists, update it
            return userRef.update({
                name: name,
                email: email,
                phone: phone,
                address: address,
                country: country,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        } else {
            // Document doesn't exist, create it
            return userRef.set({
                name: name,
                email: email,
                phone: phone,
                address: address,
                country: country,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                userType: 'applicant'
            });
        }
    })
    .then(() => {
        // Now update application personal info
        const appRef = db.collection('applications').doc(currentUser.uid);
        
        return appRef.get().then((doc) => {
            if (doc.exists) {
                // Application exists, update it
                return appRef.update({
                    'personalInfo.name': name,
                    'personalInfo.phone': phone,
                    'personalInfo.address': address,
                    'personalInfo.country': country,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } else {
                // Application doesn't exist, create it with basic structure
                return appRef.set({
                    userId: currentUser.uid,
                    status: 'draft',
                    progress: 0,
                    currentStep: 'personal_info',
                    personalInfo: {
                        name: name,
                        phone: phone,
                        address: address,
                        country: country
                    },
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    documents: {},
                    payments: [],
                    applicationStages: {
                        personal_info: { status: 'completed', completed: true },
                        document_upload: { status: 'pending', completed: false },
                        payment: { status: 'pending', completed: false },
                        review: { status: 'pending', completed: false },
                        approval: { status: 'pending', completed: false }
                    }
                });
            }
        });
    })
    .then(() => {
        alert('Profile updated successfully!');
        // Update application stages
        updateApplicationStage('personal_info', true);
    })
    .catch((error) => {
        console.error('Error updating profile:', error);
        alert('Error updating profile: ' + error.message);
    })
    .finally(() => {
        // Reset button
        button.textContent = originalText;
        button.disabled = false;
    });
}

function handlePasswordChange(event) {
    event.preventDefault();
    
    const currentPassword = document.getElementById('currentPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmNewPassword').value;
    
    if (!currentPassword || !newPassword || !confirmPassword) {
        alert('Please fill in all password fields.');
        return;
    }
    
    if (newPassword !== confirmPassword) {
        alert('New passwords do not match.');
        return;
    }
    
    if (newPassword.length < 6) {
        alert('New password must be at least 6 characters long.');
        return;
    }
    
    // Show loading state
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'Changing Password...';
    button.disabled = true;
    
    // Reauthenticate user first
    const user = auth.currentUser;
    const credential = firebase.auth.EmailAuthProvider.credential(
        user.email, 
        currentPassword
    );
    
    user.reauthenticateWithCredential(credential)
        .then(() => {
            // Change password
            return user.updatePassword(newPassword);
        })
        .then(() => {
            alert('Password changed successfully!');
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
        })
        .catch((error) => {
            console.error('Error changing password:', error);
            if (error.code === 'auth/wrong-password') {
                alert('Current password is incorrect.');
            } else {
                alert('Error changing password: ' + error.message);
            }
        })
        .finally(() => {
            // Reset button
            button.textContent = originalText;
            button.disabled = false;
        });
}

// Payment Confirmation System
function initializePaymentConfirmation() {
    const makePaymentBtn = document.querySelector('#payments .btn-primary');
    if (makePaymentBtn) {
        makePaymentBtn.addEventListener('click', showPaymentInformation);
    }
    
    // Add payment confirmation upload area to payments section
    const paymentsSection = document.getElementById('payments');
    const confirmationSection = document.createElement('div');
    confirmationSection.innerHTML = `
        <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
            <h4>Payment Confirmation</h4>
            <p>Upload screenshot or proof of payment for verification</p>
            
            <div class="upload-area" id="paymentConfirmationUpload" style="margin: 15px 0;">
                <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>Click or drag payment confirmation screenshot</p>
                <input type="file" id="paymentUploadInput" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
                <div class="upload-progress">
                    <div class="upload-progress-bar" id="paymentProgress"></div>
                </div>
            </div>
            
            <div id="paymentConfirmationStatus" style="margin-top: 10px;"></div>
        </div>
    `;
    
    paymentsSection.appendChild(confirmationSection);
    
    // Initialize payment confirmation upload
    const paymentUploadArea = document.getElementById('paymentConfirmationUpload');
    const paymentFileInput = document.getElementById('paymentUploadInput');
    
    paymentUploadArea.addEventListener('click', () => paymentFileInput.click());
    paymentFileInput.addEventListener('change', (e) => {
        if (e.target.files[0]) {
            handlePaymentConfirmationUpload(e.target.files[0]);
        }
    });
}

function showPaymentInformation() {
    const paymentInfoHTML = `
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="color: var(--primary-red); margin-bottom: 15px;">💳 Payment Information – Global Immigration SC</h3>
            
            <p><strong>Dear Applicant,</strong></p>
            <p>To proceed with your application, please make your payment using any of the following options below 👇</p>
            
            <div style="margin: 20px 0;">
                <h4>1️⃣ Mobile Money Payments</h4>
                <p>📱 Orange Money: +231 770562292</p>
                <p>📱 Lonestar Money: +231 886590302</p>
                <p><strong>Account Name: Darling Tamba</strong></p>
            </div>
            
            <div style="margin: 20px 0;">
                <h4>2️⃣ Bank Payment (UBA Liberia)</h4>
                <p>🏦 Account Name: Darlington Tamba</p>
                <p>💳 Account Number: 53080500327155</p>
                <p>Bank: United Bank for Africa (UBA)</p>
            </div>
            
            <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin: 20px 0;">
                <p><strong>✅ After payment, kindly upload a screenshot or confirmation message to the upload confirmation section for verification:</strong></p>
                <p>📞 +231 770562292 | +231 886590302</p>
                <p>📧 Email: infoglobalimmigrationsc@gmail.com</p>
            </div>
            
            <p style="text-align: center; font-style: italic;">Thank you for choosing Global Immigration SC — your trusted partner for study, work, and travel abroad. 🌍✈️</p>
        </div>
    `;
    
    // Create modal for payment information
    const modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    modal.style.zIndex = '10000';
    
    modal.innerHTML = `
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: var(--primary-red);">Payment Instructions</h3>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--primary-red);">&times;</button>
            </div>
            ${paymentInfoHTML}
            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="btn btn-primary" style="width: 100%; margin-top: 20px;">I Understand</button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

async function handlePaymentConfirmationUpload(file) {
    if (!file || !currentUser) {
        alert('Please log in to upload payment confirmation.');
        return;
    }
    
    try {
        const uploadArea = document.getElementById('paymentConfirmationUpload');
        const statusElement = document.getElementById('paymentConfirmationStatus');
        
        // Show uploading state
        uploadArea.innerHTML = `
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Uploading Payment Confirmation...</p>
            <div class="upload-progress">
                <div class="upload-progress-bar" style="width: 0%"></div>
            </div>
        `;
        
        // Get the new progress bar element after updating innerHTML
        const progressBar = uploadArea.querySelector('.upload-progress-bar'); // ← FIXED: Use const
        
        // Validate file type
        const validTypes = ['.pdf', '.jpg', '.jpeg', '.png'];
        const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
        
        if (!validTypes.includes(fileExtension)) {
            alert('Please upload PDF, JPG, JPEG, or PNG files only.');
            resetPaymentUploadArea();
            return;
        }
        
        // Validate file size (10MB max)
        const maxSize = 10 * 1024 * 1024;
        if (file.size > maxSize) {
            alert('File size must be less than 10MB.');
            resetPaymentUploadArea();
            return;
        }
        
        // Create unique filename
        const fileName = `${currentUser.uid}/payment_confirmation_${Date.now()}_${file.name}`;
    
        
        // Upload file
       
        
        uploadTask.on('state_changed',
            (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
            },
            (error) => {
                console.error('Payment confirmation upload failed:', error);
                if (statusElement) {
                    statusElement.innerHTML = '<p style="color: red;">Upload failed. Please try again.</p>';
                }
                resetPaymentUploadArea();
            },
            async () => {
                try {
                    
    
                    // Update application with payment confirmation
                    await db.collection('applications').doc(currentUser.uid).update({
                        paymentConfirmation: {
                            url: downloadURL,
                            fileName: file.name,
                            uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'pending_verification',
                            fileSize: file.size,
                            fileType: file.type
                        },
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Show success
                    if (statusElement) {
                        statusElement.innerHTML = '<p style="color: green;">✅ Payment confirmation uploaded successfully! We will verify your payment shortly.</p>';
                    }
                    uploadArea.innerHTML = `
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; color: #4CAF50;"></i>
                        <p>Confirmation Uploaded!</p>
                        <p style="font-size: 0.8em; color: #666;">${file.name}</p>
                    `;
                    
                } catch (error) {
                    console.error('Error updating payment confirmation:', error);
                    if (statusElement) {
                        statusElement.innerHTML = '<p style="color: red;">Error saving confirmation. Please contact support.</p>';
                    }
                    resetPaymentUploadArea();
                }
            }
        );
        
    } catch (error) {
        console.error('Payment confirmation upload error:', error);
        alert('Upload failed: ' + error.message);
        resetPaymentUploadArea();
    }
}

function resetPaymentUploadArea() {
    const uploadArea = document.getElementById('paymentConfirmationUpload');
    if (!uploadArea) return;
    
    uploadArea.innerHTML = `
        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
        <p>Click or drag payment confirmation screenshot</p>
        <input type="file" id="paymentUploadInput" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
        <div class="upload-progress">
            <div class="upload-progress-bar" id="paymentProgress"></div>
        </div>
    `;
    
    // Re-attach event listeners
    const paymentFileInput = document.getElementById('paymentUploadInput');
    if (paymentFileInput) {
        uploadArea.addEventListener('click', () => paymentFileInput.click());
        paymentFileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handlePaymentConfirmationUpload(e.target.files[0]);
            }
        });
    }
}

// Enhanced Payment History with Real-time Updates
function initializePaymentHistory() {
    // This will be called when the payments section is loaded
    loadPaymentHistory();
}

async function loadPaymentHistory() {
    if (!currentUser) return;
    
    try {
        const appDoc = await db.collection('applications').doc(currentUser.uid).get();
        const appData = appDoc.data();
        
        const payments = appData.payments || [
            { date: '2023-10-15', description: 'Application Fee', amount: 150.00, status: 'completed' },
            { date: '2023-10-20', description: 'Document Processing', amount: 75.00, status: 'pending' },
            { date: '2023-10-25', description: 'Visa Processing Fee', amount: 200.00, status: 'pending' }
        ];
        
        updatePaymentTable(payments);
        updateOutstandingPayments(payments);
        
    } catch (error) {
        console.error('Error loading payment history:', error);
    }
}

function updatePaymentTable(payments) {
    const tableBody = document.querySelector('.payment-table tbody');
    if (!tableBody) return;
    
    tableBody.innerHTML = payments.map(payment => `
        <tr>
            <td>${payment.date}</td>
            <td>${payment.description}</td>
            <td>$${payment.amount.toFixed(2)}</td>
            <td><span class="payment-status status-${payment.status}">${payment.status.toUpperCase()}</span></td>
        </tr>
    `).join('');
}

function updateOutstandingPayments(payments) {
    const paymentsSection = document.getElementById('payments');
    if (!paymentsSection) {
        console.log('Payments section not found');
        return;
    }
    
    const outstandingSection = paymentsSection.querySelector('.dashboard-section');
    if (!outstandingSection) {
        console.log('Outstanding payments section not found');
        return;
    }
    
    const outstandingAmount = payments
        .filter(p => p.status === 'pending')
        .reduce((sum, payment) => sum + payment.amount, 0);
    
    // Find or create outstanding payments div
    let outstandingDiv = outstandingSection.querySelector('#outstandingPayments');
    if (!outstandingDiv) {
        outstandingDiv = document.createElement('div');
        outstandingDiv.id = 'outstandingPayments';
        outstandingSection.appendChild(outstandingDiv);
    }
    
    outstandingDiv.innerHTML = `
        <h4>Outstanding Payments</h4>
        <p>You have <strong>$${outstandingAmount.toFixed(2)}</strong> in outstanding payments.</p>
        <button class="btn btn-primary" style="margin-top: 15px;" onclick="showPaymentInformation()">Make Payment</button>
    `;
}
// Initialize all systems when dashboard is shown
function initializeDashboardSystems() {
    initializeDocumentUpload();
    initializeProfileManagement();
    initializePaymentConfirmation();
    initializePaymentHistory();
    updateDashboardUI();
    
    // Initialize enhanced document management system
    documentManager.initialize();
}

// Profile Management Initialization
function initializeProfileManagement() {
    // This will be called to set up profile management
    loadUserProfile();
}

async function loadUserProfile() {
    if (!currentUser) return;
    
    try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        const appDoc = await db.collection('applications').doc(currentUser.uid).get();
        
        let userData = {};
        let appData = {};
        
        if (userDoc.exists) {
            userData = userDoc.data();
        }
        
        if (appDoc.exists) {
            appData = appDoc.data();
        }
        
        // Update profile form fields with existing data or defaults
        document.getElementById('dashboardName').value = userData.name || currentUser.displayName || '';
        document.getElementById('dashboardEmail').value = userData.email || currentUser.email || '';
        document.getElementById('dashboardPhone').value = userData.phone || '';
        document.getElementById('dashboardAddress').value = userData.address || '';
        document.getElementById('dashboardCountry').value = userData.country || appData?.personalInfo?.country || '';
        
    } catch (error) {
        console.error('Error loading user profile:', error);
    }
}

        // Enhanced Authentication System
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await handleLogin();
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await handleRegistration();
        });

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                showLoadingState('loginForm', 'Logging in...');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                await checkUserRole();
                await loadUserApplication();
                showDashboard();
            } catch (error) {
                alert('Login failed: ' + error.message);
                resetLoadingState('loginForm', 'Login');
            }
        }

        async function handleRegistration() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            try {
                showLoadingState('registerForm', 'Creating account...');
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Create user profile in Firestore
                await db.collection('users').doc(currentUser.uid).set({
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    userType: 'applicant'
                });
                
                // Create initial application
                await initializeApplication();
                await loadUserApplication();
                showDashboard();
            } catch (error) {
                alert('Registration failed: ' + error.message);
                resetLoadingState('registerForm', 'Create Account');
            }
        }

        async function checkUserRole() {
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                isAdmin = userData.userType === 'admin';
                if (isAdmin) {
                    document.getElementById('adminAccessBtn').style.display = 'inline-block';
                }
            }
        }

        // Application Management
        async function initializeApplication() {
            const applicationData = {
                userId: currentUser.uid,
                status: 'draft',
                progress: 0,
                currentStep: 'personal_info',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                documents: {},
                payments: [],
                personalInfo: {},
                applicationStages: {
                    personal_info: { status: 'pending', completed: false },
                    document_upload: { status: 'pending', completed: false },
                    payment: { status: 'pending', completed: false },
                    review: { status: 'pending', completed: false },
                    approval: { status: 'pending', completed: false }
                }
            };
            
            await db.collection('applications').doc(currentUser.uid).set(applicationData);
        }

        async function loadUserApplication() {
            const doc = await db.collection('applications').doc(currentUser.uid).get();
            if (doc.exists) {
                userApplication = doc.data();
                updateDashboardUI();
                setupRealTimeUpdates();
            }
        }

        function setupRealTimeUpdates() {
            // Real-time listener for application updates
            realTimeListener = db.collection('applications').doc(currentUser.uid)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        userApplication = doc.data();
                        updateDashboardUI();
                    }
                });
        }

        // Enhanced Document Upload System
function initializeDocumentUpload() {
    const uploadAreas = document.querySelectorAll('.upload-area');
    
    uploadAreas.forEach(area => {
        const fileInput = area.parentElement.querySelector('input[type="file"]');
        const progressBar = area.querySelector('.upload-progress-bar');
        const docType = area.dataset.docType;
        
        // Click to upload
        area.addEventListener('click', () => fileInput.click());
        
        // Drag and drop functionality
        area.addEventListener('dragover', (e) => {
            e.preventDefault();
            area.classList.add('dragover');
        });
        
        area.addEventListener('dragleave', () => {
            area.classList.remove('dragover');
        });
        
        area.addEventListener('drop', (e) => {
            e.preventDefault();
            area.classList.remove('dragover');
            if (e.dataTransfer.files[0]) {
                handleFileUpload(e.dataTransfer.files[0], docType, progressBar, area);
            }
        });
        
        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handleFileUpload(e.target.files[0], docType, progressBar, area);
            }
        });
    });
}

async function handleFileUpload(file, docType, progressBar, uploadArea) {
    if (!file || !currentUser) {
        alert('Please log in to upload documents.');
        return;
    }
    
    // Validate file type
    const validTypes = ['.pdf', '.jpg', '.jpeg', '.png'];
    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
    
    if (!validTypes.includes(fileExtension)) {
        alert('Please upload PDF, JPG, JPEG, or PNG files only.');
        return;
    }
    
    // Validate file size (10MB max)
    const maxSize = 10 * 1024 * 1024;
    if (file.size > maxSize) {
        alert('File size must be less than 10MB.');
        return;
    }
    
    try {
        console.log(`Starting upload for ${docType}: ${file.name}`);
        
        // Create unique filename
        const fileName = `${currentUser.uid}/${docType}_${Date.now()}_${file.name}`;
        const storageRef = storage.ref().child(fileName);
        
        // Show uploading state
        uploadArea.innerHTML = `
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Uploading... Please wait</p>
            <div class="upload-progress">
                <div class="upload-progress-bar" style="width: 0%"></div>
            </div>
        `;
        
        progressBar = uploadArea.querySelector('.upload-progress-bar');
        
        // Upload file with progress tracking
        const uploadTask = storageRef.put(file);
        
        uploadTask.on('state_changed',
            (snapshot) => {
                // Update progress bar
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressBar.style.width = progress + '%';
                console.log(`Upload progress: ${progress}%`);
            },
            (error) => {
                console.error('Upload failed:', error);
                uploadArea.innerHTML = `
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <p>Click or drag file to upload</p>
                    <div class="upload-progress">
                        <div class="upload-progress-bar" style="width: 0%"></div>
                    </div>
                    <p style="color: red; font-size: 0.8em;">Upload failed. Please try again.</p>
                `;
                alert('Upload failed: ' + error.message);
            },
            async () => {
                try {
                    // Upload completed - get download URL
                    const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                    console.log('File uploaded successfully. Download URL:', downloadURL);
                    
                    // Update application in Firestore
                    await db.collection('applications').doc(currentUser.uid).update({
                        [`documents.${docType}`]: {
                            url: downloadURL,
                            fileName: file.name,
                            uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'pending_review',
                            fileSize: file.size,
                            fileType: file.type,
                            reviewedBy: null,
                            reviewDate: null,
                            comments: ''
                        },
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'document_upload'
                    });
                    
                    // Update application stages
                    await updateApplicationStage('document_upload', true);
                    
                    // Show success state
                    uploadArea.innerHTML = `
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; color: #4CAF50;"></i>
                        <p>Upload Successful!</p>
                        <p style="font-size: 0.8em; color: #666;">${file.name}</p>
                        <div class="upload-progress">
                            <div class="upload-progress-bar" style="width: 100%; background: #4CAF50;"></div>
                        </div>
                    `;
                    
                    // Update document status in UI
                    const statusElement = document.getElementById(`${docType}Status`);
                    if (statusElement) {
                        statusElement.textContent = 'PENDING REVIEW';
                        statusElement.className = 'document-status status-pending';
                    }
                    
                    alert('Document uploaded successfully! It is now pending review.');
                    
                    // Reset after 3 seconds
                    setTimeout(() => {
                        uploadArea.innerHTML = `
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Click or drag file to upload</p>
                            <p style="font-size: 0.8em; color: #666;">Upload another file</p>
                            <div class="upload-progress">
                                <div class="upload-progress-bar" style="width: 0%"></div>
                            </div>
                        `;
                    }, 3000);
                    
                } catch (error) {
                    console.error('Error updating Firestore:', error);
                    alert('Upload completed but failed to update application. Please contact support.');
                }
            }
        );
        
    } catch (error) {
        console.error('Upload error:', error);
        alert('Upload failed: ' + error.message);
    }
}

async function updateApplicationStage(stage, completed) {
    if (!currentUser) return;
    
    try {
        await db.collection('applications').doc(currentUser.uid).update({
            [`applicationStages.${stage}`]: {
                completed: completed,
                status: completed ? 'completed' : 'in_progress',
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
    } catch (error) {
        console.error('Error updating application stage:', error);
    }
}

// Missing function for admin dashboard
function calculateOverallProgress(applicant) {
    if (!applicant || !applicant.applicationStages) return 0;
    
    const stages = applicant.applicationStages;
    let completedCount = 0;
    const totalStages = Object.keys(stages).length;
    
    Object.values(stages).forEach(stage => {
        if (stage && stage.completed) completedCount++;
    });
    
    return Math.round((completedCount / totalStages) * 100);
}

// Safe date formatting function for timeline
function formatTimelineDate(date) {
    if (!date) return getStepDateText('pending');
    try {
        if (date.toDate && typeof date.toDate === 'function') {
            return date.toDate().toLocaleDateString();
        }
        return getStepDateText('pending');
    } catch (error) {
        return getStepDateText('pending');
    }
}

// Safe document date function
function getLatestDocumentDate(documents) {
    if (!documents) return null;
    
    let latestDate = null;
    Object.values(documents).forEach(doc => {
        if (doc && doc.uploadedAt && doc.uploadedAt.toDate && 
            (!latestDate || doc.uploadedAt > latestDate)) {
            latestDate = doc.uploadedAt;
        }
    });
    return latestDate;
}
        // Enhanced Dashboard UI Updates
function updateDashboardUI() {
    if (!userApplication) return;
    
    // Update progress bars and steps based on actual application status
    updateProgressBars();
    
    // Update document status
    updateDocumentStatus();
    
    // Update application timeline
    updateApplicationTimeline();
    
    // Update next steps based on current progress
    updateNextSteps();
}

function updateProgressBars() {
    if (!userApplication) return;
    
    const progress = calculateOverallProgress();
    document.getElementById('mainProgressBar').style.width = progress + '%';
    document.getElementById('progressPercentage').textContent = progress + '% Complete';
    
    // Update step indicators based on application status
    updateStepIndicators();
}

function calculateOverallProgress() {
    if (!userApplication || !userApplication.applicationStages) return 0;
    
    const stages = userApplication.applicationStages;
    let completedCount = 0;
    const totalStages = Object.keys(stages).length;
    
    // Count completed stages
    Object.values(stages).forEach(stage => {
        if (stage.completed) completedCount++;
    });
    
    return Math.round((completedCount / totalStages) * 100);
}

function updateStepIndicators() {
    if (!userApplication || !userApplication.applicationStages) return;
    
    const stages = userApplication.applicationStages;
    const status = userApplication.status;
    
    // Map application status to step completion
    const stepStatus = {
        'draft': { completed: 0, current: 1 },
        'submitted': { completed: 1, current: 2 },
        'document_upload': { completed: 1, current: 2 },
        'payment_pending': { completed: 2, current: 3 },
        'under_review': { completed: 3, current: 4 },
        'approved': { completed: 4, current: 5 },
        'rejected': { completed: 2, current: 2 } // Stops at document stage if rejected
    };
    
    const currentStep = stepStatus[status] || { completed: 0, current: 1 };
    
    // Update each step indicator
    for (let i = 1; i <= 5; i++) {
        const stepIndicator = document.getElementById(`step${i}`);
        if (stepIndicator) {
            if (i <= currentStep.completed) {
                stepIndicator.className = 'step-indicator completed';
                stepIndicator.innerHTML = '✓';
            } else if (i === currentStep.current) {
                stepIndicator.className = 'step-indicator active';
                stepIndicator.innerHTML = i;
            } else {
                stepIndicator.className = 'step-indicator';
                stepIndicator.innerHTML = i;
            }
        }
    }
}

function updateNextSteps() {
    if (!userApplication) return;
    
    const nextStepsList = document.getElementById('nextStepsList');
    if (!nextStepsList) return;
    
    const status = userApplication.status;
    let nextSteps = [];
    
    switch (status) {
        case 'draft':
            nextSteps = [
                'Complete your profile information',
                'Upload required documents',
                'Submit your application for review'
            ];
            break;
        case 'submitted':
        case 'document_upload':
            nextSteps = [
                'Wait for document verification',
                'Complete payment for application processing',
                'Prepare for possible interview'
            ];
            break;
        case 'payment_pending':
            nextSteps = [
                'Complete payment processing',
                'Wait for application review',
                'Monitor your email for updates'
            ];
            break;
        case 'under_review':
            nextSteps = [
                'Application is under review',
                'Check for any additional document requests',
                'Wait for final decision'
            ];
            break;
        case 'approved':
            nextSteps = [
                'Visa has been approved!',
                'Prepare for travel arrangements',
                'Contact us for relocation support'
            ];
            break;
        case 'rejected':
            nextSteps = [
                'Application was not approved',
                'Contact us for feedback and next steps',
                'Consider reapplying with additional documentation'
            ];
            break;
        default:
            nextSteps = [
                'Complete your profile information',
                'Upload required documents',
                'Complete payment for application processing'
            ];
    }
    
    nextStepsList.innerHTML = nextSteps.map(step => `<li>${step}</li>`).join('');
}

        function updateDocumentStatus() {
            const documents = userApplication.documents || {};
            
            Object.keys(documents).forEach(docType => {
                const doc = documents[docType];
                const statusElement = document.getElementById(`${docType}Status`);
                
                if (statusElement) {
                    statusElement.textContent = doc.status.replace('_', ' ').toUpperCase();
                    statusElement.className = `document-status status-${doc.status.replace('_', '-')}`;
                }
            });
        }

        function updateApplicationTimeline() {
    if (!userApplication) return;
    
    const timelineContainer = document.querySelector('#status .dashboard-section');
    if (!timelineContainer) return;
    
    const status = userApplication.status || 'draft';
    const createdAt = userApplication.createdAt;
    
    const timelineSteps = [
        {
            id: 'submitted',
            title: 'Application Submitted',
            description: 'Your initial application has been received and is under review.',
            status: getStepStatus('submitted', status),
            date: createdAt
        },
        {
            id: 'document_review',
            title: 'Document Review',
            description: 'We are currently reviewing your submitted documents. Please ensure all required documents are uploaded.',
            status: getStepStatus('document_upload', status),
            date: userApplication.documents ? getLatestDocumentDate(userApplication.documents) : null
        },
        {
            id: 'payment',
            title: 'Payment Processing',
            description: 'Once documents are approved, you\'ll need to complete payment for processing fees.',
            status: getStepStatus('payment_pending', status),
            date: null
        },
        {
            id: 'embassy',
            title: 'Embassy Submission',
            description: 'Your application will be submitted to the appropriate embassy for final review.',
            status: getStepStatus('under_review', status),
            date: null
        },
        {
            id: 'visa',
            title: 'Visa Issuance',
            description: 'Upon approval, your visa will be issued and prepared for collection.',
            status: getStepStatus('approved', status),
            date: null
        }
    ];
    
    const timelineHTML = `
        <div style="margin: 30px 0;">
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${calculateOverallProgress()}%;"></div>
            </div>
            <p style="text-align: center; font-weight: 600; margin-top: 10px;">
                Application Status: ${getStatusText(status)}
            </p>
        </div>
        
        <div style="position: relative; margin: 40px 0;">
            <div style="position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background-color: var(--primary-red);"></div>
            
            ${timelineSteps.map((step, index) => `
                <div style="position: relative; padding-left: 50px; margin-bottom: 30px;">
                    <div style="position: absolute; left: 0; top: 0; width: 32px; height: 32px; border-radius: 50%; 
                         background-color: ${getStepColor(step.status)}; color: white; 
                         display: flex; align-items: center; justify-content: center; font-weight: bold;
                         border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        ${step.status === 'completed' ? '✓' : index + 1}
                    </div>
                    <h4 style="margin-bottom: 5px; color: ${getStepColor(step.status)};">${step.title}</h4>
                    <p style="color: var(--medium-gray); margin-bottom: 5px;">
                        ${step.date ? step.date.toDate().toLocaleDateString() : getStepDateText(step.status)}
                    </p>
                    <p style="color: var(--dark-gray);">${step.description}</p>
                </div>
            `).join('')}
        </div>
    `;
    
    const existingTimeline = timelineContainer.querySelector('.timeline-content');
    if (existingTimeline) {
        existingTimeline.innerHTML = timelineHTML;
    } else {
        const newTimeline = document.createElement('div');
        newTimeline.className = 'timeline-content';
        newTimeline.innerHTML = timelineHTML;
        timelineContainer.appendChild(newTimeline);
    }
}

function getStepStatus(step, currentStatus) {
    const statusOrder = ['draft', 'submitted', 'document_upload', 'payment_pending', 'under_review', 'approved', 'rejected'];
    const currentIndex = statusOrder.indexOf(currentStatus);
    const stepIndex = statusOrder.indexOf(step);
    
    if (stepIndex < currentIndex) return 'completed';
    if (stepIndex === currentIndex) return 'current';
    return 'pending';
}

function getStepColor(status) {
    switch (status) {
        case 'completed': return '#4CAF50';
        case 'current': return 'var(--primary-red)';
        default: return '#ccc';
    }
}

function getStatusText(status) {
    const statusMap = {
        'draft': 'Draft - In Progress',
        'submitted': 'Submitted for Review',
        'document_upload': 'Document Submission Phase',
        'payment_pending': 'Payment Processing',
        'under_review': 'Under Review',
        'approved': 'Approved - Visa Ready',
        'rejected': 'Application Rejected'
    };
    return statusMap[status] || 'Application Started';
}

function getStepDateText(status) {
    switch (status) {
        case 'completed': return 'Completed';
        case 'current': return 'Current Step';
        default: return 'Upcoming';
    }
}
        // Admin Dashboard Functions
        function showAdminDashboard() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('adminDashboard').style.display = 'block';
    adminManager.initialize();
    
    // Enable enhanced admin features
    enhanceAdminDashboard();
    
    // NOW show admin controls since we're in admin dashboard
    toggleAdminControls();
}
        async function loadAdminData() {
    // Load all applications for admin review
    const applicationsSnapshot = await db.collection('applications').get();
    const applicants = [];
    
    applicationsSnapshot.forEach(doc => {
        applicants.push({
            id: doc.id,
            ...doc.data()
        });
    });
    
    updateAdminUI(applicants);
    setupAdminRealTimeUpdates();
    
    // ADD THIS LINE - This will enable delete functionality
    enhanceAdminDashboard();
}

        function setupAdminRealTimeUpdates() {
            // Real-time listener for all applications
            db.collection('applications').onSnapshot((snapshot) => {
                const applicants = [];
                snapshot.forEach(doc => {
                    applicants.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                updateAdminUI(applicants);
            });
        }

        function updateAdminUI(applicants) {
            updateAdminStats(applicants);
            renderApplicantsList(applicants);
        }

        function updateAdminStats(applicants) {
            const total = applicants.length;
            const pending = applicants.filter(app => app.status === 'submitted' || app.status === 'draft').length;
            const approved = applicants.filter(app => app.status === 'approved').length;
            const rejected = applicants.filter(app => app.status === 'rejected').length;
            
            document.getElementById('totalApplicants').textContent = total;
            document.getElementById('pendingReview').textContent = pending;
            document.getElementById('approvedApps').textContent = approved;
            document.getElementById('rejectedApps').textContent = rejected;
        }

        async function renderApplicantsList(applicants) {
            const container = document.getElementById('applicantsList');
            container.innerHTML = '';
            
            for (const applicant of applicants) {
                const userDoc = await db.collection('users').doc(applicant.userId).get();
                const userData = userDoc.data();
                
                const card = document.createElement('div');
                card.className = 'applicant-card';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4>${userData?.name || 'Unknown User'}</h4>
                            <p>${userData?.email || 'No email'}</p>
                            <p>Applied: ${applicant.createdAt?.toDate?.().toLocaleDateString() || 'Unknown date'}</p>
                        </div>
                        <div>
                            <span class="status-badge status-${applicant.status}">${applicant.status.toUpperCase()}</span>
                            <div>Progress: ${calculateOverallProgress(applicant)}%</div>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => showApplicantDetail(applicant));
                container.appendChild(card);
            }
        }

        async function showApplicantDetail(applicant) {
            const userDoc = await db.collection('users').doc(applicant.userId).get();
            const userData = userDoc.data();
            
            document.getElementById('applicantDetailContent').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h4>${userData?.name || 'Unknown User'}</h4>
                        <p>Email: ${userData?.email || 'No email'}</p>
                        <p>Phone: ${applicant.personalInfo?.phone || 'Not provided'}</p>
                        <p>Country: ${applicant.personalInfo?.country || 'Not specified'}</p>
                    </div>
                    <div>
                        <select id="applicationStatus" class="form-control">
                            <option value="draft" ${applicant.status === 'draft' ? 'selected' : ''}>Draft</option>
                            <option value="submitted" ${applicant.status === 'submitted' ? 'selected' : ''}>Submitted</option>
                            <option value="under_review" ${applicant.status === 'under_review' ? 'selected' : ''}>Under Review</option>
                            <option value="approved" ${applicant.status === 'approved' ? 'selected' : ''}>Approved</option>
                            <option value="rejected" ${applicant.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                        </select>
                        <button onclick="updateApplicationStatus('${applicant.userId}')" class="btn btn-primary" style="margin-top: 10px;">Update Status</button>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h5>Documents</h5>
                    <div class="document-list">
                        ${renderAdminDocuments(applicant.documents || {})}
                    </div>
                </div>
            `;
            
            // Show detail view
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('applicantDetail').classList.add('active');
        }

        function renderAdminDocuments(documents) {
            if (Object.keys(documents).length === 0) {
                return '<p>No documents uploaded yet.</p>';
            }
            
            return Object.keys(documents).map(docType => {
                const doc = documents[docType];
                return `
                    <div class="document-item">
                        <div style="flex: 1;">
                            <strong>${docType.replace('_', ' ').toUpperCase()}</strong>
                            <div>File: ${doc.fileName}</div>
                            <div>Uploaded: ${doc.uploadedAt?.toDate?.().toLocaleDateString() || 'Unknown date'}</div>
                            <div>Status: ${doc.status}</div>
                            ${doc.comments ? `<div>Comments: ${doc.comments}</div>` : ''}
                        </div>
                        <div class="document-actions">
                            <a href="${doc.url}" target="_blank" class="btn btn-small btn-primary">View</a>
                            <select onchange="updateDocumentStatus('${docType}', this.value)" class="form-control">
                                <option value="pending_review" ${doc.status === 'pending_review' ? 'selected' : ''}>Pending Review</option>
                                <option value="approved" ${doc.status === 'approved' ? 'selected' : ''}>Approved</option>
                                <option value="rejected" ${doc.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                            </select>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function updateDocumentStatus(docType, status) {
            await db.collection('applications').doc(currentUser.uid).update({
                [`documents.${docType}.status`]: status,
                [`documents.${docType}.reviewedBy`]: currentUser.uid,
                [`documents.${docType}.reviewDate`]: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        async function updateApplicationStatus(applicantId) {
            const status = document.getElementById('applicationStatus').value;
            await db.collection('applications').doc(applicantId).update({
                status: status,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert('Application status updated successfully!');
        }

        // Utility Functions
        function showLoadingState(formId, text) {
            const form = document.getElementById(formId);
            const submitBtn = form.querySelector('button[type="submit"]');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.loading-spinner');
            
            btnText.textContent = text;
            spinner.style.display = 'inline-block';
            submitBtn.disabled = true;
        }

        function resetLoadingState(formId, originalText) {
            const form = document.getElementById(formId);
            const submitBtn = form.querySelector('button[type="submit"]');
            const btnText = submitBtn.querySelector('.btn-text');
            const spinner = submitBtn.querySelector('.loading-spinner');
            
            btnText.textContent = originalText;
            spinner.style.display = 'none';
            submitBtn.disabled = false;
        }

        function showDashboard() {
    document.getElementById('authModal').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    document.querySelector('main').style.display = 'none';
    document.querySelector('footer').style.display = 'none';
    document.getElementById('userName').textContent = `Welcome, ${currentUser.email.split('@')[0]}`;
    
    // Initialize all dashboard systems
    initializeDashboardSystems();
}

// ==================== ENHANCED ERROR HANDLING ====================
// Global error handler
window.addEventListener('error', function(e) {
    console.error('Global error caught:', e.error);
    // You can add error reporting to analytics here
});

// Unhandled promise rejection handler
window.addEventListener('unhandledrejection', function(e) {
    console.error('Unhandled promise rejection:', e.reason);
    e.preventDefault(); // Prevents browser error logging
});

// Form validation helper function
function setupRealTimeValidation() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
            input.addEventListener('input', function() {
                clearFieldError(this);
            });
        });
    });
}

function validateField(field) {
    const errorElement = document.getElementById(field.id + 'Error');
    if (!errorElement) return;
    
    if (!field.value.trim()) {
        errorElement.style.display = 'block';
        return false;
    }
    
    // Email validation
    if (field.type === 'email') {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(field.value)) {
            errorElement.style.display = 'block';
            return false;
        }
    }
    
    errorElement.style.display = 'none';
    return true;
}

function clearFieldError(field) {
    const errorElement = document.getElementById(field.id + 'Error');
    if (errorElement) {
        errorElement.style.display = 'none';
    }
}
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            
            // Check if user is already logged in
            auth.onAuthStateChanged(async (user) => {
    if (user) {
        currentUser = user;
        await checkUserRole();
        await loadUserApplication();
        showDashboard();
        
        // Only show admin controls if we're actually in admin dashboard
        // Don't show them in the applicant dashboard
        if (document.getElementById('adminDashboard').style.display === 'block') {
            toggleAdminControls();
        }
    }
});

            // Admin access button
            document.getElementById('adminAccessBtn').addEventListener('click', showAdminDashboard);
            
            // Back to user view button
            document.getElementById('backToUser').addEventListener('click', () => {
                document.getElementById('adminDashboard').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
            });
            
            // Admin logout
            document.getElementById('adminLogout').addEventListener('click', () => {
                auth.signOut();
                location.reload();
            });

            // Loading Screen - UPDATED CODE
            window.addEventListener('load', function() {
                setTimeout(function() {
                    document.getElementById('loading-screen').style.opacity = '0';
                    setTimeout(function() {
                        document.getElementById('loading-screen').style.display = 'none';
                    }, 500);
                }, 2000);
                
                // Add a timeout to ensure loading screen disappears even if images fail
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                }, 4000); // 4 second maximum loading time
                
                // Animate stats
                animateValue('clients', 0, 500, 2000);
                animateValue('success', 0, 98, 2000);
                animateValue('countries', 0, 80, 2000);
                animateValue('experience', 0, 10, 2000);
            });
            
            // Mobile Menu Toggle - Fixed version
            document.querySelector('.mobile-toggle').addEventListener('click', function() {
                const navMenu = document.querySelector('.nav-menu');
                navMenu.classList.toggle('active');
                
                // Toggle icon between bars and times
                const icon = this.querySelector('i');
                if (navMenu.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                const navMenu = document.querySelector('.nav-menu');
                const mobileToggle = document.querySelector('.mobile-toggle');
                
                if (navMenu.classList.contains('active') && 
                    !navMenu.contains(e.target) && 
                    !mobileToggle.contains(e.target)) {
                    navMenu.classList.remove('active');
                    mobileToggle.querySelector('i').classList.remove('fa-times');
                    mobileToggle.querySelector('i').classList.add('fa-bars');
                }
            });

            // Dropdown menu for mobile - Fixed version
            if (window.innerWidth <= 768) {
                const dropdowns = document.querySelectorAll('.dropdown > a');
                dropdowns.forEach(dropdownLink => {
                    dropdownLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        const dropdown = this.parentElement;
                        dropdown.classList.toggle('active');
                    });
                });
            }
            
            // Live Session Modal
            const liveSessionBtn = document.getElementById('liveSessionBtn');
            const liveSessionModal = document.getElementById('liveSessionModal');
            const registerModal = document.getElementById('registerModal');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            
            liveSessionBtn.addEventListener('click', function(e) {
                e.preventDefault();
                liveSessionModal.style.display = 'flex';
            });
            
            document.getElementById('joinLive').addEventListener('click', function() {
                window.open('https://youtube.com/@info.globalimmigrationsc?si=O-DxqL1jAMTFTE-V', '_blank');
            });
            
            document.getElementById('registerSession').addEventListener('click', function() {
                liveSessionModal.style.display = 'none';
                registerModal.style.display = 'flex';
            });
            
            closeModalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    liveSessionModal.style.display = 'none';
                    registerModal.style.display = 'none';
                    authModal.style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === liveSessionModal) {
                    liveSessionModal.style.display = 'none';
                }
                if (e.target === registerModal) {
                    registerModal.style.display = 'none';
                }
                if (e.target === authModal) {
                    authModal.style.display = 'none';
                }
            });

            // Email validation function for form validation
            function validateEmail(email) {
                const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(String(email).toLowerCase());
            }

            // Password strength checker
            function checkPasswordStrength(password) {
                let strength = 0;
                const strengthText = document.querySelector('.password-strength-text');
                const strengthBar = document.querySelector('.password-strength-bar');
                const strengthContainer = document.querySelector('.password-strength');
                
                // Reset
                strengthContainer.classList.remove('weak', 'medium', 'strong');
                
                if (password.length >= 8) strength++;
                if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
                if (password.match(/\d/)) strength++;
                if (password.match(/[^a-zA-Z\d]/)) strength++;
                
                if (password.length === 0) {
                    strengthText.textContent = '';
                    strengthBar.style.width = '0%';
                } else if (strength <= 2) {
                    strengthText.textContent = 'Weak password';
                    strengthContainer.classList.add('weak');
                } else if (strength === 3) {
                    strengthText.textContent = 'Medium password';
                    strengthContainer.classList.add('medium');
                } else {
                    strengthText.textContent = 'Strong password';
                    strengthContainer.classList.add('strong');
                }
            }

            // Application Portal Authentication
            const authModal = document.getElementById('authModal');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const authTabs = document.querySelectorAll('.auth-tab');
            const authForms = document.querySelectorAll('.auth-form');
            
            loginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                authModal.style.display = 'flex';
                // Set active tab to login
                authTabs[0].click();
            });
            
            registerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                authModal.style.display = 'flex';
                // Set active tab to register
                authTabs[1].click();
            });
            
            // Auth tab switching
            authTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    authTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding form
                    authForms.forEach(form => {
                        form.classList.remove('active');
                        if (form.id === `${tabName}Form`) {
                            form.classList.add('active');
                        }
                    });
                });
            });
            
            // Password strength monitoring
            document.getElementById('registerPassword').addEventListener('input', function() {
                checkPasswordStrength(this.value);
            });
            
            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function() {
                auth.signOut();
                // Show main content
                document.querySelector('main').style.display = 'block';
                document.querySelector('footer').style.display = 'block';
                
                // Hide dashboard
                document.getElementById('dashboard').style.display = 'none';
            });
            
            // Dashboard navigation
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const dashboardSections = document.querySelectorAll('.dashboard-section');
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetSection = this.getAttribute('data-section');
                    
                    // Update active link
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    dashboardSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === targetSection) {
                            section.classList.add('active');
                        }
                    });
                });
            });
            
            // Session Registration Form
            document.getElementById('sessionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                let isValid = true;
                
                // Validate name
                const name = document.getElementById('sessionName');
                const nameError = document.getElementById('sessionNameError');
                if (!name.value.trim()) {
                    nameError.style.display = 'block';
                    isValid = false;
                } else {
                    nameError.style.display = 'none';
                }
                
                // Validate email
                const email = document.getElementById('sessionEmail');
                const emailError = document.getElementById('sessionEmailError');
                if (!email.value.trim() || !validateEmail(email.value)) {
                    emailError.style.display = 'block';
                    isValid = false;
                } else {
                    emailError.style.display = 'none';
                }
                
                if (isValid) {
                    // Show loading state
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const btnText = submitBtn.querySelector('.btn-text');
                    const spinner = submitBtn.querySelector('.loading-spinner');
                    
                    btnText.textContent = 'Sending...';
                    spinner.style.display = 'inline-block';
                    submitBtn.disabled = true;
                    
                    // Create FormData object
                    const formData = new FormData(this);
                    
                    // Send form data using Fetch API
                    fetch(this.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            // Show success message
                            document.getElementById('sessionSuccess').style.display = 'block';
                            
                            // Form submission tracking for Google Analytics
                            gtag('event', 'form_submission', {
                                'event_category': 'session',
                                'event_label': 'session_registration'
                            });
                            
                            // Reset form
                            this.reset();
                        } else {
                            throw new Error('Form submission failed');
                        }
                    })
                    .catch(error => {
                        alert('There was a problem with your registration. Please try again or contact us directly.');
                    })
                    .finally(() => {
                        // Reset button
                        btnText.textContent = 'Send Registration';
                        spinner.style.display = 'none';
                        submitBtn.disabled = false;
                        
                        // Hide success message after 5 seconds
                        setTimeout(() => {
                            document.getElementById('sessionSuccess').style.display = 'none';
                            registerModal.style.display = 'none';
                        }, 5000);
                    });
                }
            });
            
            // Contact Form Validation and Submission
            document.getElementById('inquiryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                let isValid = true;
                
                // Validate name
                const name = document.getElementById('name');
                const nameError = document.getElementById('nameError');
                if (!name.value.trim()) {
                    nameError.style.display = 'block';
                    isValid = false;
                } else {
                    nameError.style.display = 'none';
                }
                
                // Validate email
                const email = document.getElementById('email');
                const emailError = document.getElementById('emailError');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!email.value.trim() || !emailRegex.test(email.value)) {
                    emailError.style.display = 'block';
                    isValid = false;
                } else {
                    emailError.style.display = 'none';
                }
                
                // Validate phone
                const phone = document.getElementById('phone');
                const phoneError = document.getElementById('phoneError');
                if (!phone.value.trim()) {
                    phoneError.style.display = 'block';
                    isValid = false;
                } else {
                    phoneError.style.display = 'none';
                }
                
                // Validate country
                const country = document.getElementById('country');
                const countryError = document.getElementById('countryError');
                if (!country.value) {
                    countryError.style.display = 'block';
                    isValid = false;
                } else {
                    countryError.style.display = 'none';
                }
                
                // Validate interest
                const interest = document.querySelector('input[name="interest"]:checked');
                const interestError = document.getElementById('interestError');
                if (!interest) {
                    interestError.style.display = 'block';
                    isValid = false;
                } else {
                    interestError.style.display = 'none';
                }
                
                // Validate message
                const message = document.getElementById('message');
                const messageError = document.getElementById('messageError');
                if (!message.value.trim()) {
                    messageError.style.display = 'block';
                    isValid = false;
                } else {
                    messageError.style.display = 'none';
                }
                
                if (isValid) {
                    // Show loading state
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const btnText = submitBtn.querySelector('.btn-text');
                    const spinner = submitBtn.querySelector('.loading-spinner');
                    
                    btnText.textContent = 'Submitting...';
                    spinner.style.display = 'inline-block';
                    submitBtn.disabled = true;
                    
                    // Create FormData object
                    const formData = new FormData(this);
                    
                    // Send form data using Fetch API
                    fetch(this.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            // Show success message
                            document.getElementById('formSuccess').style.display = 'block';
                            
                            // Form submission tracking for Google Analytics
                            gtag('event', 'form_submission', {
                                'event_category': 'contact',
                                'event_label': 'inquiry_form'
                            });
                            
                            // Reset form
                            this.reset();
                        } else {
                            throw new Error('Form submission failed');
                        }
                    })
                    .catch(error => {
                        alert('There was a problem with your submission. Please try again or contact us directly.');
                    })
                    .finally(() => {
                        // Reset button
                        btnText.textContent = 'Submit Inquiry';
                        spinner.style.display = 'none';
                        submitBtn.disabled = false;
                        
                        // Hide success message after 5 seconds
                        setTimeout(() => {
                            document.getElementById('formSuccess').style.display = 'none';
                            }, 5000);
                    });
                }
            });
            
            // Smooth Scrolling for Anchor Links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    if (this.getAttribute('href') !== '#') {
                        e.preventDefault();
                        
                        const targetId = this.getAttribute('href');
                        const targetElement = document.querySelector(targetId);
                        
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 70,
                                behavior: 'smooth'
                            });
                            
                            // Close mobile menu if open
                            if (window.innerWidth <= 768) {
                                document.querySelector('.nav-menu').classList.remove('active');
                            }
                        }
                    }
                });
            });
            
            // Animate value function for stats
            function animateValue(id, start, end, duration) {
                const obj = document.getElementById(id);
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    obj.innerHTML = Math.floor(progress * (end - start) + start) + (id === 'success' ? '%' : '+');
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }
            
            // Lazy loading for images
            if ('IntersectionObserver' in window) {
                const lazyImages = document.querySelectorAll('img[loading="lazy"]');
                
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.classList.remove('lazy');
                            imageObserver.unobserve(img);
                        }
                    });
                });
                
                lazyImages.forEach(img => {
                    imageObserver.observe(img);
                });
            }

            // Check if images are loading properly
            function checkImage(url, callback) {
                const img = new Image();
                img.onload = function() { callback(true); };
                img.onerror = function() { callback(false); };
                img.src = url;
            }

            // Check logo
            checkImage('GISC-LOGO.webp', function(success) {
                if (!success) {
                    document.querySelector('.logo img').style.display = 'none';
                    document.getElementById('header-logo-fallback').style.display = 'flex';
                }
            });

            // Check about image
            checkImage('IMAGES.webp', function(success) {
                if (!success) {
                    document.querySelector('.about-image img').style.display = 'none';
                    document.getElementById('about-fallback').style.display = 'flex';
                }
            });

            // Check founder image
            checkImage('Founder.jpg', function(success) {
                if (!success) {
                    document.querySelector('.founder-image img').style.display = 'none';
                    document.getElementById('founder-fallback').style.display = 'flex';
                }
            });

            // Newsletter form submission
            document.getElementById('newsletterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const emailInput = this.querySelector('input[type="email"]');
                const email = emailInput.value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                
                if (!email || !emailRegex.test(email)) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Subscribing...';
                submitBtn.disabled = true;
                
                // Create FormData object
                const formData = new FormData(this);
                
                // Send form data using Fetch API
                fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        // Show success message
                        document.getElementById('newsletterSuccess').style.display = 'block';
                        
                        // Form submission tracking for Google Analytics
                        if (typeof gtag !== 'undefined') {
                            gtag('event', 'form_submission', {
                                'event_category': 'newsletter',
                                'event_label': 'newsletter_subscription'
                            });
                        }
                        
                        // Reset form
                        this.reset();
                    } else {
                        throw new Error('Form submission failed');
                    }
                })
                .catch(error => {
                    alert('There was a problem with your subscription. Please try again later.');
                })
                .finally(() => {
                    // Reset button
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    
                    // Hide success message after 5 seconds
                    setTimeout(() => {
                        document.getElementById('newsletterSuccess').style.display = 'none';
                        }, 5000);
                });
            });

           // Function to load blog posts from localStorage - UPDATED CODE
            function loadBlogPostsToWebsite() {
                const blogContainer = document.getElementById('dynamic-blog-container');
                const postsJSON = localStorage.getItem('blogPosts');
                const posts = postsJSON ? JSON.parse(postsJSON) : [];
                
                // Clear existing content
                blogContainer.innerHTML = '';
                
                if (posts.length === 0) {
                    // Show default content if no posts exist
                    blogContainer.innerHTML = `
                        <div class="blog-card">
                            <div class="blog-image">
                                <div class="image-fallback">
                                    <i class="fas fa-book"></i>
                                </div>
                            </div>
                            <div class="blog-content">
                                <div class="blog-date">July 20, 2023</div>
                                <h3 class="blog-title">Why Study Abroad: Benefits & Opportunities</h3>
                                <p class="blog-excerpt">Discover the life-changing benefits of studying in a foreign country and how it can transform your career prospects.</p>
                                <a href="https://www.facebook.com/share/16ZuMVLV3g/?mibextid=wwXIfr" class="btn btn-outline btn-small" target="_blank" rel="noopener noreferrer">Read More</a>
                            </div>
                        </div>
                        
                        <div class="blog-card">
                            <div class="blog-image">
                                <div class="image-fallback">
                                    <i class="fas fa-plane"></i>
                                </div>
                            </div>
                            <div class="blog-content">
                                <div class="blog-date">July 15, 2023</div>
                                <h3 class="blog-title">Why You Need a Professional Travel Agency</h3>
                                <p class="blog-excerpt">Learn how working with experienced travel consultants can save you time, money, and stress in your immigration journey.</p>
                                <a href="https://www.facebook.com/share/16ZuMVLV3g/?mibextid=wwXIfr" class="btn btn-outline btn-small" target="_blank" rel="noopener noreferrer">Read More</a>
                            </div>
                        </div>
                        
                        <div class="blog-card">
                            <div class="blog-image">
                                <div class="image-fallback">
                                    <i class="fas fa-passport"></i>
                                </div>
                            </div>
                            <div class="blog-content">
                                <div class="blog-date">July 10, 2023</div>
                                <h3 class="blog-title">Top 10 Visa Interview Tips for Success</h3>
                                <p class="blog-excerpt">Expert advice on how to prepare for your visa interview and increase your chances of approval.</p>
                                <a href="https://www.facebook.com/share/16ZuMVLV3g/?mibextid=wwXIfr" class="btn btn-outline btn-small" target="_blank" rel="noopener noreferrer">Read More</a>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Display posts from localStorage
                posts.forEach(post => {
                    const formattedDate = new Date(post.date).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    const blogCard = document.createElement('div');
                    blogCard.className = 'blog-card';
                    blogCard.innerHTML = `
                        <div class="blog-image">
                            <picture>
                                <source srcset="${post.image}" type="image/webp">
                                <source srcset="${post.image.replace('.webp', '.jpg')}" type="image/jpeg"> 
                                <img src="${post.image.replace('.webp', '.jpg')}" alt="${post.title}" loading="lazy" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'">
                            </picture>
                        </div>
                        <div class="blog-content">
                            <div class="blog-date">${formattedDate}</div>
                            <h3 class="blog-title">${post.title}</h3>
                            <p class="blog-excerpt">${post.excerpt}</p>
                            <a href="${post.link}" class="btn btn-outline btn-small" target="_blank" rel="noopener noreferrer">Read More</a>
                        </div>
                    `;
                    
                    blogContainer.appendChild(blogCard);
                });
            }

            // Load blog posts when the page is ready
            loadBlogPostsToWebsite();
            
            // Optional: Add an event listener to refresh blog posts if they're updated
            // This would be useful if you had multiple tabs open
            window.addEventListener('storage', function(e) {
                if (e.key === 'blogPosts') {
                    loadBlogPostsToWebsite();
                }
            });
        });

        // ==================== CAPTCHA VALIDATION ====================

// Enable/disable submit button based on conditions
function updateSubmitButtonState() {
    const submitBtn = document.getElementById('submitReport');
    const legalConsent = document.getElementById('legalConsent');
    const humanInput = document.getElementById('humanVerification');
    
    const isLegalChecked = legalConsent.checked;
    const isHumanValid = humanInput && humanInput.value.trim().toUpperCase() === 'I AM HUMAN';
    
    submitBtn.disabled = !(isLegalChecked && isHumanValid);
}

// Set up event listeners for real-time validation
function setupCaptchaListeners() {
    // Legal consent checkbox
    const legalConsent = document.getElementById('legalConsent');
    if (legalConsent) {
        legalConsent.addEventListener('change', updateSubmitButtonState);
    }
    
    // Human verification input
    const humanInput = document.getElementById('humanVerification');
    if (humanInput) {
        humanInput.addEventListener('input', updateSubmitButtonState);
    }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(setupCaptchaListeners, 1000);
});
        // ==================== TESTING FUNCTIONS ====================

// Test status updates
async function testStatusUpdate(docType, status) {
    if (!confirm(`Change ${docType} status to ${status}?`)) return;
    
    try {
        await documentManager.updateDocumentStatusManually(docType, status, 'Status updated via admin controls for testing');
        console.log(`Status updated: ${docType} -> ${status}`);
    } catch (error) {
        console.error('Error updating status:', error);
        alert('Error: ' + error.message);
    }
}

// Test notification system
async function testNotificationTest() {
    const message = prompt('Enter test notification message:');
    if (message) {
        await documentManager.sendUserNotification(message, 'test');
        alert('Test notification sent!');
    }
}

// Quick status update buttons for common actions
async function quickStatusUpdate(docType, action) {
    const statusMap = {
        'received': 'file_received',
        'review': 'under_review', 
        'approve': 'approved',
        'reject': 'needs_correction'
    };
    
    const status = statusMap[action];
    const notes = `Quick action: ${action}`;
    
    await documentManager.updateDocumentStatusManually(docType, status, notes);
}
// Report Fraud Form Functionality - UPDATED WITH GOOGLE SHEETS INTEGRATION
document.addEventListener('DOMContentLoaded', function() {
    initializeReportForm();
});

// Global variable for uploaded files
let uploadedFiles = [];

function initializeReportForm() {
    // Form navigation
    const nextButtons = document.querySelectorAll('.next-step');
    const prevButtons = document.querySelectorAll('.prev-step');
    
    // File upload functionality
    initializeFileUpload();
    
    // Character counters
    initializeCharacterCounters();

    setupCaptchaListeners();
    
    // Next step buttons
    nextButtons.forEach(button => {
        button.addEventListener('click', function() {
            const currentStep = this.closest('.form-step');
            const nextStepId = this.getAttribute('data-next');
            
            if (validateStep(currentStep.id)) {
                navigateToStep(nextStepId);
                updateProgressBar();
            }
        });
    });
    
    // Next step buttons
    nextButtons.forEach(button => {
        button.addEventListener('click', function() {
            const currentStep = this.closest('.form-step');
            const nextStepId = this.getAttribute('data-next');
            
            if (validateStep(currentStep.id)) {
                navigateToStep(nextStepId);
                updateProgressBar();
            }
        });
    });
    
    // Previous step buttons
    prevButtons.forEach(button => {
        button.addEventListener('click', function() {
            const prevStepId = this.getAttribute('data-prev');
            navigateToStep(prevStepId);
            updateProgressBar();
        });
    });
    
    // Form submission
    document.getElementById('submitReport').addEventListener('click', submitReportForm);
}

function navigateToStep(stepId) {
    // Hide all steps
    document.querySelectorAll('.form-step').forEach(step => {
        step.classList.remove('active');
    });
    
    // Show target step
    document.getElementById(`step-${stepId}`).classList.add('active');
    
    // Update progress steps
    document.querySelectorAll('.progress-step').forEach(step => {
        step.classList.remove('active');
        if (parseInt(step.getAttribute('data-step')) <= parseInt(stepId)) {
            step.classList.add('active');
        }
    });
}

function updateProgressBar() {
    const activeStep = document.querySelector('.form-step.active');
    const stepNumber = parseInt(activeStep.id.split('-')[1]);
    const progress = (stepNumber / 4) * 100;
    document.querySelector('.progress-fill').style.width = `${progress}%`;
}

function validateStep(stepId) {
    const step = document.getElementById(stepId);
    const inputs = step.querySelectorAll('input[required], select[required], textarea[required]');
    let isValid = true;
    
    inputs.forEach(input => {
        const errorElement = document.getElementById(`${input.id}Error`);
        if (!input.value.trim()) {
            if (errorElement) errorElement.style.display = 'block';
            isValid = false;
            input.style.borderColor = 'var(--primary-red)';
        } else {
            if (errorElement) errorElement.style.display = 'none';
            input.style.borderColor = '#ddd';
        }
        
        // Email validation
        if (input.type === 'email' && input.value.trim()) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(input.value)) {
                if (errorElement) {
                    errorElement.textContent = 'Please enter a valid email address';
                    errorElement.style.display = 'block';
                }
                isValid = false;
                input.style.borderColor = 'var(--primary-red)';
            }
        }
    });
    
    return isValid;
}

function initializeFileUpload() {
    const uploadArea = document.getElementById('evidenceUploadArea');
    const fileInput = document.getElementById('evidenceFiles');
    const filePreviews = document.getElementById('filePreviews');
    
    // Reset uploaded files
    uploadedFiles = [];
    
    // Click to upload
    uploadArea.addEventListener('click', () => fileInput.click());
    
    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) {
            handleFiles(Array.from(e.dataTransfer.files));
        }
    });
    
    // File input change
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFiles(Array.from(e.target.files));
        }
    });
    
    function handleFiles(files) {
        const validFiles = files.filter(file => {
            const validTypes = ['.jpg', '.jpeg', '.png', '.pdf', '.doc', '.docx', '.xlsx', '.mp4'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            const maxSize = 20 * 1024 * 1024; // 20MB
            const totalSize = uploadedFiles.reduce((sum, f) => sum + f.size, 0) + file.size;
            
            if (!validTypes.includes(fileExtension)) {
                alert(`File type ${fileExtension} is not supported.`);
                return false;
            }
            
            if (file.size > maxSize) {
                alert(`File ${file.name} is too large. Maximum size is 20MB.`);
                return false;
            }
            
            if (uploadedFiles.length >= 10) {
                alert('Maximum 10 files allowed.');
                return false;
            }
            
            if (totalSize > 100 * 1024 * 1024) {
                alert('Total upload size cannot exceed 100MB.');
                return false;
            }
            
            return true;
        });
        
        validFiles.forEach(file => {
            uploadedFiles.push(file);
            addFilePreview(file);
        });
        
        updateUploadArea();
    }
    
    function addFilePreview(file) {
        const preview = document.createElement('div');
        preview.className = 'file-preview';
        preview.innerHTML = `
            <div class="file-preview-info">
                <div class="file-preview-name">${file.name}</div>
                <div class="file-preview-size">${formatFileSize(file.size)}</div>
            </div>
            <button type="button" class="file-preview-remove" data-filename="${file.name}">
                <i class="fas fa-times"></i> Remove
            </button>
        `;
        
        preview.querySelector('.file-preview-remove').addEventListener('click', function() {
            const filename = this.getAttribute('data-filename');
            uploadedFiles = uploadedFiles.filter(f => f.name !== filename);
            preview.remove();
            updateUploadArea();
        });
        
        filePreviews.appendChild(preview);
    }
    
    function updateUploadArea() {
        if (uploadedFiles.length > 0) {
            uploadArea.innerHTML = `
                <i class="fas fa-check-circle" style="color: #4CAF50;"></i>
                <p>${uploadedFiles.length} file(s) ready for upload</p>
                <p class="upload-info">Click to add more files or drag and drop</p>
                <input type="file" id="evidenceFiles" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.xlsx,.mp4" style="display: none;">
            `;
            // Re-attach event listeners
            uploadArea.addEventListener('click', () => fileInput.click());
        }
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
}

function initializeCharacterCounters() {
    const summaryTextarea = document.getElementById('complaintSummary');
    const detailTextarea = document.getElementById('detailedDescription');
    
    // Check if elements exist before adding event listeners
    if (summaryTextarea) {
        summaryTextarea.addEventListener('input', function() {
            const counter = document.getElementById('summaryChars');
            if (counter) {
                counter.textContent = this.value.length;
            }
        });
    }
    
    if (detailTextarea) {
        detailTextarea.addEventListener('input', function() {
            const counter = document.getElementById('detailChars');
            if (counter) {
                counter.textContent = this.value.length;
            }
        });
    }
}

// GOOGLE SHEETS INTEGRATION FUNCTIONS
async function submitToGoogleSheets(formData) {
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwo7OkMyoZuizM8dQJFcczdygmZOBtz1LMn91yuKFvmSV0JOgYZAkjceJp81Ky3ZZI/exec';
    
    try {
        console.log('Starting form submission to Google Sheets...', formData);
        
        // Convert to URL-encoded form data (simpler for Apps Script)
        const formDataToSend = new URLSearchParams();
        Object.keys(formData).forEach(key => {
            formDataToSend.append(key, formData[key]);
        });
        
        console.log('Sending data to Google Apps Script...');
        
        const response = await fetch(scriptURL, {
            method: 'POST',
            body: formDataToSend,
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        });
        
        console.log('Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Response received:', result);
        
        if (result.status === 'success') {
            console.log('Form submitted successfully!');
            return { status: 'success', message: 'Report submitted successfully' };
        } else {
            throw new Error('Submission failed: ' + result.message);
        }
        
    } catch (error) {
        console.error('Submission error:', error);
        throw new Error('Failed to submit report: ' + error.message);
    }
}
    </script>
</body>
</html>
